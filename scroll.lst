(C)Copyright TOSHIBA CORPORATION 1993-2009  All rights reserved
Fri May 15 22:29:36 2020
TLCS-900 Relocatable Assembler (32) V2.2k  [Page     1]  scroll.lst
Runtime option : c:\Program Files (x86)\TOSHIBA\T900\bin\asm900.exe -Nb2 -O1 -g -l scroll.asm

Location  Object                           Ins        Line Source Statement

                                 +0          1           1 ;*****************************************
                                 +0          2           2 ;	Scroll functions 
                                 +0          3           3 ;*****************************************
                                 +0          4           4 	$MAXIMUM
                                 +0          5           5 	module scroll
                                 +0          6           6 
                                 +0          7           7 ;  ---------------------------------
                                 +0          8           8 ;	EXTERNAL LOOK UP
                                 +0          9           9 ;  ---------------------------------
                                 +0         10          10 	extern medium scroll_x,scroll_y,scroll_mode
                                 +0         11          11 	
                                 +0         12          12 ;  ---------------------------------
                                 +0         13          13 ;   EXTERNAL DEFINITION
                                 +0         14          14 ;  ---------------------------------
                                 +0         15          15 	public scroll_set
                                 +0         16          16 	public scroll_copy
                                 +0         17          17 
                                 +0         18          18 ;  ---------------------------------
                                 +0         19          19 ;	INCLUDE
                                 +0         20          20 ;  ---------------------------------
                                 +0         21          21 	$include "k1head.inc"
                                 +1          1          22 ;=======================================================
                                 +1          2          23 
                                 +1          3          24 ;		SYSTEM RELATED EQU
                                 +1          4          25 
                                 +1          5          26 ;=======================================================
                                 +1          6          27 
  00008000                       +1          7          28 DISP_CTL0		EQU	0x08000			;interrupt control register
                                 +1          8          29 
                                 +1          9          30 ;D7 : 1 = Vint allowed / 0 = not allowed
                                 +1         10          31 
                                 +1         11          32 ;D6 : 1 = Hint allowed / 0 = not allowed
                                 +1         12          33 
                                 +1         13          34 
                                 +1         14          35 
  00008010                       +1         15          36 STS_RG_ADD		EQU	0x08010			;2D status register (READ)
                                 +1         16          37 
                                 +1         17          38 ;D7 : 1 = character over / 0 = no character over
                                 +1         18          39 
                                 +1         19          40 ;D6 : 1 = while V blanking / 0 = while in display mode
                                 +1         20          41 
                                 +1         21          42 
                                 +1         22          43 
  00008012                       +1         23          44 LCD_CTR_ADD		EQU	0x08012			;2D control register
                                 +1         24          45 
                                 +1         25          46 ;D7 : 1 = screen color inverse display / 0 = normal display
                                 +1         26          47 
                                 +1         27          48 ;D2Å`D0 : outside window frame color CODE
                                 +1         28          49 
                                 +1         29          50 
                                 +1         30          51 
  00008118                       +1         31          52 BG_COLOR		EQU 0X08118			;Background color register
                                 +1         32          53 
                                 +1         33          54 ;D7`D6: BGON. D7 = 1, D6 = 0: Use specified BG color. Defaults to D7/D6 both 0
                                 +1         34          55 
                                 +1         35          56 ;D2`D0: BG color code
                                 +1         36          57 
                                 +1         37          58 
                                 +1         38          59 
                                 +1         39          60 
  000087E0                       +1         40          61 RESET_ADD		EQU	0X087E0			;2D software reset (WRITE)
                                 +1         41          62 
                                 +1         42          63 ;2D cicuit initialization with "52" write
                                 +1         43          64 
                                 +1         44          65 
                                 +1         45          66 
  000087FE                       +1         46          67 VERSION_ADD		EQU	0x087FE			;2D cicuit version (READ)
                                 +1         47          68 
                                 +1         48          69 ;D7 : 1 = white LCD panel /0 = balck LCD panel 
                                 +1         49          70 
                                 +1         50          71 ;D5Å`D0 : 2D circuit version
                                 +1         51          72 
                                 +1         52          73 
                                 +1         53          74 
                                 +1         54          75 
                                 +1         55          76 
                                 +1         56          77 ;=======================================================
                                 +1         57          78 
                                 +1         58          79 ;		CHARACTER EQU
                                 +1         59          80 
                                 +1         60          81 ;=======================================================
                                 +1         61          82 
  0000A000                       +1         62          83 CHR_VRAM		EQU	0x0A000			;character data RAM address
                                 +1         63          84 
                                 +1         64          85 
                                 +1         65          86 
                                 +1         66          87 
                                 +1         67          88 
                                 +1         68          89 ;=======================================================
                                 +1         69          90 
                                 +1         70          91 ;		SCROLL EQU
                                 +1         71          92 
                                 +1         72          93 ;=======================================================
                                 +1         73          94 
  00009000                       +1         74          95 SCRL1_VRAM		EQU	0x09000
                                 +1         75          96 
  00009800                       +1         76          97 SCRL2_VRAM		EQU	0x09800
                                 +1         77          98 
                                 +1         78          99 
                                 +1         79         100 
  00008030                       +1         80         101 SCRL_PRIO_ADR		EQU	0X08030			;scroll priority level invert register 
                                 +1         81         102 
  00008032                       +1         82         103 SCRL_X1_ADR		EQU	0x08032			;scroll 1 offset H register
                                 +1         83         104 
  00008033                       +1         84         105 SCRL_Y1_ADR		EQU	0x08033			;scroll 1 offset V register
                                 +1         85         106 
  00008034                       +1         86         107 SCRL_X2_ADR		EQU	0x08034			;scroll 2 offset H register
                                 +1         87         108 
  00008035                       +1         88         109 SCRL_Y2_ADR		EQU	0x08035			;scroll 2 offset V register
                                 +1         89         110 
                                 +1         90         111 
                                 +1         91         112 
                                 +1         92         113 ;=======================================================
                                 +1         93         114 
                                 +1         94         115 ;		SPRITE EQU
                                 +1         95         116 
                                 +1         96         117 ;=======================================================
                                 +1         97         118 
  00008800                       +1         98         119 SPR_VRAM		EQU	0x08800
                                 +1         99         120 
  00008020                       +1        100         121 SPR_OFFSET_X_ADR	EQU	0x08020			;sprite offset H
                                 +1        101         122 
  00008021                       +1        102         123 SPR_OFFSET_Y_ADR	EQU	0x08021			;sprite offset V
                                 +1        103         124 
                                 +1        104         125 
                                 +1        105         126 
                                 +1        106         127 
                                 +1        107         128 
                                 +1        108         129 ;=======================================================
                                 +1        109         130 
                                 +1        110         131 ;		WINDOW SYSTEM EQU
                                 +1        111         132 
                                 +1        112         133 ;=======================================================
                                 +1        113         134 
  00008002                       +1        114         135 WIN_WBAX_ADR		EQU	0x08002			;window origin H
                                 +1        115         136 
  00008003                       +1        116         137 WIN_WBAY_ADR		EQU	0x08003			;window origin V
                                 +1        117         138 
  00008004                       +1        118         139 WIN_WSIX_ADR		EQU	0x08004			;window size H
                                 +1        119         140 
  00008005                       +1        120         141 WIN_WSIY_ADR		EQU	0x08005			;window size V
                                 +1        121         142 
                                 +1        122         143 
                                 +1        123         144 
  00008008                       +1        124         145 WD_LCDST_HPOS		EQU	0x08008			;raster H position register (READ)
                                 +1        125         146 
  00008009                       +1        126         147 WD_LCDST_VPOS		EQU	0x08009			;raster V position register (READ)
                                 +1        127         148 
                                 +1        128         149 
                                 +1        129         150 
                                 +1        130         151 ;=======================================================
                                 +1        131         152 
                                 +1        132         153 ;		PALETTE EQU
                                 +1        133         154 
                                 +1        134         155 ;=======================================================
                                 +1        135         156 
                                 +1        136         157 ;sprite palette 0
                                 +1        137         158 
  00008101                       +1        138         159 PL_SPR_00		EQU	0x08101	
                                 +1        139         160 
  00008102                       +1        140         161 PL_SPR_01		EQU	0x08102
                                 +1        141         162 
  00008103                       +1        142         163 PL_SPR_02		EQU	0x08103
                                 +1        143         164 
                                 +1        144         165 ;sprite palette 1
                                 +1        145         166 
  00008105                       +1        146         167 PL_SPR_10		EQU	0x08105
                                 +1        147         168 
  00008106                       +1        148         169 PL_SPR_11		EQU	0x08106
                                 +1        149         170 
  00008107                       +1        150         171 PL_SPR_12		EQU	0x08107
                                 +1        151         172 
                                 +1        152         173 
                                 +1        153         174 
                                 +1        154         175 ;scroll 0 palette 0
                                 +1        155         176 
  00008109                       +1        156         177 PL_SCR0_00		EQU	0x08109
                                 +1        157         178 
  0000810A                       +1        158         179 PL_SCR0_01		EQU	0x0810A
                                 +1        159         180 
  0000810B                       +1        160         181 PL_SCR0_02		EQU	0x0810B
                                 +1        161         182 
                                 +1        162         183 ;scroll 0 palette 1
                                 +1        163         184 
  0000810D                       +1        164         185 PL_SCR0_10		EQU	0x0810D
                                 +1        165         186 
  0000810E                       +1        166         187 PL_SCR0_11		EQU	0x0810E
                                 +1        167         188 
  0000810F                       +1        168         189 PL_SCR0_12		EQU	0x0810F
                                 +1        169         190 
                                 +1        170         191 ;scroll 1 palette 0
                                 +1        171         192 
  00008111                       +1        172         193 PAL_SCR1_00		EQU	0x08111
                                 +1        173         194 
  00008112                       +1        174         195 PAL_SCR1_01		EQU	0x08112
                                 +1        175         196 
  00008113                       +1        176         197 PAL_SCR1_02		EQU	0x08113
                                 +1        177         198 
                                 +1        178         199 ;scroll 1 palette 1
                                 +1        179         200 
  00008115                       +1        180         201 PAL_SCR1_10		EQU	0x08115
                                 +1        181         202 
  00008116                       +1        182         203 PAL_SCR1_11		EQU	0x08116
                                 +1        183         204 
  00008117                       +1        184         205 PAL_SCR1_12		EQU	0x08117
                                 +1        185         206 
                                 +1        186         207 
                                 +1        187         208 ;=======================================================
                                 +1        188         209 
                                 +1        189         210 ;		COLOR PALETTE RAM EQU
                                 +1        190         211 
                                 +1        191         212 ;=======================================================
                                 +1        192         213 
  00008200                       +1        193         214 SPRITE_CRAM		EQU 0x08200
                                 +1        194         215 
  00008280                       +1        195         216 SCROLL1_CRAM	EQU 0x08280
                                 +1        196         217 
  00008300                       +1        197         218 SCROLL2_CRAM	EQU 0x08300
                                 +1        198         219 
  000083E0                       +1        199         220 BGCOL_CRAM		EQU 0x083E0 ;for the background color
                                 +1        200         221 
  000083F0                       +1        201         222 WINDOW_CRAM		EQU 0x083F0
                                 +1        202         223 
                                 +1        203         224 
                                 +1        204         225 ;=======================================================
                                 +1        205         226 
                                 +1        206         227 
                                 +1        207         228 
                                 +0         22         229 	$include "system.inc"
                                 +1          1         230 ;-----------------------------------------------------------------
                                 +1          2         231 
                                 +1          3         232 ;	SYSTEM CALL
                                 +1          4         233 
                                 +1          5         234 ;-----------------------------------------------------------------
                                 +1          6         235 
  00000000                       +1          7         236 SYS_SUCCESS		equ	0x00			;run success
                                 +1          8         237 
  000000FF                       +1          9         238 SYS_FAILURE		equ	0xff			;run failure
                                 +1         10         239 
                                 +1         11         240 ;-----------------------------------------------------------------
                                 +1         12         241 
  00000000                       +1         13         242 VECT_SHUTDOWN		equ	0x00			;shutdown (power OFF)
                                 +1         14         243 
  00000001                       +1         15         244 VECT_CLOCKGEARSET	equ	0x01			;clock gear change
                                 +1         16         245 
  00000002                       +1         17         246 VECT_RTCGET		equ	0x02			;obtain time
                                 +1         18         247 
  00000004                       +1         19         248 VECT_INTLVSET		equ	0x04			;set interrupt level
                                 +1         20         249 
  00000005                       +1         21         250 VECT_SYSFONTSET	equ	0x05			;set system font
                                 +1         22         251 
  00000006                       +1         23         252 VECT_FLASHWRITE	equ	0x06			;flash memory data write
                                 +1         24         253 
  00000007                       +1         25         254 VECT_FLASHALLERS	equ	0x07			;flash memory erase all blocks
                                 +1         26         255 
  00000008                       +1         27         256 VECT_FLASHERS		equ	0x08			;flash memory erase specified blocks
                                 +1         28         257 
  00000009                       +1         29         258 VECT_ALARMSET		equ	0x09			;game alarm setting
                                 +1         30         259 
  0000000B                       +1         31         260 VECT_ALARMDOWNSET	equ	0x0b			;alarm setting during shutdown
                                 +1         32         261 
  0000000D                       +1         33         262 VECT_FLASHPROTECT	equ	0x0d			;protect using tool
                                 +1         34         263 
  0000000E                       +1         35         264 VECT_GEMODESET	equ	0x0e			;switching GE mode
                                 +1         36         265 
                                 +1         37         266 ;-----------------------------------------------------------------
                                 +1         38         267 
                                 +1         39         268 ;	SYSTEM BIT EQU
                                 +1         40         269 
                                 +1         41         270 ;-----------------------------------------------------------------
                                 +1         42         271 
  00000007                       +1         43         272 INT_CLR_BIT		equ	0x07			;interrupt request clear bit
                                 +1         44         273 
  00000080                       +1         45         274 _INT_CLR_BIT		equ	0y10000000		;
                                 +1         46         275 
                                 +1         47         276 ;-----------------------------------------------------------------
                                 +1         48         277 
                                 +1         49         278 ;	SYSTEM WORK
                                 +1         50         279 
                                 +1         51         280 ;-----------------------------------------------------------------
                                 +1         52         281 
  00006F80                       +1         53         282 Battery_Voltage	equ	0x6f80			;estimated voltage
                                 +1         54         283 
  00006F82                       +1         55         284 Sys_lever		equ	0x6f82			;lever value
                                 +1         56         285 
  00006F87                       +1         57         286 Language		equ	0x6f87			;language chosen
                                 +1         58         287 
  00006F85                       +1         59         288 User_Shutdown		equ	0x6f85			;shutdown re1uest bit
                                 +1         60         289 
  00006F84                       +1         61         290 User_Boot		equ	0x6f84			;startup bit flag
                                 +1         62         291 
  00006F86                       +1         63         292 User_Answer		equ	0x6f86			;user request bit
                                 +1         64         293 
  00006F91                       +1         65         294 OS_Version		equ	0x6f91			;system version reserve work
                                 +1         66         295 
                                 +1         67         296 ;-----------------------------------------------------------------
                                 +1         68         297 
                                 +1         69         298 ;	WATCH DOG
                                 +1         70         299 
                                 +1         71         300 ;-----------------------------------------------------------------
                                 +1         72         301 
  0000006F                       +1         73         302 WDCR			equ	0x06F		;watch dog control address
                                 +1         74         303 
  0000004E                       +1         75         304 WD_CLR			equ	0x04e		;watch dog clear code
                                 +1         76         305 
                                 +1         77         306 ;-----------------------------------------------------------------
                                 +1         78         307 
                                 +1         79         308 ;	SYSTEM WORK BIT
                                 +1         80         309 
                                 +1         81         310 ;-----------------------------------------------------------------
                                 +1         82         311 
  00000001                       +1         83         312 JOY_UP 		equ 0x1
  00000002                       +1         84         313 JOY_DOWN 	equ 0x2
  00000004                       +1         85         314 JOY_LEFT 	equ 0x4
  00000008                       +1         86         315 JOY_RIGHT 	equ 0x8
  00000010                       +1         87         316 JOY_A		equ 0x10
  00000020                       +1         88         317 JOY_B		equ 0x20
  00000040                       +1         89         318 JOY_OPTION	equ 0x40
                                 +1         90         319 
  00000000                       +1         91         320 BIT_UP		equ 0
  00000001                       +1         92         321 BIT_DOWN	equ 1
  00000002                       +1         93         322 BIT_LEFT	equ 2
  00000003                       +1         94         323 BIT_RIGHT	equ 3
  00000004                       +1         95         324 BIT_A		equ 4
  00000005                       +1         96         325 BIT_B		equ 5
  00000006                       +1         97         326 BIT_OPTION	equ 6
                                 +1         98         327 
                                 +1         99         328 ;======================================================= 
                                 +1        100         329 
                                 +1        101         330 ;	USER START UP BIT
                                 +1        102         331 
                                 +1        103         332 ;======================================================= 
                                 +1        104         333 
                                 +1        105         334 ;User_Boot
                                 +1        106         335 
                                 +1        107         336 ;	00000000
                                 +1        108         337 
                                 +1        109         338 ;	||+------ resume startup			0:not resume startup		1:resume startup
                                 +1        110         339 
                                 +1        111         340 ;	|+------- POWER startup			0:not POWER startup		1:POWER startup
                                 +1        112         341 
                                 +1        113         342 ;	+-------- alarm startup			0:not alarm statup		1:alarm statup
                                 +1        114         343 
                                 +1        115         344 ;	=================================================
                                 +1        116         345 
                                 +1        117         346 
                                 +1        118         347 
  00000007                       +1        119         348 ALARM_BOOT_REQ		equ	0x07
                                 +1        120         349 
  00000006                       +1        121         350 POWER_BOOT_REQ		equ	0x06
                                 +1        122         351 
  00000005                       +1        123         352 RESUME_BOOT_REQ		equ	0x05
                                 +1        124         353 
  00000080                       +1        125         354 _ALARM_BOOT_REQ		equ	0y10000000
                                 +1        126         355 
  00000040                       +1        127         356 _POWER_BOOT_REQ		equ	0y01000000
                                 +1        128         357 
  00000020                       +1        129         358 _RESUME_BOOT_REQ	equ	0y00100000
                                 +1        130         359 
                                 +1        131         360 
                                 +1        132         361 
                                 +1        133         362 ;======================================================= 
                                 +1        134         363 
                                 +1        135         364 ;	USER SHUTDOWN BIT
                                 +1        136         365 
                                 +1        137         366 ;======================================================= 
                                 +1        138         367 
                                 +1        139         368 ;User_Shutdown
                                 +1        140         369 
                                 +1        141         370 ;	00000000
                                 +1        142         371 
                                 +1        143         372 ;	||+--------- main power use shutdown request	0:no request	1:request
                                 +1        144         373 
                                 +1        145         374 ;	|+---------- no use shutdown request		0:no request	1:request
                                 +1        146         375 
                                 +1        147         376 ;	+----------- power off shutdown request		0:no request	1:request
                                 +1        148         377 
                                 +1        149         378 ;	=================================================
                                 +1        150         379 
                                 +1        151         380 
                                 +1        152         381 
  00000007                       +1        153         382 MP_SHUTDOWN_REQ	equ	0x07
                                 +1        154         383 
  00000006                       +1        155         384 TIME_SHUTDOWN_REQ	equ	0x06
                                 +1        156         385 
  00000005                       +1        157         386 BAT_SHUTDOWN_REQ	equ	0x05
                                 +1        158         387 
  00000080                       +1        159         388 _MP_SHUTDOWN_REQ	equ	0y10000000
                                 +1        160         389 
  00000040                       +1        161         390 _TIME_SHUTDOWN_REQ	equ	0y01000000
                                 +1        162         391 
  00000020                       +1        163         392 _BAT_SHUTDOWN_REQ	equ	0y00100000
                                 +1        164         393 
                                 +1        165         394 
                                 +1        166         395 
                                 +1        167         396 ;======================================================= 
                                 +1        168         397 
                                 +1        169         398 ;	USER ANSWER BIT
                                 +1        170         399 
                                 +1        171         400 ;======================================================= 
                                 +1        172         401 
                                 +1        173         402 ;User_Answer
                                 +1        174         403 
                                 +1        175         404 ;	00000000
                                 +1        176         405 
                                 +1        177         406 ;	|+----------- no use shutdown operation	0:non-existent	1:exists
                                 +1        178         407 
                                 +1        179         408 ;	+------------ resume operation		0:non-existent	1:exists
                                 +1        180         409 
                                 +1        181         410 ;	=================================================
                                 +1        182         411 
                                 +1        183         412 
                                 +1        184         413 
  00000007                       +1        185         414 RESUME_ANS		equ	0x07
                                 +1        186         415 
  00000006                       +1        187         416 TIMER_SHUTDOWN_ANS	equ	0x06
                                 +1        188         417 
  00000080                       +1        189         418 _RESUME_ANS		equ	0y10000000
                                 +1        190         419 
  00000040                       +1        191         420 _TIMER_SHUTDOWN_ANS	equ	0y01000000
                                 +1        192         421 
                                 +0         23         422 	$include "graphics.inc"
                                 +1          1         423 ;*****************************************
                                 +1          2         424 ;	Graphics data 
                                 +1          3         425 ;*****************************************
                                 +1          4         426 
                                 +1          5         427 	extern palette
                                 +1          6         428 	extern palette_end
                                 +1          7         429 	extern tiles
                                 +1          8         430 	extern tiles_end
                                 +1          9         431 	extern map
                                 +1         10         432 	extern map_end
                                 +0         24         433 	
  00000014                       +0         25         434 TILES_X equ 20
  00000013                       +0         26         435 TILES_Y equ 19
  00000001                       +0         27         436 COPY_LEFT equ 1
  00000002                       +0         28         437 COPY_RIGHT equ 2
  00000004                       +0         29         438 COPY_UP equ 4
  00000008                       +0         30         439 COPY_DOWN equ 8
                                 +0         31         440 
                                 +0         32         441 ;-------------------------------------------------------
                                 +0         33         442 PROG section code large
                                 +0         34         443 ;-------------------------------------------------------
                                 +0         35         444 	
                                 +0         36         445 ;-------------------------------------------------------
                                 +0         37         446 ; scroll_set: set scroll to specified coords
                                 +0         38         447 ;-------------------------------------------------------
                                 +0         39         448 ; wa: x pos
                                 +0         40         449 ; bc: y pos
                                 +0         41         450 ;-------------------------------------------------------
00000000                         +0         42         451 scroll_set:
00000000  D10000F0             R +0         43         452 	cpw wa,(scroll_x)
00000004  660A                   +0         44         453 	j z,no_x
00000006  6D04                   +0         45         454 	j p,right_x
                                 +0         46         455 	
00000008                         +0         47         456 left_x: ;if scrolling to the left
00000008  2401                   +0         48         457 	ldb d,COPY_LEFT
0000000A  6806                   +0         49         458 	j done_x	
0000000C                         +0         50         459 right_x: ;if scrolling to the right
0000000C  2402                   +0         51         460 	ldb d,COPY_RIGHT
0000000E  6802                   +0         52         461 	j done_x
00000010                         +0         53         462 no_x: ;if values are the same
00000010  2400                   +0         54         463 	ldb d,0
00000012                         +0         55         464 done_x:
00000012  F1000050             R +0         56         465 	ldw (scroll_x),wa
                                 +0         57         466 	
00000016  D10000F1             R +0         58         467 	cpw bc,(scroll_y)
0000001A  660C                   +0         59         468 	j z,done_y
0000001C  6D05                   +0         60         469 	j p,down_y
                                 +0         61         470 
0000001E                         +0         62         471 up_y: ;if scrolling up
0000001E  CCCE04                 +0         63         472 	orb d,COPY_UP
00000021  6805                   +0         64         473 	j done_y
00000023                         +0         65         474 down_y: ;if scrolling down
00000023  CCCE08                 +0         66         475 	orb d,COPY_DOWN
00000026  6800                   +0         67         476 	j done_y
00000028                         +0         68         477 done_y: ;if values are the same
00000028  F1000044             R +0         69         478 	ldb (scroll_mode),d
0000002C  F1000051             R +0         70         479 	ldw (scroll_y),bc
00000030  0E                     +0         71         480 	ret
                                 +0         72         481 	
                                 +0         73         482 ;-------------------------------------------------------
                                 +0         74         483 ; scroll_copy: carry out scroll changes made in scroll_set (run during vblank)
                                 +0         75         484 ;-------------------------------------------------------	
00000031                         +0         76         485 scroll_copy:
00000031  C1000021             R +0         77         486 	ldb a,(scroll_x)
00000035  C1000023             R +0         78         487 	ldb c,(scroll_y)
00000039  F1328041               +0         79         488 	ldb (SCRL_X1_ADR),a
0000003D  F1338043               +0         80         489 	ldb (SCRL_Y1_ADR),c
                                 +0         81         490 	
00000041  C1000021             R +0         82         491 	ldb a,(scroll_mode)
00000045  C9CC01                 +0         83         492 	andb a,COPY_LEFT
00000048  661B                   +0         84         493 	j z,no_left
                                 +0         85         494 	;scrolling left
0000004A  D7E2A8                 +0         86         495 	ldw qwa,0
0000004D  D1000020             R +0         87         496 	ldw wa,(scroll_x)
00000051  E8EF03                 +0         88         497 	srll 3,xwa ;divide by 8 to change pixels to 8x8 tiles
00000054  E869                   +0         89         498 	decl 1,xwa ;start copying 1 tile before the screen
00000056  D7E6A8                 +0         90         499 	ldw qbc,0
00000059  D1000021             R +0         91         500 	ldw bc,(scroll_y)
0000005D  E9EF03                 +0         92         501 	srll 3,xbc
00000060  E969                   +0         93         502 	decl 1,xbc ;start copying 1 tile higher than the screen
00000062  1E7500                 +0         94         503 	cal copy_column
                                 +0         95         504 	
00000065                         +0         96         505 no_left:
00000065  C1000021             R +0         97         506 	ldb a,(scroll_mode)
00000069  C9CC02                 +0         98         507 	andb a,COPY_RIGHT
0000006C  661F                   +0         99         508 	j z,no_right
                                 +0        100         509 	;scrolling right
0000006E  D7E2A8                 +0        101         510 	ldw qwa,0
00000071  D1000020             R +0        102         511 	ldw wa,(scroll_x)
00000075  E8EF03                 +0        103         512 	srll 3,xwa ;divide by 8 to change pixels to 8x8 tiles
00000078  E8C814000000           +0        104         513 	addl xwa,TILES_X ;start copying 1 tile after the screen
0000007E  D7E6A8                 +0        105         514 	ldw qbc,0
00000081  D1000021             R +0        106         515 	ldw bc,(scroll_y)
00000085  E9EF03                 +0        107         516 	srll 3,xbc
00000088  E969                   +0        108         517 	decl 1,xbc ;start copying 1 tile higher than the screen
0000008A  1E4D00                 +0        109         518 	cal copy_column
                                 +0        110         519 	
0000008D                         +0        111         520 no_right:
0000008D  C1000021             R +0        112         521 	ldb a,(scroll_mode)
00000091  C9CC04                 +0        113         522 	andb a,COPY_UP
00000094  661B                   +0        114         523 	j z,no_up
                                 +0        115         524 	;scrolling up
00000096  D7E2A8                 +0        116         525 	ldw qwa,0
00000099  D1000020             R +0        117         526 	ldw wa,(scroll_x)
0000009D  E8EF03                 +0        118         527 	srll 3,xwa ;divide by 8 to change pixels to 8x8 tiles
000000A0  E869                   +0        119         528 	decl 1,xwa ;start copying 1 tile before the screen
000000A2  D7E6A8                 +0        120         529 	ldw qbc,0
000000A5  D1000021             R +0        121         530 	ldw bc,(scroll_y)
000000A9  E9EF03                 +0        122         531 	srll 3,xbc
000000AC  E969                   +0        123         532 	decl 1,xbc ;start copying 1 tile higher than the screen
000000AE  1E8000                 +0        124         533 	cal copy_row
                                 +0        125         534 	
000000B1                         +0        126         535 no_up:
000000B1  C1000021             R +0        127         536 	ldb a,(scroll_mode)
000000B5  C9CC08                 +0        128         537 	andb a,COPY_DOWN
000000B8  661F                   +0        129         538 	j z,no_down
                                 +0        130         539 	;scrolling down
000000BA  D7E2A8                 +0        131         540 	ldw qwa,0
000000BD  D1000020             R +0        132         541 	ldw wa,(scroll_x)
000000C1  E8EF03                 +0        133         542 	srll 3,xwa ;divide by 8 to change pixels to 8x8 tiles
000000C4  E869                   +0        134         543 	decl 1,xwa ;start copying 1 tile before the screen
000000C6  D7E6A8                 +0        135         544 	ldw qbc,0
000000C9  D1000021             R +0        136         545 	ldw bc,(scroll_y)
000000CD  E9EF03                 +0        137         546 	srll 3,xbc
000000D0  E9C813000000           +0        138         547 	addl xbc,TILES_Y ;start copying 1 tile lower than the screen
000000D6  1E5800                 +0        139         548 	cal copy_row	
000000D9                         +0        140         549 no_down:
000000D9  0E                     +0        141         550 	ret
                                 +0        142         551 	
                                 +0        143         552 ;-------------------------------------------------------
                                 +0        144         553 ; copy_column: copy a column of scroll data into vram
                                 +0        145         554 ;-------------------------------------------------------
                                 +0        146         555 ; xwa: tile x
                                 +0        147         556 ; xbc: tile y
                                 +0        148         557 ;-------------------------------------------------------	
000000DA                         +0        149         558 copy_column:
                                 +0        150         559 ;get source address
000000DA  E88A                   +0        151         560 	ldl xde,xwa
000000DC  EAEC01                 +0        152         561 	slal 1,xde ;tile # to word #
000000DF  E98D                   +0        153         562 	ldl xiy,xbc
000000E1  EDEC07                 +0        154         563 	slal 7,xiy ;tile # * 128 bytes per row
000000E4  EA85                   +0        155         564 	addl xiy,xde ;source offset now in xiy
000000E6  F200000032           R +0        156         565 	lda xde,map
                                 +0        157         566 ;get destination address
000000EB  E8CC1F000000           +0        158         567 	andl xwa,0x1f ;virtual screen is 32x32 tiles
000000F1  E8EC01                 +0        159         568 	slal 1,xwa
000000F4  E9CC1F000000           +0        160         569 	andl xbc,0x1f
000000FA  E98C                   +0        161         570 	ldl xix,xbc
000000FC  ECEC06                 +0        162         571 	slal 6,xix ;tile # * 64 bytes per row
000000FF  E884                   +0        163         572 	addl xix,xwa
00000101  ECC800900000           +0        164         573 	addl xix,SCRL1_VRAM
                                 +0        165         574 	
00000107  2115                   +0        166         575 	ldb a,TILES_Y+2 ;want to go from 1 tile before the screen to 1 tile after
00000109                         +0        167         576 copy_col_loop:
00000109  EDCCFF1F0000           +0        168         577 	andl xiy,0x1fff ;keep source offset within tilemap (64*64*2)
0000010F  ECCCFF970000           +0        169         578 	andl xix,0x97ff ;keep destination within scroll 1 vram	
00000115  ED8A                   +0        170         579 	ldl xde,xiy
00000117  EAC800000000         R +0        171         580 	addl xde,map ;get absolute source address
0000011D  9221                   +0        172         581 	ldw bc,(xde)
0000011F  B451                   +0        173         582 	ldw (xix),bc
00000121  EDC880000000           +0        174         583 	addl xiy,128 ;map is 64x64, so 128 bytes per row	
00000127  ECC840000000           +0        175         584 	addl xix,64 ;vram is 32x32, so 64 bytes per row
0000012D  C91CD9                 +0        176         585 	djnz a,copy_col_loop
00000130  0E                     +0        177         586 	ret
                                 +0        178         587 
                                 +0        179         588 ;-------------------------------------------------------
                                 +0        180         589 ; copy_row: copy a row of scroll data into vram
                                 +0        181         590 ;-------------------------------------------------------
                                 +0        182         591 ; xwa: tile x
                                 +0        183         592 ; xbc: tile y
                                 +0        184         593 ;-------------------------------------------------------	
00000131                         +0        185         594 copy_row:	
                                 +0        186         595 ;get source address
00000131  E88A                   +0        187         596 	ldl xde,xwa
00000133  EAEC01                 +0        188         597 	slal 1,xde ;tile # to word #
00000136  E98D                   +0        189         598 	ldl xiy,xbc
00000138  EDEC07                 +0        190         599 	slal 7,xiy ;tile # * 128 bytes per row
0000013B  EA85                   +0        191         600 	addl xiy,xde
0000013D  EDCCFF1F0000           +0        192         601 	andl xiy,0x1fff ;make sure source address is within bounds (64*64*2)
00000143  EDC800000000         R +0        193         602 	addl xiy,map ;source address now in xix
                                 +0        194         603 ;get destination address
00000149  E8CC1F000000           +0        195         604 	andl xwa,0x1f ;virtual screen is 32x32 tiles
0000014F  E8EC01                 +0        196         605 	slal 1,xwa
00000152  E9CC1F000000           +0        197         606 	andl xbc,0x1f
00000158  E98C                   +0        198         607 	ldl xix,xbc
0000015A  ECEC06                 +0        199         608 	slal 6,xix ;tile # * 64 bytes per row
0000015D  E884                   +0        200         609 	addl xix,xwa
0000015F  ECC800900000           +0        201         610 	addl xix,SCRL1_VRAM
                                 +0        202         611 
00000165  2116                   +0        203         612 	ldb a,TILES_X+2 ;1 tile before the screen to 1 tile after
00000167                         +0        204         613 copy_row_loop:
00000167  EDCCFF1F0000           +0        205         614 	andl xiy,0x1fff ;keep source offset within tilemap (64*64*2)
0000016D  ECCCFF970000           +0        206         615 	andl xix,0x97ff ;keep destination within scroll 1 vram	
00000173  ED8A                   +0        207         616 	ldl xde,xiy
00000175  EAC800000000         R +0        208         617 	addl xde,map
0000017B  D5E921                 +0        209         618 	ldw bc,(xde+)
0000017E  F5F151                 +0        210         619 	ldw (xix+),bc
00000181  C91CE3                 +0        211         620 	djnz a,copy_row_loop
00000184  0E                     +0        212         621 	ret
                                 +0        213         622 	
                                 +0        214         623 
                                 +0        215         624 
                                 +0        216         625 	
                                 +0        217         626 ;-------------------------------------------------------
                                 +0        218         627 	end
                                 +0        219         628 ;-------------------------------------------------------

Assembly complete, No error
TLCS-900 Relocatable Assembler (32) V2.2k  [Page     2]  scroll.lst

Symbol table listing
--------------------

Symbol           Category         Value     Attribute

ALARM_BOOT_REQ           NUM      00000007  A           
BAT_SHUTDOWN_REQ
                         NUM      00000005  A           
BGCOL_CRAM               NUM      000083E0  A           
BG_COLOR                 NUM      00008118  A           
BIT_A                    NUM      00000004  A           
BIT_B                    NUM      00000005  A           
BIT_DOWN                 NUM      00000001  A           
BIT_LEFT                 NUM      00000002  A           
BIT_OPTION               NUM      00000006  A           
BIT_RIGHT                NUM      00000003  A           
BIT_UP                   NUM      00000000  A           
Battery_Voltage          NUM      00006F80  A           
CHR_VRAM                 NUM      0000A000  A           
COPY_DOWN                NUM      00000008  A           
COPY_LEFT                NUM      00000001  A           
COPY_RIGHT               NUM      00000002  A           
COPY_UP                  NUM      00000004  A           
DISP_CTL0                NUM      00008000  A           
INT_CLR_BIT              NUM      00000007  A           
JOY_A                    NUM      00000010  A           
JOY_B                    NUM      00000020  A           
JOY_DOWN                 NUM      00000002  A           
JOY_LEFT                 NUM      00000004  A           
JOY_OPTION               NUM      00000040  A           
JOY_RIGHT                NUM      00000008  A           
JOY_UP                   NUM      00000001  A           
LCD_CTR_ADD              NUM      00008012  A           
Language                 NUM      00006F87  A           
MP_SHUTDOWN_REQ          NUM      00000007  A           
OS_Version               NUM      00006F91  A           
PAL_SCR1_00              NUM      00008111  A           
PAL_SCR1_01              NUM      00008112  A           
PAL_SCR1_02              NUM      00008113  A           
PAL_SCR1_10              NUM      00008115  A           
PAL_SCR1_11              NUM      00008116  A           
PAL_SCR1_12              NUM      00008117  A           
PL_SCR0_00               NUM      00008109  A           
PL_SCR0_01               NUM      0000810A  A           
PL_SCR0_02               NUM      0000810B  A           
PL_SCR0_10               NUM      0000810D  A           
PL_SCR0_11               NUM      0000810E  A           
PL_SCR0_12               NUM      0000810F  A           
PL_SPR_00                NUM      00008101  A           
PL_SPR_01                NUM      00008102  A           
PL_SPR_02                NUM      00008103  A           
PL_SPR_10                NUM      00008105  A           
PL_SPR_11                NUM      00008106  A           
PL_SPR_12                NUM      00008107  A           
POWER_BOOT_REQ           NUM      00000006  A           
PROG             C L     SEC      00000000  R 185       
RESET_ADD                NUM      000087E0  A           
RESUME_ANS               NUM      00000007  A           
RESUME_BOOT_REQ          NUM      00000005  A           
SCRL1_VRAM               NUM      00009000  A           
SCRL2_VRAM               NUM      00009800  A           
SCRL_PRIO_ADR            NUM      00008030  A           
SCRL_X1_ADR              NUM      00008032  A           
SCRL_X2_ADR              NUM      00008034  A           
SCRL_Y1_ADR              NUM      00008033  A           
SCRL_Y2_ADR              NUM      00008035  A           
SCROLL1_CRAM             NUM      00008280  A           
SCROLL2_CRAM             NUM      00008300  A           
SPRITE_CRAM              NUM      00008200  A           
SPR_OFFSET_X_ADR
                         NUM      00008020  A           
SPR_OFFSET_Y_ADR
                         NUM      00008021  A           
SPR_VRAM                 NUM      00008800  A           
STS_RG_ADD               NUM      00008010  A           
SYS_FAILURE              NUM      000000FF  A           
SYS_SUCCESS              NUM      00000000  A           
Sys_lever                NUM      00006F82  A           
TILES_X                  NUM      00000014  A           
TILES_Y                  NUM      00000013  A           
TIMER_SHUTDOWN_ANS
                         NUM      00000006  A           
TIME_SHUTDOWN_REQ
                         NUM      00000006  A           
User_Answer              NUM      00006F86  A           
User_Boot                NUM      00006F84  A           
User_Shutdown            NUM      00006F85  A           
VECT_ALARMDOWNSET
                         NUM      0000000B  A           
VECT_ALARMSET            NUM      00000009  A           
VECT_CLOCKGEARSET
                         NUM      00000001  A           
VECT_FLASHALLERS
                         NUM      00000007  A           
VECT_FLASHERS            NUM      00000008  A           
VECT_FLASHPROTECT
                         NUM      0000000D  A           
VECT_FLASHWRITE          NUM      00000006  A           
VECT_GEMODESET           NUM      0000000E  A           
VECT_INTLVSET            NUM      00000004  A           
VECT_RTCGET              NUM      00000002  A           
VECT_SHUTDOWN            NUM      00000000  A           
VECT_SYSFONTSET          NUM      00000005  A           
VERSION_ADD              NUM      000087FE  A           
WDCR                     NUM      0000006F  A           
WD_CLR                   NUM      0000004E  A           
WD_LCDST_HPOS            NUM      00008008  A           
WD_LCDST_VPOS            NUM      00008009  A           
WINDOW_CRAM              NUM      000083F0  A           
WIN_WBAX_ADR             NUM      00008002  A           
WIN_WBAY_ADR             NUM      00008003  A           
WIN_WSIX_ADR             NUM      00008004  A           
WIN_WSIY_ADR             NUM      00008005  A           
_ALARM_BOOT_REQ          NUM      00000080  A           
_BAT_SHUTDOWN_REQ
                         NUM      00000020  A           
_INT_CLR_BIT             NUM      00000080  A           
_MP_SHUTDOWN_REQ
                         NUM      00000080  A           
_POWER_BOOT_REQ          NUM      00000040  A           
_RESUME_ANS              NUM      00000080  A           
_RESUME_BOOT_REQ
                         NUM      00000020  A           
_TIMER_SHUTDOWN_ANS
                         NUM      00000040  A           
_TIME_SHUTDOWN_REQ
                         NUM      00000040  A           
copy_col_loop    C L     LAB      00000109  R           PROG
copy_column      C L     LAB      000000DA  R           PROG
copy_row         C L     LAB      00000131  R           PROG
copy_row_loop    C L     LAB      00000167  R           PROG
done_x           C L     LAB      00000012  R           PROG
done_y           C L     LAB      00000028  R           PROG
down_y           C L     LAB      00000023  R           PROG
left_x           C L     LAB      00000008  R           PROG
map                               00000000  R EXT       
no_down          C L     LAB      000000D9  R           PROG
no_left          C L     LAB      00000065  R           PROG
no_right         C L     LAB      0000008D  R           PROG
no_up            C L     LAB      000000B1  R           PROG
no_x             C L     LAB      00000010  R           PROG
right_x          C L     LAB      0000000C  R           PROG
scroll                   MOD
scroll_copy      C L     LAB      00000031  R PUB       PROG
scroll_mode                       00000000  R EXT       
scroll_set       C L     LAB      00000000  R PUB       PROG
scroll_x                          00000000  R EXT       
scroll_y                          00000000  R EXT       
up_y             C L     LAB      0000001E  R           PROG


TOTAL
  130 user defined symbol(s)
    5 unreferenced external symbol(s)
