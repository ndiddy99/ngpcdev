(C)Copyright TOSHIBA CORPORATION 1993-2009  All rights reserved
Sat Jun 06 13:34:33 2020
TLCS-900 Relocatable Assembler (32) V2.2k  [Page     1]  scroll.lst
Runtime option : c:\Program Files (x86)\TOSHIBA\T900\bin\asm900.exe -Nb2 -O1 -g -l scroll.asm

Location  Object                           Ins        Line Source Statement

                                 +0          1           1 ;*****************************************
                                 +0          2           2 ;	Scroll functions 
                                 +0          3           3 ;*****************************************
                                 +0          4           4 	$MAXIMUM
                                 +0          5           5 	module scroll
                                 +0          6           6 
                                 +0          7           7 ;  ---------------------------------
                                 +0          8           8 ;	EXTERNAL LOOK UP
                                 +0          9           9 ;  ---------------------------------
                                 +0         10          10 	extern medium scroll_mode
                                 +0         11          11 	
                                 +0         12          12 ;  ---------------------------------
                                 +0         13          13 ;   EXTERNAL DEFINITION
                                 +0         14          14 ;  ---------------------------------
                                 +0         15          15 	public scroll_set
                                 +0         16          16 	public scroll_get_tile
                                 +0         17          17 	public scroll_copy
                                 +0         18          18 
                                 +0         19          19 ;  ---------------------------------
                                 +0         20          20 ;	INCLUDE
                                 +0         21          21 ;  ---------------------------------
                                 +0         22          22 	$include "k1head.inc"
                                 +1          1          23 ;=======================================================
                                 +1          2          24 
                                 +1          3          25 ;		SYSTEM RELATED EQU
                                 +1          4          26 
                                 +1          5          27 ;=======================================================
                                 +1          6          28 
  00008000                       +1          7          29 DISP_CTL0		EQU	0x08000			;interrupt control register
                                 +1          8          30 
                                 +1          9          31 ;D7 : 1 = Vint allowed / 0 = not allowed
                                 +1         10          32 
                                 +1         11          33 ;D6 : 1 = Hint allowed / 0 = not allowed
                                 +1         12          34 
                                 +1         13          35 
                                 +1         14          36 
  00008010                       +1         15          37 STS_RG_ADD		EQU	0x08010			;2D status register (READ)
                                 +1         16          38 
                                 +1         17          39 ;D7 : 1 = character over / 0 = no character over
                                 +1         18          40 
                                 +1         19          41 ;D6 : 1 = while V blanking / 0 = while in display mode
                                 +1         20          42 
                                 +1         21          43 
                                 +1         22          44 
  00008012                       +1         23          45 LCD_CTR_ADD		EQU	0x08012			;2D control register
                                 +1         24          46 
                                 +1         25          47 ;D7 : 1 = screen color inverse display / 0 = normal display
                                 +1         26          48 
                                 +1         27          49 ;D2Å`D0 : outside window frame color CODE
                                 +1         28          50 
                                 +1         29          51 
                                 +1         30          52 
  00008118                       +1         31          53 BG_COLOR		EQU 0x08118			;Background color register
                                 +1         32          54 
                                 +1         33          55 ;D7`D6: BGON. D7 = 1, D6 = 0: Use specified BG color. Defaults to D7/D6 both 0
                                 +1         34          56 
                                 +1         35          57 ;D2`D0: BG color code
                                 +1         36          58 
                                 +1         37          59 
                                 +1         38          60 
                                 +1         39          61 
  000087E0                       +1         40          62 RESET_ADD		EQU	0X087E0			;2D software reset (WRITE)
                                 +1         41          63 
                                 +1         42          64 ;2D cicuit initialization with "52" write
                                 +1         43          65 
                                 +1         44          66 
                                 +1         45          67 
  000087FE                       +1         46          68 VERSION_ADD		EQU	0x087FE			;2D cicuit version (READ)
                                 +1         47          69 
                                 +1         48          70 ;D7 : 1 = white LCD panel /0 = balck LCD panel 
                                 +1         49          71 
                                 +1         50          72 ;D5Å`D0 : 2D circuit version
                                 +1         51          73 
                                 +1         52          74 
                                 +1         53          75 
                                 +1         54          76 
                                 +1         55          77 
                                 +1         56          78 ;=======================================================
                                 +1         57          79 
                                 +1         58          80 ;		CHARACTER EQU
                                 +1         59          81 
                                 +1         60          82 ;=======================================================
                                 +1         61          83 
  0000A000                       +1         62          84 CHR_VRAM		EQU	0x0A000			;character data RAM address
                                 +1         63          85 
                                 +1         64          86 
                                 +1         65          87 
                                 +1         66          88 
                                 +1         67          89 
                                 +1         68          90 ;=======================================================
                                 +1         69          91 
                                 +1         70          92 ;		SCROLL EQU
                                 +1         71          93 
                                 +1         72          94 ;=======================================================
                                 +1         73          95 
  00009000                       +1         74          96 SCRL1_VRAM		EQU	0x09000
                                 +1         75          97 
  00009800                       +1         76          98 SCRL2_VRAM		EQU	0x09800
                                 +1         77          99 
                                 +1         78         100 
                                 +1         79         101 
  00008030                       +1         80         102 SCRL_PRIO_ADR		EQU	0X08030			;scroll priority level invert register 
                                 +1         81         103 
  00008032                       +1         82         104 SCRL_X1_ADR		EQU	0x08032			;scroll 1 offset H register
                                 +1         83         105 
  00008033                       +1         84         106 SCRL_Y1_ADR		EQU	0x08033			;scroll 1 offset V register
                                 +1         85         107 
  00008034                       +1         86         108 SCRL_X2_ADR		EQU	0x08034			;scroll 2 offset H register
                                 +1         87         109 
  00008035                       +1         88         110 SCRL_Y2_ADR		EQU	0x08035			;scroll 2 offset V register
                                 +1         89         111 
                                 +1         90         112 
                                 +1         91         113 
                                 +1         92         114 ;=======================================================
                                 +1         93         115 
                                 +1         94         116 ;		SPRITE EQU
                                 +1         95         117 
                                 +1         96         118 ;=======================================================
                                 +1         97         119 
  00008800                       +1         98         120 SPR_VRAM		EQU	0x08800
                                 +1         99         121 
  00008020                       +1        100         122 SPR_OFFSET_X_ADR	EQU	0x08020			;sprite offset H
                                 +1        101         123 
  00008021                       +1        102         124 SPR_OFFSET_Y_ADR	EQU	0x08021			;sprite offset V
                                 +1        103         125 
  00008C00                       +1        104         126 SPR_PALCODE EQU 0x8C00 ;what palette # to use for each sprite 
                                 +1        105         127 
                                 +1        106         128 
                                 +1        107         129 
                                 +1        108         130 
                                 +1        109         131 ;=======================================================
                                 +1        110         132 
                                 +1        111         133 ;		WINDOW SYSTEM EQU
                                 +1        112         134 
                                 +1        113         135 ;=======================================================
                                 +1        114         136 
  00008002                       +1        115         137 WIN_WBAX_ADR		EQU	0x08002			;window origin H
                                 +1        116         138 
  00008003                       +1        117         139 WIN_WBAY_ADR		EQU	0x08003			;window origin V
                                 +1        118         140 
  00008004                       +1        119         141 WIN_WSIX_ADR		EQU	0x08004			;window size H
                                 +1        120         142 
  00008005                       +1        121         143 WIN_WSIY_ADR		EQU	0x08005			;window size V
                                 +1        122         144 
                                 +1        123         145 
                                 +1        124         146 
  00008008                       +1        125         147 WD_LCDST_HPOS		EQU	0x08008			;raster H position register (READ)
                                 +1        126         148 
  00008009                       +1        127         149 WD_LCDST_VPOS		EQU	0x08009			;raster V position register (READ)
                                 +1        128         150 
                                 +1        129         151 
                                 +1        130         152 
                                 +1        131         153 ;=======================================================
                                 +1        132         154 
                                 +1        133         155 ;		PALETTE EQU
                                 +1        134         156 
                                 +1        135         157 ;=======================================================
                                 +1        136         158 
                                 +1        137         159 ;sprite palette 0
                                 +1        138         160 
  00008101                       +1        139         161 PL_SPR_00		EQU	0x08101	
                                 +1        140         162 
  00008102                       +1        141         163 PL_SPR_01		EQU	0x08102
                                 +1        142         164 
  00008103                       +1        143         165 PL_SPR_02		EQU	0x08103
                                 +1        144         166 
                                 +1        145         167 ;sprite palette 1
                                 +1        146         168 
  00008105                       +1        147         169 PL_SPR_10		EQU	0x08105
                                 +1        148         170 
  00008106                       +1        149         171 PL_SPR_11		EQU	0x08106
                                 +1        150         172 
  00008107                       +1        151         173 PL_SPR_12		EQU	0x08107
                                 +1        152         174 
                                 +1        153         175 
                                 +1        154         176 
                                 +1        155         177 ;scroll 0 palette 0
                                 +1        156         178 
  00008109                       +1        157         179 PL_SCR0_00		EQU	0x08109
                                 +1        158         180 
  0000810A                       +1        159         181 PL_SCR0_01		EQU	0x0810A
                                 +1        160         182 
  0000810B                       +1        161         183 PL_SCR0_02		EQU	0x0810B
                                 +1        162         184 
                                 +1        163         185 ;scroll 0 palette 1
                                 +1        164         186 
  0000810D                       +1        165         187 PL_SCR0_10		EQU	0x0810D
                                 +1        166         188 
  0000810E                       +1        167         189 PL_SCR0_11		EQU	0x0810E
                                 +1        168         190 
  0000810F                       +1        169         191 PL_SCR0_12		EQU	0x0810F
                                 +1        170         192 
                                 +1        171         193 ;scroll 1 palette 0
                                 +1        172         194 
  00008111                       +1        173         195 PAL_SCR1_00		EQU	0x08111
                                 +1        174         196 
  00008112                       +1        175         197 PAL_SCR1_01		EQU	0x08112
                                 +1        176         198 
  00008113                       +1        177         199 PAL_SCR1_02		EQU	0x08113
                                 +1        178         200 
                                 +1        179         201 ;scroll 1 palette 1
                                 +1        180         202 
  00008115                       +1        181         203 PAL_SCR1_10		EQU	0x08115
                                 +1        182         204 
  00008116                       +1        183         205 PAL_SCR1_11		EQU	0x08116
                                 +1        184         206 
  00008117                       +1        185         207 PAL_SCR1_12		EQU	0x08117
                                 +1        186         208 
                                 +1        187         209 
                                 +1        188         210 ;=======================================================
                                 +1        189         211 
                                 +1        190         212 ;		COLOR PALETTE RAM EQU
                                 +1        191         213 
                                 +1        192         214 ;=======================================================
                                 +1        193         215 
  00008200                       +1        194         216 SPRITE_CRAM		EQU 0x08200
                                 +1        195         217 
  00008280                       +1        196         218 SCROLL1_CRAM	EQU 0x08280
                                 +1        197         219 
  00008300                       +1        198         220 SCROLL2_CRAM	EQU 0x08300
                                 +1        199         221 
  000083E0                       +1        200         222 BGCOL_CRAM		EQU 0x083E0 ;for the background color
                                 +1        201         223 
  000083F0                       +1        202         224 WINDOW_CRAM		EQU 0x083F0
                                 +1        203         225 
                                 +1        204         226 
                                 +1        205         227 ;=======================================================
                                 +1        206         228 
                                 +1        207         229 ;		TIMER EQU
                                 +1        208         230 
                                 +1        209         231 ;=======================================================
                                 +1        210         232 
  00000020                       +1        211         233 T8RUN	EQU 0x0020 ;bitmask controlling 8 bit timers
                                 +1        212         234 
                                 +1        213         235 
                                 +1        214         236 
                                 +1        215         237 ;=======================================================
                                 +0         23         238 	$include "system.inc"
                                 +1          1         239 ;-----------------------------------------------------------------
                                 +1          2         240 
                                 +1          3         241 ;	SYSTEM CALL
                                 +1          4         242 
                                 +1          5         243 ;-----------------------------------------------------------------
                                 +1          6         244 
  00000000                       +1          7         245 SYS_SUCCESS		equ	0x00			;run success
                                 +1          8         246 
  000000FF                       +1          9         247 SYS_FAILURE		equ	0xff			;run failure
                                 +1         10         248 
                                 +1         11         249 ;-----------------------------------------------------------------
                                 +1         12         250 
  00000000                       +1         13         251 VECT_SHUTDOWN		equ	0x00			;shutdown (power OFF)
                                 +1         14         252 
  00000001                       +1         15         253 VECT_CLOCKGEARSET	equ	0x01			;clock gear change
                                 +1         16         254 
  00000002                       +1         17         255 VECT_RTCGET		equ	0x02			;obtain time
                                 +1         18         256 
  00000004                       +1         19         257 VECT_INTLVSET		equ	0x04			;set interrupt level
                                 +1         20         258 
  00000005                       +1         21         259 VECT_SYSFONTSET	equ	0x05			;set system font
                                 +1         22         260 
  00000006                       +1         23         261 VECT_FLASHWRITE	equ	0x06			;flash memory data write
                                 +1         24         262 
  00000007                       +1         25         263 VECT_FLASHALLERS	equ	0x07			;flash memory erase all blocks
                                 +1         26         264 
  00000008                       +1         27         265 VECT_FLASHERS		equ	0x08			;flash memory erase specified blocks
                                 +1         28         266 
  00000009                       +1         29         267 VECT_ALARMSET		equ	0x09			;game alarm setting
                                 +1         30         268 
  0000000B                       +1         31         269 VECT_ALARMDOWNSET	equ	0x0b			;alarm setting during shutdown
                                 +1         32         270 
  0000000D                       +1         33         271 VECT_FLASHPROTECT	equ	0x0d			;protect using tool
                                 +1         34         272 
  0000000E                       +1         35         273 VECT_GEMODESET	equ	0x0e			;switching GE mode
                                 +1         36         274 
                                 +1         37         275 ;-----------------------------------------------------------------
                                 +1         38         276 
                                 +1         39         277 ;	SYSTEM BIT EQU
                                 +1         40         278 
                                 +1         41         279 ;-----------------------------------------------------------------
                                 +1         42         280 
  00000007                       +1         43         281 INT_CLR_BIT		equ	0x07			;interrupt request clear bit
                                 +1         44         282 
  00000080                       +1         45         283 _INT_CLR_BIT		equ	0y10000000		;
                                 +1         46         284 
                                 +1         47         285 ;-----------------------------------------------------------------
                                 +1         48         286 
                                 +1         49         287 ;	SYSTEM WORK
                                 +1         50         288 
                                 +1         51         289 ;-----------------------------------------------------------------
                                 +1         52         290 
  00006F80                       +1         53         291 Battery_Voltage	equ	0x6f80			;estimated voltage
                                 +1         54         292 
  00006F82                       +1         55         293 Sys_lever		equ	0x6f82			;lever value
                                 +1         56         294 
  00006F87                       +1         57         295 Language		equ	0x6f87			;language chosen
                                 +1         58         296 
  00006F85                       +1         59         297 User_Shutdown		equ	0x6f85			;shutdown re1uest bit
                                 +1         60         298 
  00006F84                       +1         61         299 User_Boot		equ	0x6f84			;startup bit flag
                                 +1         62         300 
  00006F86                       +1         63         301 User_Answer		equ	0x6f86			;user request bit
                                 +1         64         302 
  00006F91                       +1         65         303 OS_Version		equ	0x6f91			;system version reserve work
                                 +1         66         304 
                                 +1         67         305 ;-----------------------------------------------------------------
                                 +1         68         306 
                                 +1         69         307 ;	WATCH DOG
                                 +1         70         308 
                                 +1         71         309 ;-----------------------------------------------------------------
                                 +1         72         310 
  0000006F                       +1         73         311 WDCR			equ	0x06F		;watch dog control address
                                 +1         74         312 
  0000004E                       +1         75         313 WD_CLR			equ	0x04e		;watch dog clear code
                                 +1         76         314 
                                 +1         77         315 ;-----------------------------------------------------------------
                                 +1         78         316 
                                 +1         79         317 ;	SYSTEM WORK BIT
                                 +1         80         318 
                                 +1         81         319 ;-----------------------------------------------------------------
                                 +1         82         320 
  00000001                       +1         83         321 JOY_UP 		equ 0x1
  00000002                       +1         84         322 JOY_DOWN 	equ 0x2
  00000004                       +1         85         323 JOY_LEFT 	equ 0x4
  00000008                       +1         86         324 JOY_RIGHT 	equ 0x8
  00000010                       +1         87         325 JOY_A		equ 0x10
  00000020                       +1         88         326 JOY_B		equ 0x20
  00000040                       +1         89         327 JOY_OPTION	equ 0x40
                                 +1         90         328 
  00000000                       +1         91         329 BIT_UP		equ 0
  00000001                       +1         92         330 BIT_DOWN	equ 1
  00000002                       +1         93         331 BIT_LEFT	equ 2
  00000003                       +1         94         332 BIT_RIGHT	equ 3
  00000004                       +1         95         333 BIT_A		equ 4
  00000005                       +1         96         334 BIT_B		equ 5
  00000006                       +1         97         335 BIT_OPTION	equ 6
                                 +1         98         336 
                                 +1         99         337 ;======================================================= 
                                 +1        100         338 
                                 +1        101         339 ;	USER START UP BIT
                                 +1        102         340 
                                 +1        103         341 ;======================================================= 
                                 +1        104         342 
                                 +1        105         343 ;User_Boot
                                 +1        106         344 
                                 +1        107         345 ;	00000000
                                 +1        108         346 
                                 +1        109         347 ;	||+------ resume startup			0:not resume startup		1:resume startup
                                 +1        110         348 
                                 +1        111         349 ;	|+------- POWER startup			0:not POWER startup		1:POWER startup
                                 +1        112         350 
                                 +1        113         351 ;	+-------- alarm startup			0:not alarm statup		1:alarm statup
                                 +1        114         352 
                                 +1        115         353 ;	=================================================
                                 +1        116         354 
                                 +1        117         355 
                                 +1        118         356 
  00000007                       +1        119         357 ALARM_BOOT_REQ		equ	0x07
                                 +1        120         358 
  00000006                       +1        121         359 POWER_BOOT_REQ		equ	0x06
                                 +1        122         360 
  00000005                       +1        123         361 RESUME_BOOT_REQ		equ	0x05
                                 +1        124         362 
  00000080                       +1        125         363 _ALARM_BOOT_REQ		equ	0y10000000
                                 +1        126         364 
  00000040                       +1        127         365 _POWER_BOOT_REQ		equ	0y01000000
                                 +1        128         366 
  00000020                       +1        129         367 _RESUME_BOOT_REQ	equ	0y00100000
                                 +1        130         368 
                                 +1        131         369 
                                 +1        132         370 
                                 +1        133         371 ;======================================================= 
                                 +1        134         372 
                                 +1        135         373 ;	USER SHUTDOWN BIT
                                 +1        136         374 
                                 +1        137         375 ;======================================================= 
                                 +1        138         376 
                                 +1        139         377 ;User_Shutdown
                                 +1        140         378 
                                 +1        141         379 ;	00000000
                                 +1        142         380 
                                 +1        143         381 ;	||+--------- main power use shutdown request	0:no request	1:request
                                 +1        144         382 
                                 +1        145         383 ;	|+---------- no use shutdown request		0:no request	1:request
                                 +1        146         384 
                                 +1        147         385 ;	+----------- power off shutdown request		0:no request	1:request
                                 +1        148         386 
                                 +1        149         387 ;	=================================================
                                 +1        150         388 
                                 +1        151         389 
                                 +1        152         390 
  00000007                       +1        153         391 MP_SHUTDOWN_REQ	equ	0x07
                                 +1        154         392 
  00000006                       +1        155         393 TIME_SHUTDOWN_REQ	equ	0x06
                                 +1        156         394 
  00000005                       +1        157         395 BAT_SHUTDOWN_REQ	equ	0x05
                                 +1        158         396 
  00000080                       +1        159         397 _MP_SHUTDOWN_REQ	equ	0y10000000
                                 +1        160         398 
  00000040                       +1        161         399 _TIME_SHUTDOWN_REQ	equ	0y01000000
                                 +1        162         400 
  00000020                       +1        163         401 _BAT_SHUTDOWN_REQ	equ	0y00100000
                                 +1        164         402 
                                 +1        165         403 
                                 +1        166         404 
                                 +1        167         405 ;======================================================= 
                                 +1        168         406 
                                 +1        169         407 ;	USER ANSWER BIT
                                 +1        170         408 
                                 +1        171         409 ;======================================================= 
                                 +1        172         410 
                                 +1        173         411 ;User_Answer
                                 +1        174         412 
                                 +1        175         413 ;	00000000
                                 +1        176         414 
                                 +1        177         415 ;	|+----------- no use shutdown operation	0:non-existent	1:exists
                                 +1        178         416 
                                 +1        179         417 ;	+------------ resume operation		0:non-existent	1:exists
                                 +1        180         418 
                                 +1        181         419 ;	=================================================
                                 +1        182         420 
                                 +1        183         421 
                                 +1        184         422 
  00000007                       +1        185         423 RESUME_ANS		equ	0x07
                                 +1        186         424 
  00000006                       +1        187         425 TIMER_SHUTDOWN_ANS	equ	0x06
                                 +1        188         426 
  00000080                       +1        189         427 _RESUME_ANS		equ	0y10000000
                                 +1        190         428 
  00000040                       +1        191         429 _TIMER_SHUTDOWN_ANS	equ	0y01000000
                                 +1        192         430 
                                 +0         24         431 	$include "graphics.inc"
                                 +1          1         432 ;*****************************************
                                 +1          2         433 ;	Graphics data 
                                 +1          3         434 ;*****************************************
                                 +1          4         435 
                                 +1          5         436 	extern palette
                                 +1          6         437 	extern palette_end
                                 +1          7         438 	extern tiles
                                 +1          8         439 	extern tiles_end
                                 +1          9         440 	extern map
                                 +1         10         441 	extern map_end
                                 +1         11         442 	extern hills
                                 +1         12         443 	extern hills_end
                                 +1         13         444 	extern hills_map
                                 +1         14         445 	extern hills_map_end
                                 +1         15         446 	extern hills_pal
                                 +1         16         447 	extern hills_pal_end
                                 +1         17         448 	extern guy
                                 +1         18         449 	extern guy_end
                                 +1         19         450 	extern guy_pal
                                 +1         20         451 	extern guy_pal_end
                                 +0         25         452 	$include "glbwork.inc"
                                 +1          1         453 ;================================================================
                                 +1          2         454 ; global vars
                                 +1          3         455 ;================================================================
                                 +1          4         456 
                                 +1          5         457 	extern medium start_work
                                 +1          6         458 	extern medium stopper ; keeps main loop spinning until vblank (byte)
                                 +1          7         459 	extern medium joypad ;joypad bitmask (byte)
                                 +1          8         460 	extern medium joylast ;last frame's joypad bitmask (byte)
                                 +1          9         461 	extern medium joyedge ;what buttons were pressed this frame (byte)
                                 +1         10         462 	extern medium hint_cnt ;how many times horizontal interrupt has fired (byte)
                                 +1         11         463 	extern medium frame_cnt ; counts number of frames (word)
                                 +1         12         464 	
                                 +1         13         465 	extern medium scroll_x ;scroll x pos (word)
                                 +1         14         466 	extern medium scroll_y ;scroll y pos (word)
                                 +1         15         467 	
                                 +1         16         468 	extern medium player_x ;player x pos (long)
                                 +1         17         469 	extern medium player_y ;player y pos (long)
                                 +1         18         470 	extern medium player_dx ;long
                                 +1         19         471 	extern medium player_dy ;long
                                 +1         20         472 ;================================================================
                                 +1         21         473 
                                 +0         26         474 	
  00000014                       +0         27         475 TILES_X equ 20
  00000013                       +0         28         476 TILES_Y equ 19
  00000001                       +0         29         477 COPY_LEFT equ 1
  00000002                       +0         30         478 COPY_RIGHT equ 2
  00000004                       +0         31         479 COPY_UP equ 4
  00000008                       +0         32         480 COPY_DOWN equ 8
                                 +0         33         481 
                                 +0         34         482 ;-------------------------------------------------------
                                 +0         35         483 PROG section code large
                                 +0         36         484 ;-------------------------------------------------------
                                 +0         37         485 	
                                 +0         38         486 ;-------------------------------------------------------
                                 +0         39         487 ; scroll_set: set scroll to specified coords
                                 +0         40         488 ;-------------------------------------------------------
                                 +0         41         489 ; wa: x pos
                                 +0         42         490 ; bc: y pos
                                 +0         43         491 ;-------------------------------------------------------
00000000                         +0         44         492 scroll_set:
00000000  D10000F0             R +0         45         493 	cpw wa,(scroll_x)
00000004  660A                   +0         46         494 	j z,no_x
00000006  6D04                   +0         47         495 	j p,right_x
                                 +0         48         496 	
00000008                         +0         49         497 left_x: ;if scrolling to the left
00000008  2401                   +0         50         498 	ldb d,COPY_LEFT
0000000A  6806                   +0         51         499 	j done_x	
0000000C                         +0         52         500 right_x: ;if scrolling to the right
0000000C  2402                   +0         53         501 	ldb d,COPY_RIGHT
0000000E  6802                   +0         54         502 	j done_x
00000010                         +0         55         503 no_x: ;if values are the same
00000010  2400                   +0         56         504 	ldb d,0
00000012                         +0         57         505 done_x:
00000012  F1000050             R +0         58         506 	ldw (scroll_x),wa
                                 +0         59         507 	
00000016  D10000F1             R +0         60         508 	cpw bc,(scroll_y)
0000001A  660C                   +0         61         509 	j z,done_y
0000001C  6D05                   +0         62         510 	j p,down_y
                                 +0         63         511 
0000001E                         +0         64         512 up_y: ;if scrolling up
0000001E  CCCE04                 +0         65         513 	orb d,COPY_UP
00000021  6805                   +0         66         514 	j done_y
00000023                         +0         67         515 down_y: ;if scrolling down
00000023  CCCE08                 +0         68         516 	orb d,COPY_DOWN
00000026  6800                   +0         69         517 	j done_y
00000028                         +0         70         518 done_y: ;if values are the same
00000028  F1000044             R +0         71         519 	ldb (scroll_mode),d
0000002C  F1000051             R +0         72         520 	ldw (scroll_y),bc
00000030  0E                     +0         73         521 	ret
                                 +0         74         522 
                                 +0         75         523 
                                 +0         76         524 ;-------------------------------------------------------
                                 +0         77         525 ; scroll_get_tile: returns tile # at given coordinates in wa
                                 +0         78         526 ;-------------------------------------------------------
                                 +0         79         527 ; wa: x pos
                                 +0         80         528 ; bc: y pos
                                 +0         81         529 ;-------------------------------------------------------
00000031                         +0         82         530 scroll_get_tile:
00000031  D8EF03                 +0         83         531 	srlw 3,wa ;change pixels to 8x8 tiles
00000034  D9EF03                 +0         84         532 	srlw 3,bc
00000037  D9EC06                 +0         85         533 	slaw 6,bc ;64 tiles per row
0000003A  D881                   +0         86         534 	addw bc,wa
0000003C  D9EC01                 +0         87         535 	slaw 1,bc ;bytes->words
0000003F  D7E6A8                 +0         88         536 	ldw qbc,0
00000042  E9C800000000         R +0         89         537 	addl xbc,map
00000048  9120                   +0         90         538 	ldw wa,(xbc)
                                 +0         91         539 	; andw wa,0x1ff ;tile number is low 9 bits of map word
0000004A  0E                     +0         92         540 	ret
                                 +0         93         541 	
                                 +0         94         542 	
                                 +0         95         543 ;-------------------------------------------------------
                                 +0         96         544 ; scroll_copy: carry out scroll changes made in scroll_set (run during vblank)
                                 +0         97         545 ;-------------------------------------------------------	
0000004B                         +0         98         546 scroll_copy:
0000004B  C1000021             R +0         99         547 	ldb a,(scroll_x)
0000004F  C1000023             R +0        100         548 	ldb c,(scroll_y)
00000053  F1328041               +0        101         549 	ldb (SCRL_X1_ADR),a
00000057  F1338043               +0        102         550 	ldb (SCRL_Y1_ADR),c
                                 +0        103         551 	
0000005B  C1000021             R +0        104         552 	ldb a,(scroll_mode)
0000005F  C9CC01                 +0        105         553 	andb a,COPY_LEFT
00000062  661B                   +0        106         554 	j z,no_left
                                 +0        107         555 	;scrolling left
00000064  D7E2A8                 +0        108         556 	ldw qwa,0
00000067  D1000020             R +0        109         557 	ldw wa,(scroll_x)
0000006B  E8EF03                 +0        110         558 	srll 3,xwa ;divide by 8 to change pixels to 8x8 tiles
0000006E  E869                   +0        111         559 	decl 1,xwa ;start copying 1 tile before the screen
00000070  D7E6A8                 +0        112         560 	ldw qbc,0
00000073  D1000021             R +0        113         561 	ldw bc,(scroll_y)
00000077  E9EF03                 +0        114         562 	srll 3,xbc
0000007A  E969                   +0        115         563 	decl 1,xbc ;start copying 1 tile higher than the screen
0000007C  1E7500                 +0        116         564 	cal copy_column
                                 +0        117         565 	
0000007F                         +0        118         566 no_left:
0000007F  C1000021             R +0        119         567 	ldb a,(scroll_mode)
00000083  C9CC02                 +0        120         568 	andb a,COPY_RIGHT
00000086  661F                   +0        121         569 	j z,no_right
                                 +0        122         570 	;scrolling right
00000088  D7E2A8                 +0        123         571 	ldw qwa,0
0000008B  D1000020             R +0        124         572 	ldw wa,(scroll_x)
0000008F  E8EF03                 +0        125         573 	srll 3,xwa ;divide by 8 to change pixels to 8x8 tiles
00000092  E8C814000000           +0        126         574 	addl xwa,TILES_X ;start copying 1 tile after the screen
00000098  D7E6A8                 +0        127         575 	ldw qbc,0
0000009B  D1000021             R +0        128         576 	ldw bc,(scroll_y)
0000009F  E9EF03                 +0        129         577 	srll 3,xbc
000000A2  E969                   +0        130         578 	decl 1,xbc ;start copying 1 tile higher than the screen
000000A4  1E4D00                 +0        131         579 	cal copy_column
                                 +0        132         580 	
000000A7                         +0        133         581 no_right:
000000A7  C1000021             R +0        134         582 	ldb a,(scroll_mode)
000000AB  C9CC04                 +0        135         583 	andb a,COPY_UP
000000AE  661B                   +0        136         584 	j z,no_up
                                 +0        137         585 	;scrolling up
000000B0  D7E2A8                 +0        138         586 	ldw qwa,0
000000B3  D1000020             R +0        139         587 	ldw wa,(scroll_x)
000000B7  E8EF03                 +0        140         588 	srll 3,xwa ;divide by 8 to change pixels to 8x8 tiles
000000BA  E869                   +0        141         589 	decl 1,xwa ;start copying 1 tile before the screen
000000BC  D7E6A8                 +0        142         590 	ldw qbc,0
000000BF  D1000021             R +0        143         591 	ldw bc,(scroll_y)
000000C3  E9EF03                 +0        144         592 	srll 3,xbc
000000C6  E969                   +0        145         593 	decl 1,xbc ;start copying 1 tile higher than the screen
000000C8  1E8000                 +0        146         594 	cal copy_row
                                 +0        147         595 	
000000CB                         +0        148         596 no_up:
000000CB  C1000021             R +0        149         597 	ldb a,(scroll_mode)
000000CF  C9CC08                 +0        150         598 	andb a,COPY_DOWN
000000D2  661F                   +0        151         599 	j z,no_down
                                 +0        152         600 	;scrolling down
000000D4  D7E2A8                 +0        153         601 	ldw qwa,0
000000D7  D1000020             R +0        154         602 	ldw wa,(scroll_x)
000000DB  E8EF03                 +0        155         603 	srll 3,xwa ;divide by 8 to change pixels to 8x8 tiles
000000DE  E869                   +0        156         604 	decl 1,xwa ;start copying 1 tile before the screen
000000E0  D7E6A8                 +0        157         605 	ldw qbc,0
000000E3  D1000021             R +0        158         606 	ldw bc,(scroll_y)
000000E7  E9EF03                 +0        159         607 	srll 3,xbc
000000EA  E9C813000000           +0        160         608 	addl xbc,TILES_Y ;start copying 1 tile lower than the screen
000000F0  1E5800                 +0        161         609 	cal copy_row	
000000F3                         +0        162         610 no_down:
000000F3  0E                     +0        163         611 	ret
                                 +0        164         612 	
                                 +0        165         613 ;-------------------------------------------------------
                                 +0        166         614 ; copy_column: copy a column of scroll data into vram
                                 +0        167         615 ;-------------------------------------------------------
                                 +0        168         616 ; xwa: tile x
                                 +0        169         617 ; xbc: tile y
                                 +0        170         618 ;-------------------------------------------------------	
000000F4                         +0        171         619 copy_column:
                                 +0        172         620 ;get source address
000000F4  E88A                   +0        173         621 	ldl xde,xwa
000000F6  EAEC01                 +0        174         622 	slal 1,xde ;tile # to word #
000000F9  E98D                   +0        175         623 	ldl xiy,xbc
000000FB  EDEC07                 +0        176         624 	slal 7,xiy ;tile # * 128 bytes per row
000000FE  EA85                   +0        177         625 	addl xiy,xde ;source offset now in xiy
00000100  F200000032           R +0        178         626 	lda xde,map
                                 +0        179         627 ;get destination address
00000105  E8CC1F000000           +0        180         628 	andl xwa,0x1f ;virtual screen is 32x32 tiles
0000010B  E8EC01                 +0        181         629 	slal 1,xwa
0000010E  E9CC1F000000           +0        182         630 	andl xbc,0x1f
00000114  E98C                   +0        183         631 	ldl xix,xbc
00000116  ECEC06                 +0        184         632 	slal 6,xix ;tile # * 64 bytes per row
00000119  E884                   +0        185         633 	addl xix,xwa
0000011B  ECC800900000           +0        186         634 	addl xix,SCRL1_VRAM
                                 +0        187         635 	
00000121  2115                   +0        188         636 	ldb a,TILES_Y+2 ;want to go from 1 tile before the screen to 1 tile after
00000123                         +0        189         637 copy_col_loop:
00000123  EDCCFF1F0000           +0        190         638 	andl xiy,0x1fff ;keep source offset within tilemap (64*64*2)
00000129  ECCCFF970000           +0        191         639 	andl xix,0x97ff ;keep destination within scroll 1 vram	
0000012F  ED8A                   +0        192         640 	ldl xde,xiy
00000131  EAC800000000         R +0        193         641 	addl xde,map ;get absolute source address
00000137  9221                   +0        194         642 	ldw bc,(xde)
00000139  B451                   +0        195         643 	ldw (xix),bc
0000013B  EDC880000000           +0        196         644 	addl xiy,128 ;map is 64x64, so 128 bytes per row	
00000141  ECC840000000           +0        197         645 	addl xix,64 ;vram is 32x32, so 64 bytes per row
00000147  C91CD9                 +0        198         646 	djnz a,copy_col_loop
0000014A  0E                     +0        199         647 	ret
                                 +0        200         648 
                                 +0        201         649 ;-------------------------------------------------------
                                 +0        202         650 ; copy_row: copy a row of scroll data into vram
                                 +0        203         651 ;-------------------------------------------------------
                                 +0        204         652 ; xwa: tile x
                                 +0        205         653 ; xbc: tile y
                                 +0        206         654 ;-------------------------------------------------------	
0000014B                         +0        207         655 copy_row:	
                                 +0        208         656 ;get source address
0000014B  E88A                   +0        209         657 	ldl xde,xwa
0000014D  EAEC01                 +0        210         658 	slal 1,xde ;tile # to word #
00000150  E98D                   +0        211         659 	ldl xiy,xbc
00000152  EDEC07                 +0        212         660 	slal 7,xiy ;tile # * 128 bytes per row
00000155  EA85                   +0        213         661 	addl xiy,xde
00000157  EDC800000000         R +0        214         662 	addl xiy,map ;source address in xiy
                                 +0        215         663 ;get destination address
0000015D  C9CC1F                 +0        216         664 	andb a,0x1f ;virtual screen is 32x32 tiles
00000160  C9EC01                 +0        217         665 	slab 1,a ;row offset in a
00000163  E9CC1F000000           +0        218         666 	andl xbc,0x1f
00000169  E98C                   +0        219         667 	ldl xix,xbc
0000016B  ECEC06                 +0        220         668 	slal 6,xix ;tile # * 64 bytes per row
0000016E  ECC800900000           +0        221         669 	addl xix,SCRL1_VRAM ;destination address in xix
                                 +0        222         670 
00000174  2716                   +0        223         671 	ldb l,TILES_X+2 ;1 tile before the screen to 1 tile after
00000176                         +0        224         672 copy_row_loop:
00000176  C9CC3F                 +0        225         673 	andb a,0x3f ;keep offset within 1 row of scroll 1 vram
00000179  ECCCFF970000           +0        226         674 	andl xix,0x97ff ;keep destination within scroll 1 vram
0000017F  D5F521                 +0        227         675 	ldw bc,(xiy+)
00000182  F303F0E051             +0        228         676 	ldw (xix+a),bc
00000187  C9C802                 +0        229         677 	addb a,2
0000018A  CF1CE9                 +0        230         678 	djnz l,copy_row_loop
0000018D  0E                     +0        231         679 	ret
                                 +0        232         680 	
                                 +0        233         681 
                                 +0        234         682 
                                 +0        235         683 	
                                 +0        236         684 ;-------------------------------------------------------
                                 +0        237         685 	end
                                 +0        238         686 ;-------------------------------------------------------

Assembly complete, No error
TLCS-900 Relocatable Assembler (32) V2.2k  [Page     2]  scroll.lst

Symbol table listing
--------------------

Symbol           Category         Value     Attribute

ALARM_BOOT_REQ           NUM      00000007  A           
BAT_SHUTDOWN_REQ
                         NUM      00000005  A           
BGCOL_CRAM               NUM      000083E0  A           
BG_COLOR                 NUM      00008118  A           
BIT_A                    NUM      00000004  A           
BIT_B                    NUM      00000005  A           
BIT_DOWN                 NUM      00000001  A           
BIT_LEFT                 NUM      00000002  A           
BIT_OPTION               NUM      00000006  A           
BIT_RIGHT                NUM      00000003  A           
BIT_UP                   NUM      00000000  A           
Battery_Voltage          NUM      00006F80  A           
CHR_VRAM                 NUM      0000A000  A           
COPY_DOWN                NUM      00000008  A           
COPY_LEFT                NUM      00000001  A           
COPY_RIGHT               NUM      00000002  A           
COPY_UP                  NUM      00000004  A           
DISP_CTL0                NUM      00008000  A           
INT_CLR_BIT              NUM      00000007  A           
JOY_A                    NUM      00000010  A           
JOY_B                    NUM      00000020  A           
JOY_DOWN                 NUM      00000002  A           
JOY_LEFT                 NUM      00000004  A           
JOY_OPTION               NUM      00000040  A           
JOY_RIGHT                NUM      00000008  A           
JOY_UP                   NUM      00000001  A           
LCD_CTR_ADD              NUM      00008012  A           
Language                 NUM      00006F87  A           
MP_SHUTDOWN_REQ          NUM      00000007  A           
OS_Version               NUM      00006F91  A           
PAL_SCR1_00              NUM      00008111  A           
PAL_SCR1_01              NUM      00008112  A           
PAL_SCR1_02              NUM      00008113  A           
PAL_SCR1_10              NUM      00008115  A           
PAL_SCR1_11              NUM      00008116  A           
PAL_SCR1_12              NUM      00008117  A           
PL_SCR0_00               NUM      00008109  A           
PL_SCR0_01               NUM      0000810A  A           
PL_SCR0_02               NUM      0000810B  A           
PL_SCR0_10               NUM      0000810D  A           
PL_SCR0_11               NUM      0000810E  A           
PL_SCR0_12               NUM      0000810F  A           
PL_SPR_00                NUM      00008101  A           
PL_SPR_01                NUM      00008102  A           
PL_SPR_02                NUM      00008103  A           
PL_SPR_10                NUM      00008105  A           
PL_SPR_11                NUM      00008106  A           
PL_SPR_12                NUM      00008107  A           
POWER_BOOT_REQ           NUM      00000006  A           
PROG             C L     SEC      00000000  R 18E       
RESET_ADD                NUM      000087E0  A           
RESUME_ANS               NUM      00000007  A           
RESUME_BOOT_REQ          NUM      00000005  A           
SCRL1_VRAM               NUM      00009000  A           
SCRL2_VRAM               NUM      00009800  A           
SCRL_PRIO_ADR            NUM      00008030  A           
SCRL_X1_ADR              NUM      00008032  A           
SCRL_X2_ADR              NUM      00008034  A           
SCRL_Y1_ADR              NUM      00008033  A           
SCRL_Y2_ADR              NUM      00008035  A           
SCROLL1_CRAM             NUM      00008280  A           
SCROLL2_CRAM             NUM      00008300  A           
SPRITE_CRAM              NUM      00008200  A           
SPR_OFFSET_X_ADR
                         NUM      00008020  A           
SPR_OFFSET_Y_ADR
                         NUM      00008021  A           
SPR_PALCODE              NUM      00008C00  A           
SPR_VRAM                 NUM      00008800  A           
STS_RG_ADD               NUM      00008010  A           
SYS_FAILURE              NUM      000000FF  A           
SYS_SUCCESS              NUM      00000000  A           
Sys_lever                NUM      00006F82  A           
T8RUN                    NUM      00000020  A           
TILES_X                  NUM      00000014  A           
TILES_Y                  NUM      00000013  A           
TIMER_SHUTDOWN_ANS
                         NUM      00000006  A           
TIME_SHUTDOWN_REQ
                         NUM      00000006  A           
User_Answer              NUM      00006F86  A           
User_Boot                NUM      00006F84  A           
User_Shutdown            NUM      00006F85  A           
VECT_ALARMDOWNSET
                         NUM      0000000B  A           
VECT_ALARMSET            NUM      00000009  A           
VECT_CLOCKGEARSET
                         NUM      00000001  A           
VECT_FLASHALLERS
                         NUM      00000007  A           
VECT_FLASHERS            NUM      00000008  A           
VECT_FLASHPROTECT
                         NUM      0000000D  A           
VECT_FLASHWRITE          NUM      00000006  A           
VECT_GEMODESET           NUM      0000000E  A           
VECT_INTLVSET            NUM      00000004  A           
VECT_RTCGET              NUM      00000002  A           
VECT_SHUTDOWN            NUM      00000000  A           
VECT_SYSFONTSET          NUM      00000005  A           
VERSION_ADD              NUM      000087FE  A           
WDCR                     NUM      0000006F  A           
WD_CLR                   NUM      0000004E  A           
WD_LCDST_HPOS            NUM      00008008  A           
WD_LCDST_VPOS            NUM      00008009  A           
WINDOW_CRAM              NUM      000083F0  A           
WIN_WBAX_ADR             NUM      00008002  A           
WIN_WBAY_ADR             NUM      00008003  A           
WIN_WSIX_ADR             NUM      00008004  A           
WIN_WSIY_ADR             NUM      00008005  A           
_ALARM_BOOT_REQ          NUM      00000080  A           
_BAT_SHUTDOWN_REQ
                         NUM      00000020  A           
_INT_CLR_BIT             NUM      00000080  A           
_MP_SHUTDOWN_REQ
                         NUM      00000080  A           
_POWER_BOOT_REQ          NUM      00000040  A           
_RESUME_ANS              NUM      00000080  A           
_RESUME_BOOT_REQ
                         NUM      00000020  A           
_TIMER_SHUTDOWN_ANS
                         NUM      00000040  A           
_TIME_SHUTDOWN_REQ
                         NUM      00000040  A           
copy_col_loop    C L     LAB      00000123  R           PROG
copy_column      C L     LAB      000000F4  R           PROG
copy_row         C L     LAB      0000014B  R           PROG
copy_row_loop    C L     LAB      00000176  R           PROG
done_x           C L     LAB      00000012  R           PROG
done_y           C L     LAB      00000028  R           PROG
down_y           C L     LAB      00000023  R           PROG
left_x           C L     LAB      00000008  R           PROG
map                               00000000  R EXT       
no_down          C L     LAB      000000F3  R           PROG
no_left          C L     LAB      0000007F  R           PROG
no_right         C L     LAB      000000A7  R           PROG
no_up            C L     LAB      000000CB  R           PROG
no_x             C L     LAB      00000010  R           PROG
right_x          C L     LAB      0000000C  R           PROG
scroll                   MOD
scroll_copy      C L     LAB      0000004B  R PUB       PROG
scroll_get_tile  C L     LAB      00000031  R PUB       PROG
scroll_mode                       00000000  R EXT       
scroll_set       C L     LAB      00000000  R PUB       PROG
scroll_x                          00000000  R EXT       
scroll_y                          00000000  R EXT       
up_y             C L     LAB      0000001E  R           PROG


TOTAL
  133 user defined symbol(s)
   26 unreferenced external symbol(s)
