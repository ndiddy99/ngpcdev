(C)Copyright TOSHIBA CORPORATION 1993-2009  All rights reserved
Thu May 21 22:56:40 2020
TLCS-900 Relocatable Assembler (32) V2.2k  [Page     1]  player.lst
Runtime option : c:\Program Files (x86)\TOSHIBA\T900\bin\asm900.exe -Nb2 -O1 -g -l player.asm

Location  Object                           Ins        Line Source Statement

                                 +0          1           1 ;*****************************************
                                 +0          2           2 ;	Scroll functions 
                                 +0          3           3 ;*****************************************
                                 +0          4           4 	$MAXIMUM
                                 +0          5           5 	module player
                                 +0          6           6 
                                 +0          7           7 ;  ---------------------------------
                                 +0          8           8 ;	EXTERNAL LOOK UP
                                 +0          9           9 ;  ---------------------------------
                                 +0         10          10 	; extern medium
                                 +0         11          11 	
                                 +0         12          12 ;  ---------------------------------
                                 +0         13          13 ;   EXTERNAL DEFINITION
                                 +0         14          14 ;  ---------------------------------
                                 +0         15          15 	public player_init
                                 +0         16          16 	public player_move
                                 +0         17          17 
                                 +0         18          18 ;  ---------------------------------
                                 +0         19          19 ;	INCLUDE
                                 +0         20          20 ;  ---------------------------------
                                 +0         21          21 	$include "k1head.inc"
                                 +1          1          22 ;=======================================================
                                 +1          2          23 
                                 +1          3          24 ;		SYSTEM RELATED EQU
                                 +1          4          25 
                                 +1          5          26 ;=======================================================
                                 +1          6          27 
  00008000                       +1          7          28 DISP_CTL0		EQU	0x08000			;interrupt control register
                                 +1          8          29 
                                 +1          9          30 ;D7 : 1 = Vint allowed / 0 = not allowed
                                 +1         10          31 
                                 +1         11          32 ;D6 : 1 = Hint allowed / 0 = not allowed
                                 +1         12          33 
                                 +1         13          34 
                                 +1         14          35 
  00008010                       +1         15          36 STS_RG_ADD		EQU	0x08010			;2D status register (READ)
                                 +1         16          37 
                                 +1         17          38 ;D7 : 1 = character over / 0 = no character over
                                 +1         18          39 
                                 +1         19          40 ;D6 : 1 = while V blanking / 0 = while in display mode
                                 +1         20          41 
                                 +1         21          42 
                                 +1         22          43 
  00008012                       +1         23          44 LCD_CTR_ADD		EQU	0x08012			;2D control register
                                 +1         24          45 
                                 +1         25          46 ;D7 : 1 = screen color inverse display / 0 = normal display
                                 +1         26          47 
                                 +1         27          48 ;D2Å`D0 : outside window frame color CODE
                                 +1         28          49 
                                 +1         29          50 
                                 +1         30          51 
  00008118                       +1         31          52 BG_COLOR		EQU 0x08118			;Background color register
                                 +1         32          53 
                                 +1         33          54 ;D7`D6: BGON. D7 = 1, D6 = 0: Use specified BG color. Defaults to D7/D6 both 0
                                 +1         34          55 
                                 +1         35          56 ;D2`D0: BG color code
                                 +1         36          57 
                                 +1         37          58 
                                 +1         38          59 
                                 +1         39          60 
  000087E0                       +1         40          61 RESET_ADD		EQU	0X087E0			;2D software reset (WRITE)
                                 +1         41          62 
                                 +1         42          63 ;2D cicuit initialization with "52" write
                                 +1         43          64 
                                 +1         44          65 
                                 +1         45          66 
  000087FE                       +1         46          67 VERSION_ADD		EQU	0x087FE			;2D cicuit version (READ)
                                 +1         47          68 
                                 +1         48          69 ;D7 : 1 = white LCD panel /0 = balck LCD panel 
                                 +1         49          70 
                                 +1         50          71 ;D5Å`D0 : 2D circuit version
                                 +1         51          72 
                                 +1         52          73 
                                 +1         53          74 
                                 +1         54          75 
                                 +1         55          76 
                                 +1         56          77 ;=======================================================
                                 +1         57          78 
                                 +1         58          79 ;		CHARACTER EQU
                                 +1         59          80 
                                 +1         60          81 ;=======================================================
                                 +1         61          82 
  0000A000                       +1         62          83 CHR_VRAM		EQU	0x0A000			;character data RAM address
                                 +1         63          84 
                                 +1         64          85 
                                 +1         65          86 
                                 +1         66          87 
                                 +1         67          88 
                                 +1         68          89 ;=======================================================
                                 +1         69          90 
                                 +1         70          91 ;		SCROLL EQU
                                 +1         71          92 
                                 +1         72          93 ;=======================================================
                                 +1         73          94 
  00009000                       +1         74          95 SCRL1_VRAM		EQU	0x09000
                                 +1         75          96 
  00009800                       +1         76          97 SCRL2_VRAM		EQU	0x09800
                                 +1         77          98 
                                 +1         78          99 
                                 +1         79         100 
  00008030                       +1         80         101 SCRL_PRIO_ADR		EQU	0X08030			;scroll priority level invert register 
                                 +1         81         102 
  00008032                       +1         82         103 SCRL_X1_ADR		EQU	0x08032			;scroll 1 offset H register
                                 +1         83         104 
  00008033                       +1         84         105 SCRL_Y1_ADR		EQU	0x08033			;scroll 1 offset V register
                                 +1         85         106 
  00008034                       +1         86         107 SCRL_X2_ADR		EQU	0x08034			;scroll 2 offset H register
                                 +1         87         108 
  00008035                       +1         88         109 SCRL_Y2_ADR		EQU	0x08035			;scroll 2 offset V register
                                 +1         89         110 
                                 +1         90         111 
                                 +1         91         112 
                                 +1         92         113 ;=======================================================
                                 +1         93         114 
                                 +1         94         115 ;		SPRITE EQU
                                 +1         95         116 
                                 +1         96         117 ;=======================================================
                                 +1         97         118 
  00008800                       +1         98         119 SPR_VRAM		EQU	0x08800
                                 +1         99         120 
  00008020                       +1        100         121 SPR_OFFSET_X_ADR	EQU	0x08020			;sprite offset H
                                 +1        101         122 
  00008021                       +1        102         123 SPR_OFFSET_Y_ADR	EQU	0x08021			;sprite offset V
                                 +1        103         124 
  00008C00                       +1        104         125 SPR_PALCODE EQU 0x8C00 ;what palette # to use for each sprite 
                                 +1        105         126 
                                 +1        106         127 
                                 +1        107         128 
                                 +1        108         129 
                                 +1        109         130 ;=======================================================
                                 +1        110         131 
                                 +1        111         132 ;		WINDOW SYSTEM EQU
                                 +1        112         133 
                                 +1        113         134 ;=======================================================
                                 +1        114         135 
  00008002                       +1        115         136 WIN_WBAX_ADR		EQU	0x08002			;window origin H
                                 +1        116         137 
  00008003                       +1        117         138 WIN_WBAY_ADR		EQU	0x08003			;window origin V
                                 +1        118         139 
  00008004                       +1        119         140 WIN_WSIX_ADR		EQU	0x08004			;window size H
                                 +1        120         141 
  00008005                       +1        121         142 WIN_WSIY_ADR		EQU	0x08005			;window size V
                                 +1        122         143 
                                 +1        123         144 
                                 +1        124         145 
  00008008                       +1        125         146 WD_LCDST_HPOS		EQU	0x08008			;raster H position register (READ)
                                 +1        126         147 
  00008009                       +1        127         148 WD_LCDST_VPOS		EQU	0x08009			;raster V position register (READ)
                                 +1        128         149 
                                 +1        129         150 
                                 +1        130         151 
                                 +1        131         152 ;=======================================================
                                 +1        132         153 
                                 +1        133         154 ;		PALETTE EQU
                                 +1        134         155 
                                 +1        135         156 ;=======================================================
                                 +1        136         157 
                                 +1        137         158 ;sprite palette 0
                                 +1        138         159 
  00008101                       +1        139         160 PL_SPR_00		EQU	0x08101	
                                 +1        140         161 
  00008102                       +1        141         162 PL_SPR_01		EQU	0x08102
                                 +1        142         163 
  00008103                       +1        143         164 PL_SPR_02		EQU	0x08103
                                 +1        144         165 
                                 +1        145         166 ;sprite palette 1
                                 +1        146         167 
  00008105                       +1        147         168 PL_SPR_10		EQU	0x08105
                                 +1        148         169 
  00008106                       +1        149         170 PL_SPR_11		EQU	0x08106
                                 +1        150         171 
  00008107                       +1        151         172 PL_SPR_12		EQU	0x08107
                                 +1        152         173 
                                 +1        153         174 
                                 +1        154         175 
                                 +1        155         176 ;scroll 0 palette 0
                                 +1        156         177 
  00008109                       +1        157         178 PL_SCR0_00		EQU	0x08109
                                 +1        158         179 
  0000810A                       +1        159         180 PL_SCR0_01		EQU	0x0810A
                                 +1        160         181 
  0000810B                       +1        161         182 PL_SCR0_02		EQU	0x0810B
                                 +1        162         183 
                                 +1        163         184 ;scroll 0 palette 1
                                 +1        164         185 
  0000810D                       +1        165         186 PL_SCR0_10		EQU	0x0810D
                                 +1        166         187 
  0000810E                       +1        167         188 PL_SCR0_11		EQU	0x0810E
                                 +1        168         189 
  0000810F                       +1        169         190 PL_SCR0_12		EQU	0x0810F
                                 +1        170         191 
                                 +1        171         192 ;scroll 1 palette 0
                                 +1        172         193 
  00008111                       +1        173         194 PAL_SCR1_00		EQU	0x08111
                                 +1        174         195 
  00008112                       +1        175         196 PAL_SCR1_01		EQU	0x08112
                                 +1        176         197 
  00008113                       +1        177         198 PAL_SCR1_02		EQU	0x08113
                                 +1        178         199 
                                 +1        179         200 ;scroll 1 palette 1
                                 +1        180         201 
  00008115                       +1        181         202 PAL_SCR1_10		EQU	0x08115
                                 +1        182         203 
  00008116                       +1        183         204 PAL_SCR1_11		EQU	0x08116
                                 +1        184         205 
  00008117                       +1        185         206 PAL_SCR1_12		EQU	0x08117
                                 +1        186         207 
                                 +1        187         208 
                                 +1        188         209 ;=======================================================
                                 +1        189         210 
                                 +1        190         211 ;		COLOR PALETTE RAM EQU
                                 +1        191         212 
                                 +1        192         213 ;=======================================================
                                 +1        193         214 
  00008200                       +1        194         215 SPRITE_CRAM		EQU 0x08200
                                 +1        195         216 
  00008280                       +1        196         217 SCROLL1_CRAM	EQU 0x08280
                                 +1        197         218 
  00008300                       +1        198         219 SCROLL2_CRAM	EQU 0x08300
                                 +1        199         220 
  000083E0                       +1        200         221 BGCOL_CRAM		EQU 0x083E0 ;for the background color
                                 +1        201         222 
  000083F0                       +1        202         223 WINDOW_CRAM		EQU 0x083F0
                                 +1        203         224 
                                 +1        204         225 
                                 +1        205         226 ;=======================================================
                                 +1        206         227 
                                 +1        207         228 
                                 +1        208         229 
                                 +0         22         230 	$include "system.inc"
                                 +1          1         231 ;-----------------------------------------------------------------
                                 +1          2         232 
                                 +1          3         233 ;	SYSTEM CALL
                                 +1          4         234 
                                 +1          5         235 ;-----------------------------------------------------------------
                                 +1          6         236 
  00000000                       +1          7         237 SYS_SUCCESS		equ	0x00			;run success
                                 +1          8         238 
  000000FF                       +1          9         239 SYS_FAILURE		equ	0xff			;run failure
                                 +1         10         240 
                                 +1         11         241 ;-----------------------------------------------------------------
                                 +1         12         242 
  00000000                       +1         13         243 VECT_SHUTDOWN		equ	0x00			;shutdown (power OFF)
                                 +1         14         244 
  00000001                       +1         15         245 VECT_CLOCKGEARSET	equ	0x01			;clock gear change
                                 +1         16         246 
  00000002                       +1         17         247 VECT_RTCGET		equ	0x02			;obtain time
                                 +1         18         248 
  00000004                       +1         19         249 VECT_INTLVSET		equ	0x04			;set interrupt level
                                 +1         20         250 
  00000005                       +1         21         251 VECT_SYSFONTSET	equ	0x05			;set system font
                                 +1         22         252 
  00000006                       +1         23         253 VECT_FLASHWRITE	equ	0x06			;flash memory data write
                                 +1         24         254 
  00000007                       +1         25         255 VECT_FLASHALLERS	equ	0x07			;flash memory erase all blocks
                                 +1         26         256 
  00000008                       +1         27         257 VECT_FLASHERS		equ	0x08			;flash memory erase specified blocks
                                 +1         28         258 
  00000009                       +1         29         259 VECT_ALARMSET		equ	0x09			;game alarm setting
                                 +1         30         260 
  0000000B                       +1         31         261 VECT_ALARMDOWNSET	equ	0x0b			;alarm setting during shutdown
                                 +1         32         262 
  0000000D                       +1         33         263 VECT_FLASHPROTECT	equ	0x0d			;protect using tool
                                 +1         34         264 
  0000000E                       +1         35         265 VECT_GEMODESET	equ	0x0e			;switching GE mode
                                 +1         36         266 
                                 +1         37         267 ;-----------------------------------------------------------------
                                 +1         38         268 
                                 +1         39         269 ;	SYSTEM BIT EQU
                                 +1         40         270 
                                 +1         41         271 ;-----------------------------------------------------------------
                                 +1         42         272 
  00000007                       +1         43         273 INT_CLR_BIT		equ	0x07			;interrupt request clear bit
                                 +1         44         274 
  00000080                       +1         45         275 _INT_CLR_BIT		equ	0y10000000		;
                                 +1         46         276 
                                 +1         47         277 ;-----------------------------------------------------------------
                                 +1         48         278 
                                 +1         49         279 ;	SYSTEM WORK
                                 +1         50         280 
                                 +1         51         281 ;-----------------------------------------------------------------
                                 +1         52         282 
  00006F80                       +1         53         283 Battery_Voltage	equ	0x6f80			;estimated voltage
                                 +1         54         284 
  00006F82                       +1         55         285 Sys_lever		equ	0x6f82			;lever value
                                 +1         56         286 
  00006F87                       +1         57         287 Language		equ	0x6f87			;language chosen
                                 +1         58         288 
  00006F85                       +1         59         289 User_Shutdown		equ	0x6f85			;shutdown re1uest bit
                                 +1         60         290 
  00006F84                       +1         61         291 User_Boot		equ	0x6f84			;startup bit flag
                                 +1         62         292 
  00006F86                       +1         63         293 User_Answer		equ	0x6f86			;user request bit
                                 +1         64         294 
  00006F91                       +1         65         295 OS_Version		equ	0x6f91			;system version reserve work
                                 +1         66         296 
                                 +1         67         297 ;-----------------------------------------------------------------
                                 +1         68         298 
                                 +1         69         299 ;	WATCH DOG
                                 +1         70         300 
                                 +1         71         301 ;-----------------------------------------------------------------
                                 +1         72         302 
  0000006F                       +1         73         303 WDCR			equ	0x06F		;watch dog control address
                                 +1         74         304 
  0000004E                       +1         75         305 WD_CLR			equ	0x04e		;watch dog clear code
                                 +1         76         306 
                                 +1         77         307 ;-----------------------------------------------------------------
                                 +1         78         308 
                                 +1         79         309 ;	SYSTEM WORK BIT
                                 +1         80         310 
                                 +1         81         311 ;-----------------------------------------------------------------
                                 +1         82         312 
  00000001                       +1         83         313 JOY_UP 		equ 0x1
  00000002                       +1         84         314 JOY_DOWN 	equ 0x2
  00000004                       +1         85         315 JOY_LEFT 	equ 0x4
  00000008                       +1         86         316 JOY_RIGHT 	equ 0x8
  00000010                       +1         87         317 JOY_A		equ 0x10
  00000020                       +1         88         318 JOY_B		equ 0x20
  00000040                       +1         89         319 JOY_OPTION	equ 0x40
                                 +1         90         320 
  00000000                       +1         91         321 BIT_UP		equ 0
  00000001                       +1         92         322 BIT_DOWN	equ 1
  00000002                       +1         93         323 BIT_LEFT	equ 2
  00000003                       +1         94         324 BIT_RIGHT	equ 3
  00000004                       +1         95         325 BIT_A		equ 4
  00000005                       +1         96         326 BIT_B		equ 5
  00000006                       +1         97         327 BIT_OPTION	equ 6
                                 +1         98         328 
                                 +1         99         329 ;======================================================= 
                                 +1        100         330 
                                 +1        101         331 ;	USER START UP BIT
                                 +1        102         332 
                                 +1        103         333 ;======================================================= 
                                 +1        104         334 
                                 +1        105         335 ;User_Boot
                                 +1        106         336 
                                 +1        107         337 ;	00000000
                                 +1        108         338 
                                 +1        109         339 ;	||+------ resume startup			0:not resume startup		1:resume startup
                                 +1        110         340 
                                 +1        111         341 ;	|+------- POWER startup			0:not POWER startup		1:POWER startup
                                 +1        112         342 
                                 +1        113         343 ;	+-------- alarm startup			0:not alarm statup		1:alarm statup
                                 +1        114         344 
                                 +1        115         345 ;	=================================================
                                 +1        116         346 
                                 +1        117         347 
                                 +1        118         348 
  00000007                       +1        119         349 ALARM_BOOT_REQ		equ	0x07
                                 +1        120         350 
  00000006                       +1        121         351 POWER_BOOT_REQ		equ	0x06
                                 +1        122         352 
  00000005                       +1        123         353 RESUME_BOOT_REQ		equ	0x05
                                 +1        124         354 
  00000080                       +1        125         355 _ALARM_BOOT_REQ		equ	0y10000000
                                 +1        126         356 
  00000040                       +1        127         357 _POWER_BOOT_REQ		equ	0y01000000
                                 +1        128         358 
  00000020                       +1        129         359 _RESUME_BOOT_REQ	equ	0y00100000
                                 +1        130         360 
                                 +1        131         361 
                                 +1        132         362 
                                 +1        133         363 ;======================================================= 
                                 +1        134         364 
                                 +1        135         365 ;	USER SHUTDOWN BIT
                                 +1        136         366 
                                 +1        137         367 ;======================================================= 
                                 +1        138         368 
                                 +1        139         369 ;User_Shutdown
                                 +1        140         370 
                                 +1        141         371 ;	00000000
                                 +1        142         372 
                                 +1        143         373 ;	||+--------- main power use shutdown request	0:no request	1:request
                                 +1        144         374 
                                 +1        145         375 ;	|+---------- no use shutdown request		0:no request	1:request
                                 +1        146         376 
                                 +1        147         377 ;	+----------- power off shutdown request		0:no request	1:request
                                 +1        148         378 
                                 +1        149         379 ;	=================================================
                                 +1        150         380 
                                 +1        151         381 
                                 +1        152         382 
  00000007                       +1        153         383 MP_SHUTDOWN_REQ	equ	0x07
                                 +1        154         384 
  00000006                       +1        155         385 TIME_SHUTDOWN_REQ	equ	0x06
                                 +1        156         386 
  00000005                       +1        157         387 BAT_SHUTDOWN_REQ	equ	0x05
                                 +1        158         388 
  00000080                       +1        159         389 _MP_SHUTDOWN_REQ	equ	0y10000000
                                 +1        160         390 
  00000040                       +1        161         391 _TIME_SHUTDOWN_REQ	equ	0y01000000
                                 +1        162         392 
  00000020                       +1        163         393 _BAT_SHUTDOWN_REQ	equ	0y00100000
                                 +1        164         394 
                                 +1        165         395 
                                 +1        166         396 
                                 +1        167         397 ;======================================================= 
                                 +1        168         398 
                                 +1        169         399 ;	USER ANSWER BIT
                                 +1        170         400 
                                 +1        171         401 ;======================================================= 
                                 +1        172         402 
                                 +1        173         403 ;User_Answer
                                 +1        174         404 
                                 +1        175         405 ;	00000000
                                 +1        176         406 
                                 +1        177         407 ;	|+----------- no use shutdown operation	0:non-existent	1:exists
                                 +1        178         408 
                                 +1        179         409 ;	+------------ resume operation		0:non-existent	1:exists
                                 +1        180         410 
                                 +1        181         411 ;	=================================================
                                 +1        182         412 
                                 +1        183         413 
                                 +1        184         414 
  00000007                       +1        185         415 RESUME_ANS		equ	0x07
                                 +1        186         416 
  00000006                       +1        187         417 TIMER_SHUTDOWN_ANS	equ	0x06
                                 +1        188         418 
  00000080                       +1        189         419 _RESUME_ANS		equ	0y10000000
                                 +1        190         420 
  00000040                       +1        191         421 _TIMER_SHUTDOWN_ANS	equ	0y01000000
                                 +1        192         422 
                                 +0         23         423 	$include "graphics.inc"
                                 +1          1         424 ;*****************************************
                                 +1          2         425 ;	Graphics data 
                                 +1          3         426 ;*****************************************
                                 +1          4         427 
                                 +1          5         428 	extern palette
                                 +1          6         429 	extern palette_end
                                 +1          7         430 	extern tiles
                                 +1          8         431 	extern tiles_end
                                 +1          9         432 	extern map
                                 +1         10         433 	extern map_end
                                 +1         11         434 	extern guy
                                 +1         12         435 	extern guy_end
                                 +1         13         436 	extern guy_pal
                                 +1         14         437 	extern guy_pal_end
                                 +0         24         438 	$include "glbwork.inc"
                                 +1          1         439 ;================================================================
                                 +1          2         440 ; global vars
                                 +1          3         441 ;================================================================
                                 +1          4         442 
                                 +1          5         443 	extern medium start_work
                                 +1          6         444 	extern medium stopper
                                 +1          7         445 	extern medium frame_cnt
                                 +1          8         446 	extern medium screen_x
                                 +1          9         447 	extern medium screen_y
                                 +1         10         448 	
                                 +1         11         449 	extern medium player_x
                                 +1         12         450 	extern medium player_y
                                 +1         13         451 	extern medium player_dx
                                 +1         14         452 	extern medium player_dy
                                 +1         15         453 ;================================================================
                                 +1         16         454 
                                 +0         25         455 	$include "scroll.inc"
                                 +1          1         456 ;-------------------------------------------------------
                                 +1          2         457 ; scroll_set: set scroll to specified coords
                                 +1          3         458 ;-------------------------------------------------------
                                 +1          4         459 ; wa: x pos
                                 +1          5         460 ; bc: y pos
                                 +1          6         461 ;-------------------------------------------------------
                                 +1          7         462 extern scroll_set
                                 +1          8         463 
                                 +1          9         464 ;-------------------------------------------------------
                                 +1         10         465 ; scroll_copy: carry out scroll changes made in scroll_set (run during vblank)
                                 +1         11         466 ;-------------------------------------------------------
                                 +1         12         467 extern scroll_copy
                                 +0         26         468 	
  00000048                       +0         27         469 SPRITE_X equ 72
  00000048                       +0         28         470 SPRITE_Y equ 72
                                 +0         29         471 
                                 +0         30         472 ;-------------------------------------------------------
                                 +0         31         473 PROG section code large
                                 +0         32         474 ;-------------------------------------------------------
                                 +0         33         475 	
                                 +0         34         476 ;-------------------------------------------------------
                                 +0         35         477 ; player_init: initialize player sprite
                                 +0         36         478 ;-------------------------------------------------------	
00000000                         +0         37         479 player_init:
00000000  D8A8                   +0         38         480 	ldw wa,0
00000002  D7E2034800             +0         39         481 	ldw qwa,SPRITE_X
00000007  F1000060             R +0         40         482 	ldl (player_x),xwa
                                 +0         41         483 	
0000000B  D8A8                   +0         42         484 	ldw wa,0
0000000D  D7E2034800             +0         43         485 	ldw qwa,SPRITE_Y
00000012  F1000060             R +0         44         486 	ldl (player_y),xwa
                                 +0         45         487 	
                                 +0         46         488 	;---copy guy sprite---
00000016  F200000035           R +0         47         489 	lda xiy,guy
0000001B  F200000034           R +0         48         490 	lda xix,CHR_VRAM+tiles_end-tiles
00000020  4100000000           R +0         49         491 	ldl xbc,guy_end-guy
00000025  8511                   +0         50         492 	ldir (xix+),(xiy+)
                                 +0         51         493 	;---copy guy palette---
00000027  F200000035           R +0         52         494 	lda xiy,guy_pal
0000002C  F1008234               +0         53         495 	lda xix,SPRITE_CRAM
00000030  4100000000           R +0         54         496 	ldl xbc,guy_pal_end-guy_pal ;should be a ldw but needs to be an ldl
00000035                         +0         55         497 guy_pal_copy:                   ;to appease the assembler
00000035  D5F520                 +0         56         498 	ldw wa,(xiy+)
00000038  F5F150                 +0         57         499 	ldw (xix+),wa
0000003B  D91CF7                 +0         58         500 	djnz bc,guy_pal_copy
                                 +0         59         501 
                                 +0         60         502 	;upper left
0000003E  21A0                   +0         61         503 	ldb a,160 ;tile number
00000040  F1008841               +0         62         504 	ldb (SPR_VRAM),a
00000044  2118                   +0         63         505 	ldb a,0y00011000 ;attributes
00000046  F1018841               +0         64         506 	ldb (SPR_VRAM+1),a
0000004A  2148                   +0         65         507 	ldb a,SPRITE_X ;x position
0000004C  F1028841               +0         66         508 	ldb (SPR_VRAM+2),a
00000050  2148                   +0         67         509 	ldb a,SPRITE_Y
00000052  F1038841               +0         68         510 	ldb (SPR_VRAM+3),a ;y position
00000056  2100                   +0         69         511 	ldb a,0 ;palette number
00000058  F1008C41               +0         70         512 	ldb (SPR_PALCODE),a	
                                 +0         71         513 	;upper right
0000005C  21A1                   +0         72         514 	ldb a,161
0000005E  F1048841               +0         73         515 	ldb (SPR_VRAM+4),a
00000062  211E                   +0         74         516 	ldb a,0y00011110 ;turn on h/v chain
00000064  F1058841               +0         75         517 	ldb (SPR_VRAM+5),a
00000068  2108                   +0         76         518 	ldb a,8 ;offset 8 px from prev sprite on x axis
0000006A  F1068841               +0         77         519 	ldb (SPR_VRAM+6),a
0000006E  2100                   +0         78         520 	ldb a,0
00000070  F1078841               +0         79         521 	ldb (SPR_VRAM+7),a
00000074  2100                   +0         80         522 	ldb a,0
00000076  F1018C41               +0         81         523 	ldb (SPR_PALCODE+1),a
                                 +0         82         524 	;lower left
0000007A  21A2                   +0         83         525 	ldb a,162
0000007C  F1088841               +0         84         526 	ldb (SPR_VRAM+8),a
00000080  211E                   +0         85         527 	ldb a,0y00011110 ;turn on h/v chain
00000082  F1098841               +0         86         528 	ldb (SPR_VRAM+9),a
00000086  21F8                   +0         87         529 	ldb a,248 ;offset -8 px from prev sprite on x axis
00000088  F10A8841               +0         88         530 	ldb (SPR_VRAM+10),a
0000008C  2108                   +0         89         531 	ldb a,8 ;offset 8 px on y axis
0000008E  F10B8841               +0         90         532 	ldb (SPR_VRAM+11),a
00000092  2100                   +0         91         533 	ldb a,0
00000094  F1028C41               +0         92         534 	ldb (SPR_PALCODE+2),a		
                                 +0         93         535 	;lower right
00000098  21A3                   +0         94         536 	ldb a,163
0000009A  F10C8841               +0         95         537 	ldb (SPR_VRAM+12),a
0000009E  211E                   +0         96         538 	ldb a,0y00011110 ;turn on h/v chain
000000A0  F10D8841               +0         97         539 	ldb (SPR_VRAM+13),a
000000A4  2108                   +0         98         540 	ldb a,8 ;offset 8 px from prev sprite on x axis
000000A6  F10E8841               +0         99         541 	ldb (SPR_VRAM+14),a
000000AA  2100                   +0        100         542 	ldb a,0 ;offset 0 px on y axis
000000AC  F10F8841               +0        101         543 	ldb (SPR_VRAM+15),a
000000B0  2100                   +0        102         544 	ldb a,0
000000B2  F1038C41               +0        103         545 	ldb (SPR_PALCODE+3),a
000000B6  0E                     +0        104         546 	ret
                                 +0        105         547 	
  00008000                       +0        106         548 PLAYER_ACCEL equ 0x8000
  00040000                       +0        107         549 MAX_SPEED equ 0x40000
                                 +0        108         550 ;-------------------------------------------------------
                                 +0        109         551 ; player_move: handle player movement
                                 +0        110         552 ;-------------------------------------------------------
000000B7                         +0        111         553 player_move:
                                 +0        112         554 	;---horizontal movement---
000000B7  C1826F21               +0        113         555 	ldb a,(Sys_lever)
000000BB  E1000021             R +0        114         556 	ldl xbc,(player_dx)
000000BF  C93302                 +0        115         557 	bit BIT_LEFT,a
000000C2  660E                   +0        116         558 	j z,not_left
000000C4  E9CF0000FCFF           +0        117         559 	cpl xbc,-MAX_SPEED
000000CA  6506                   +0        118         560 	j mi,not_left
000000CC  E9CA00800000           +0        119         561 	subl xbc,PLAYER_ACCEL
000000D2                         +0        120         562 not_left:
000000D2  C93303                 +0        121         563 	bit BIT_RIGHT,a
000000D5  660E                   +0        122         564 	j z,not_right
000000D7  E9CF00000400           +0        123         565 	cpl xbc,MAX_SPEED
000000DD  6D06                   +0        124         566 	j pl,not_right
000000DF  E9C800800000           +0        125         567 	addl xbc,PLAYER_ACCEL
000000E5                         +0        126         568 not_right:
                                 +0        127         569 	;---if we're not pressing left or right, decelerate---
000000E5  C1826F21               +0        128         570 	ldb a,(Sys_lever)
000000E9  C9CC0C                 +0        129         571 	andb a,JOY_LEFT | JOY_RIGHT
000000EC  6E2E                   +0        130         572 	j nz,no_decel
000000EE  E9CF00000000           +0        131         573 	cpl xbc,0
000000F4  6626                   +0        132         574 	j z,no_decel ;if player_dx is 0, don't have to decelerate
000000F6  6D02                   +0        133         575 	j pl,decel_right
000000F8  6512                   +0        134         576 	j mi,decel_left
000000FA                         +0        135         577 decel_right:
000000FA  E9CA00800000           +0        136         578 	subl xbc,PLAYER_ACCEL
                                 +0        137         579 	;if value goes under 0, make it 0
00000100  E9CF00000000           +0        138         580 	cpl xbc,0
00000106  6D14                   +0        139         581 	j pl,no_decel
00000108  E9A8                   +0        140         582 	ldl xbc,0
0000010A  6810                   +0        141         583 	j no_decel
0000010C                         +0        142         584 decel_left:
0000010C  E9C800800000           +0        143         585 	addl xbc,PLAYER_ACCEL
                                 +0        144         586 	;if value goes over 0, make it 0
00000112  E9CF00000000           +0        145         587 	cpl xbc,0
00000118  6502                   +0        146         588 	j mi,no_decel
0000011A  E9A8                   +0        147         589 	ldl xbc,0
0000011C                         +0        148         590 no_decel:	
0000011C  E1000020             R +0        149         591 	ldl xwa,(player_x)
00000120  F1000061             R +0        150         592 	ldl (player_dx),xbc
00000124  E980                   +0        151         593 	addl xwa,xbc
00000126  F1000060             R +0        152         594 	ldl (player_x),xwa	
                                 +0        153         595 	
0000012A  D1000020             R +0        154         596 	ldw wa,(player_x+2) ;move pixel portion of x coord into wa
0000012E  D8CA4800               +0        155         597 	subw wa,SPRITE_X
00000132  D1000021             R +0        156         598 	ldw bc,(player_y+2)
00000136  D9CA4800               +0        157         599 	subw bc,SPRITE_Y
0000013A  1D000000             R +0        158         600 	cal scroll_set
0000013E  0E                     +0        159         601 	ret
                                 +0        160         602 	
                                 +0        161         603 	
                                 +0        162         604 ;-------------------------------------------------------
                                 +0        163         605 	end
                                 +0        164         606 ;-------------------------------------------------------

Assembly complete, No error
TLCS-900 Relocatable Assembler (32) V2.2k  [Page     2]  player.lst

Symbol table listing
--------------------

Symbol           Category         Value     Attribute

ALARM_BOOT_REQ           NUM      00000007  A           
BAT_SHUTDOWN_REQ
                         NUM      00000005  A           
BGCOL_CRAM               NUM      000083E0  A           
BG_COLOR                 NUM      00008118  A           
BIT_A                    NUM      00000004  A           
BIT_B                    NUM      00000005  A           
BIT_DOWN                 NUM      00000001  A           
BIT_LEFT                 NUM      00000002  A           
BIT_OPTION               NUM      00000006  A           
BIT_RIGHT                NUM      00000003  A           
BIT_UP                   NUM      00000000  A           
Battery_Voltage          NUM      00006F80  A           
CHR_VRAM                 NUM      0000A000  A           
DISP_CTL0                NUM      00008000  A           
INT_CLR_BIT              NUM      00000007  A           
JOY_A                    NUM      00000010  A           
JOY_B                    NUM      00000020  A           
JOY_DOWN                 NUM      00000002  A           
JOY_LEFT                 NUM      00000004  A           
JOY_OPTION               NUM      00000040  A           
JOY_RIGHT                NUM      00000008  A           
JOY_UP                   NUM      00000001  A           
LCD_CTR_ADD              NUM      00008012  A           
Language                 NUM      00006F87  A           
MAX_SPEED                NUM      00040000  A           
MP_SHUTDOWN_REQ          NUM      00000007  A           
OS_Version               NUM      00006F91  A           
PAL_SCR1_00              NUM      00008111  A           
PAL_SCR1_01              NUM      00008112  A           
PAL_SCR1_02              NUM      00008113  A           
PAL_SCR1_10              NUM      00008115  A           
PAL_SCR1_11              NUM      00008116  A           
PAL_SCR1_12              NUM      00008117  A           
PLAYER_ACCEL             NUM      00008000  A           
PL_SCR0_00               NUM      00008109  A           
PL_SCR0_01               NUM      0000810A  A           
PL_SCR0_02               NUM      0000810B  A           
PL_SCR0_10               NUM      0000810D  A           
PL_SCR0_11               NUM      0000810E  A           
PL_SCR0_12               NUM      0000810F  A           
PL_SPR_00                NUM      00008101  A           
PL_SPR_01                NUM      00008102  A           
PL_SPR_02                NUM      00008103  A           
PL_SPR_10                NUM      00008105  A           
PL_SPR_11                NUM      00008106  A           
PL_SPR_12                NUM      00008107  A           
POWER_BOOT_REQ           NUM      00000006  A           
PROG             C L     SEC      00000000  R 13F       
RESET_ADD                NUM      000087E0  A           
RESUME_ANS               NUM      00000007  A           
RESUME_BOOT_REQ          NUM      00000005  A           
SCRL1_VRAM               NUM      00009000  A           
SCRL2_VRAM               NUM      00009800  A           
SCRL_PRIO_ADR            NUM      00008030  A           
SCRL_X1_ADR              NUM      00008032  A           
SCRL_X2_ADR              NUM      00008034  A           
SCRL_Y1_ADR              NUM      00008033  A           
SCRL_Y2_ADR              NUM      00008035  A           
SCROLL1_CRAM             NUM      00008280  A           
SCROLL2_CRAM             NUM      00008300  A           
SPRITE_CRAM              NUM      00008200  A           
SPRITE_X                 NUM      00000048  A           
SPRITE_Y                 NUM      00000048  A           
SPR_OFFSET_X_ADR
                         NUM      00008020  A           
SPR_OFFSET_Y_ADR
                         NUM      00008021  A           
SPR_PALCODE              NUM      00008C00  A           
SPR_VRAM                 NUM      00008800  A           
STS_RG_ADD               NUM      00008010  A           
SYS_FAILURE              NUM      000000FF  A           
SYS_SUCCESS              NUM      00000000  A           
Sys_lever                NUM      00006F82  A           
TIMER_SHUTDOWN_ANS
                         NUM      00000006  A           
TIME_SHUTDOWN_REQ
                         NUM      00000006  A           
User_Answer              NUM      00006F86  A           
User_Boot                NUM      00006F84  A           
User_Shutdown            NUM      00006F85  A           
VECT_ALARMDOWNSET
                         NUM      0000000B  A           
VECT_ALARMSET            NUM      00000009  A           
VECT_CLOCKGEARSET
                         NUM      00000001  A           
VECT_FLASHALLERS
                         NUM      00000007  A           
VECT_FLASHERS            NUM      00000008  A           
VECT_FLASHPROTECT
                         NUM      0000000D  A           
VECT_FLASHWRITE          NUM      00000006  A           
VECT_GEMODESET           NUM      0000000E  A           
VECT_INTLVSET            NUM      00000004  A           
VECT_RTCGET              NUM      00000002  A           
VECT_SHUTDOWN            NUM      00000000  A           
VECT_SYSFONTSET          NUM      00000005  A           
VERSION_ADD              NUM      000087FE  A           
WDCR                     NUM      0000006F  A           
WD_CLR                   NUM      0000004E  A           
WD_LCDST_HPOS            NUM      00008008  A           
WD_LCDST_VPOS            NUM      00008009  A           
WINDOW_CRAM              NUM      000083F0  A           
WIN_WBAX_ADR             NUM      00008002  A           
WIN_WBAY_ADR             NUM      00008003  A           
WIN_WSIX_ADR             NUM      00008004  A           
WIN_WSIY_ADR             NUM      00008005  A           
_ALARM_BOOT_REQ          NUM      00000080  A           
_BAT_SHUTDOWN_REQ
                         NUM      00000020  A           
_INT_CLR_BIT             NUM      00000080  A           
_MP_SHUTDOWN_REQ
                         NUM      00000080  A           
_POWER_BOOT_REQ          NUM      00000040  A           
_RESUME_ANS              NUM      00000080  A           
_RESUME_BOOT_REQ
                         NUM      00000020  A           
_TIMER_SHUTDOWN_ANS
                         NUM      00000040  A           
_TIME_SHUTDOWN_REQ
                         NUM      00000040  A           
decel_left       C L     LAB      0000010C  R           PROG
decel_right      C L     LAB      000000FA  R           PROG
guy                               00000000  R EXT       
guy_end                           00000000  R EXT       
guy_pal                           00000000  R EXT       
guy_pal_copy     C L     LAB      00000035  R           PROG
guy_pal_end                       00000000  R EXT       
no_decel         C L     LAB      0000011C  R           PROG
not_left         C L     LAB      000000D2  R           PROG
not_right        C L     LAB      000000E5  R           PROG
player                   MOD
player_dx                         00000000  R EXT       
player_init      C L     LAB      00000000  R PUB       PROG
player_move      C L     LAB      000000B7  R PUB       PROG
player_x                          00000000  R EXT       
player_y                          00000000  R EXT       
scroll_set                        00000000  R EXT       
tiles                             00000000  R EXT       
tiles_end                         00000000  R EXT       


TOTAL
  126 user defined symbol(s)
   11 unreferenced external symbol(s)
