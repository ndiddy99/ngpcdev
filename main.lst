(C)Copyright TOSHIBA CORPORATION 1993-2009  All rights reserved
Tue Jun 09 21:04:20 2020
TLCS-900 Relocatable Assembler (32) V2.2k  [Page     1]  main.lst
Runtime option : c:\Program Files (x86)\TOSHIBA\T900\bin\asm900.exe -Nb2 -O1 -g -l main.asm

Location  Object                           Ins        Line Source Statement

                                 +0          1           1 ;*****************************************
                                 +0          2           2 ;	Main Program 
                                 +0          3           3 ;*****************************************
                                 +0          4           4 	$MAXIMUM
                                 +0          5           5 	module game_main
                                 +0          6           6 
                                 +0          7           7 ;  ---------------------------------
                                 +0          8           8 ;	EXTERNAL LOOK UP
                                 +0          9           9 ;  ---------------------------------
                                 +0         10          10 	extern SYS_PATCH
                                 +0         11          11 	extern SYSTEM_CALL
                                 +0         12          12 	extern init_setting
                                 +0         13          13 
                                 +0         14          14 ;  ---------------------------------
                                 +0         15          15 ;   EXTERNAL DEFINITION
                                 +0         16          16 ;  ---------------------------------
                                 +0         17          17 	public reset,v_int,h_int,dummy,timer1,timer2
                                 +0         18          18 	public alarm_int,z80_int,sound_int
                                 +0         19          19 
                                 +0         20          20 ;  ---------------------------------
                                 +0         21          21 ;	INCLUDE
                                 +0         22          22 ;  ---------------------------------
                                 +0         23          23 	$include "system.inc"
                                 +1          1          24 ;-----------------------------------------------------------------
                                 +1          2          25 
                                 +1          3          26 ;	SYSTEM CALL
                                 +1          4          27 
                                 +1          5          28 ;-----------------------------------------------------------------
                                 +1          6          29 
  00000000                       +1          7          30 SYS_SUCCESS		equ	0x00			;run success
                                 +1          8          31 
  000000FF                       +1          9          32 SYS_FAILURE		equ	0xff			;run failure
                                 +1         10          33 
                                 +1         11          34 ;-----------------------------------------------------------------
                                 +1         12          35 
  00000000                       +1         13          36 VECT_SHUTDOWN		equ	0x00			;shutdown (power OFF)
                                 +1         14          37 
  00000001                       +1         15          38 VECT_CLOCKGEARSET	equ	0x01			;clock gear change
                                 +1         16          39 
  00000002                       +1         17          40 VECT_RTCGET		equ	0x02			;obtain time
                                 +1         18          41 
  00000004                       +1         19          42 VECT_INTLVSET		equ	0x04			;set interrupt level
                                 +1         20          43 
  00000005                       +1         21          44 VECT_SYSFONTSET	equ	0x05			;set system font
                                 +1         22          45 
  00000006                       +1         23          46 VECT_FLASHWRITE	equ	0x06			;flash memory data write
                                 +1         24          47 
  00000007                       +1         25          48 VECT_FLASHALLERS	equ	0x07			;flash memory erase all blocks
                                 +1         26          49 
  00000008                       +1         27          50 VECT_FLASHERS		equ	0x08			;flash memory erase specified blocks
                                 +1         28          51 
  00000009                       +1         29          52 VECT_ALARMSET		equ	0x09			;game alarm setting
                                 +1         30          53 
  0000000B                       +1         31          54 VECT_ALARMDOWNSET	equ	0x0b			;alarm setting during shutdown
                                 +1         32          55 
  0000000D                       +1         33          56 VECT_FLASHPROTECT	equ	0x0d			;protect using tool
                                 +1         34          57 
  0000000E                       +1         35          58 VECT_GEMODESET	equ	0x0e			;switching GE mode
                                 +1         36          59 
                                 +1         37          60 ;-----------------------------------------------------------------
                                 +1         38          61 
                                 +1         39          62 ;	SYSTEM BIT EQU
                                 +1         40          63 
                                 +1         41          64 ;-----------------------------------------------------------------
                                 +1         42          65 
  00000007                       +1         43          66 INT_CLR_BIT		equ	0x07			;interrupt request clear bit
                                 +1         44          67 
  00000080                       +1         45          68 _INT_CLR_BIT		equ	0y10000000		;
                                 +1         46          69 
                                 +1         47          70 ;-----------------------------------------------------------------
                                 +1         48          71 
                                 +1         49          72 ;	SYSTEM WORK
                                 +1         50          73 
                                 +1         51          74 ;-----------------------------------------------------------------
                                 +1         52          75 
  00006F80                       +1         53          76 Battery_Voltage	equ	0x6f80			;estimated voltage
                                 +1         54          77 
  00006F82                       +1         55          78 Sys_lever		equ	0x6f82			;lever value
                                 +1         56          79 
  00006F87                       +1         57          80 Language		equ	0x6f87			;language chosen
                                 +1         58          81 
  00006F85                       +1         59          82 User_Shutdown		equ	0x6f85			;shutdown re1uest bit
                                 +1         60          83 
  00006F84                       +1         61          84 User_Boot		equ	0x6f84			;startup bit flag
                                 +1         62          85 
  00006F86                       +1         63          86 User_Answer		equ	0x6f86			;user request bit
                                 +1         64          87 
  00006F91                       +1         65          88 OS_Version		equ	0x6f91			;system version reserve work
                                 +1         66          89 
                                 +1         67          90 ;-----------------------------------------------------------------
                                 +1         68          91 
                                 +1         69          92 ;	WATCH DOG
                                 +1         70          93 
                                 +1         71          94 ;-----------------------------------------------------------------
                                 +1         72          95 
  0000006F                       +1         73          96 WDCR			equ	0x06F		;watch dog control address
                                 +1         74          97 
  0000004E                       +1         75          98 WD_CLR			equ	0x04e		;watch dog clear code
                                 +1         76          99 
                                 +1         77         100 ;-----------------------------------------------------------------
                                 +1         78         101 
                                 +1         79         102 ;	SYSTEM WORK BIT
                                 +1         80         103 
                                 +1         81         104 ;-----------------------------------------------------------------
                                 +1         82         105 
  00000001                       +1         83         106 JOY_UP 		equ 0x1
  00000002                       +1         84         107 JOY_DOWN 	equ 0x2
  00000004                       +1         85         108 JOY_LEFT 	equ 0x4
  00000008                       +1         86         109 JOY_RIGHT 	equ 0x8
  00000010                       +1         87         110 JOY_A		equ 0x10
  00000020                       +1         88         111 JOY_B		equ 0x20
  00000040                       +1         89         112 JOY_OPTION	equ 0x40
                                 +1         90         113 
  00000000                       +1         91         114 BIT_UP		equ 0
  00000001                       +1         92         115 BIT_DOWN	equ 1
  00000002                       +1         93         116 BIT_LEFT	equ 2
  00000003                       +1         94         117 BIT_RIGHT	equ 3
  00000004                       +1         95         118 BIT_A		equ 4
  00000005                       +1         96         119 BIT_B		equ 5
  00000006                       +1         97         120 BIT_OPTION	equ 6
                                 +1         98         121 
                                 +1         99         122 ;======================================================= 
                                 +1        100         123 
                                 +1        101         124 ;	USER START UP BIT
                                 +1        102         125 
                                 +1        103         126 ;======================================================= 
                                 +1        104         127 
                                 +1        105         128 ;User_Boot
                                 +1        106         129 
                                 +1        107         130 ;	00000000
                                 +1        108         131 
                                 +1        109         132 ;	||+------ resume startup			0:not resume startup		1:resume startup
                                 +1        110         133 
                                 +1        111         134 ;	|+------- POWER startup			0:not POWER startup		1:POWER startup
                                 +1        112         135 
                                 +1        113         136 ;	+-------- alarm startup			0:not alarm statup		1:alarm statup
                                 +1        114         137 
                                 +1        115         138 ;	=================================================
                                 +1        116         139 
                                 +1        117         140 
                                 +1        118         141 
  00000007                       +1        119         142 ALARM_BOOT_REQ		equ	0x07
                                 +1        120         143 
  00000006                       +1        121         144 POWER_BOOT_REQ		equ	0x06
                                 +1        122         145 
  00000005                       +1        123         146 RESUME_BOOT_REQ		equ	0x05
                                 +1        124         147 
  00000080                       +1        125         148 _ALARM_BOOT_REQ		equ	0y10000000
                                 +1        126         149 
  00000040                       +1        127         150 _POWER_BOOT_REQ		equ	0y01000000
                                 +1        128         151 
  00000020                       +1        129         152 _RESUME_BOOT_REQ	equ	0y00100000
                                 +1        130         153 
                                 +1        131         154 
                                 +1        132         155 
                                 +1        133         156 ;======================================================= 
                                 +1        134         157 
                                 +1        135         158 ;	USER SHUTDOWN BIT
                                 +1        136         159 
                                 +1        137         160 ;======================================================= 
                                 +1        138         161 
                                 +1        139         162 ;User_Shutdown
                                 +1        140         163 
                                 +1        141         164 ;	00000000
                                 +1        142         165 
                                 +1        143         166 ;	||+--------- main power use shutdown request	0:no request	1:request
                                 +1        144         167 
                                 +1        145         168 ;	|+---------- no use shutdown request		0:no request	1:request
                                 +1        146         169 
                                 +1        147         170 ;	+----------- power off shutdown request		0:no request	1:request
                                 +1        148         171 
                                 +1        149         172 ;	=================================================
                                 +1        150         173 
                                 +1        151         174 
                                 +1        152         175 
  00000007                       +1        153         176 MP_SHUTDOWN_REQ	equ	0x07
                                 +1        154         177 
  00000006                       +1        155         178 TIME_SHUTDOWN_REQ	equ	0x06
                                 +1        156         179 
  00000005                       +1        157         180 BAT_SHUTDOWN_REQ	equ	0x05
                                 +1        158         181 
  00000080                       +1        159         182 _MP_SHUTDOWN_REQ	equ	0y10000000
                                 +1        160         183 
  00000040                       +1        161         184 _TIME_SHUTDOWN_REQ	equ	0y01000000
                                 +1        162         185 
  00000020                       +1        163         186 _BAT_SHUTDOWN_REQ	equ	0y00100000
                                 +1        164         187 
                                 +1        165         188 
                                 +1        166         189 
                                 +1        167         190 ;======================================================= 
                                 +1        168         191 
                                 +1        169         192 ;	USER ANSWER BIT
                                 +1        170         193 
                                 +1        171         194 ;======================================================= 
                                 +1        172         195 
                                 +1        173         196 ;User_Answer
                                 +1        174         197 
                                 +1        175         198 ;	00000000
                                 +1        176         199 
                                 +1        177         200 ;	|+----------- no use shutdown operation	0:non-existent	1:exists
                                 +1        178         201 
                                 +1        179         202 ;	+------------ resume operation		0:non-existent	1:exists
                                 +1        180         203 
                                 +1        181         204 ;	=================================================
                                 +1        182         205 
                                 +1        183         206 
                                 +1        184         207 
  00000007                       +1        185         208 RESUME_ANS		equ	0x07
                                 +1        186         209 
  00000006                       +1        187         210 TIMER_SHUTDOWN_ANS	equ	0x06
                                 +1        188         211 
  00000080                       +1        189         212 _RESUME_ANS		equ	0y10000000
                                 +1        190         213 
  00000040                       +1        191         214 _TIMER_SHUTDOWN_ANS	equ	0y01000000
                                 +1        192         215 
                                 +0         24         216 	$include "k1head.inc"
                                 +1          1         217 ;=======================================================
                                 +1          2         218 
                                 +1          3         219 ;		SYSTEM RELATED EQU
                                 +1          4         220 
                                 +1          5         221 ;=======================================================
                                 +1          6         222 
  00008000                       +1          7         223 DISP_CTL0		EQU	0x08000			;interrupt control register
                                 +1          8         224 
                                 +1          9         225 ;D7 : 1 = Vint allowed / 0 = not allowed
                                 +1         10         226 
                                 +1         11         227 ;D6 : 1 = Hint allowed / 0 = not allowed
                                 +1         12         228 
                                 +1         13         229 
                                 +1         14         230 
  00008010                       +1         15         231 STS_RG_ADD		EQU	0x08010			;2D status register (READ)
                                 +1         16         232 
                                 +1         17         233 ;D7 : 1 = character over / 0 = no character over
                                 +1         18         234 
                                 +1         19         235 ;D6 : 1 = while V blanking / 0 = while in display mode
                                 +1         20         236 
                                 +1         21         237 
                                 +1         22         238 
  00008012                       +1         23         239 LCD_CTR_ADD		EQU	0x08012			;2D control register
                                 +1         24         240 
                                 +1         25         241 ;D7 : 1 = screen color inverse display / 0 = normal display
                                 +1         26         242 
                                 +1         27         243 ;D2Å`D0 : outside window frame color CODE
                                 +1         28         244 
                                 +1         29         245 
                                 +1         30         246 
  00008118                       +1         31         247 BG_COLOR		EQU 0x08118			;Background color register
                                 +1         32         248 
                                 +1         33         249 ;D7`D6: BGON. D7 = 1, D6 = 0: Use specified BG color. Defaults to D7/D6 both 0
                                 +1         34         250 
                                 +1         35         251 ;D2`D0: BG color code
                                 +1         36         252 
                                 +1         37         253 
                                 +1         38         254 
                                 +1         39         255 
  000087E0                       +1         40         256 RESET_ADD		EQU	0X087E0			;2D software reset (WRITE)
                                 +1         41         257 
                                 +1         42         258 ;2D cicuit initialization with "52" write
                                 +1         43         259 
                                 +1         44         260 
                                 +1         45         261 
  000087FE                       +1         46         262 VERSION_ADD		EQU	0x087FE			;2D cicuit version (READ)
                                 +1         47         263 
                                 +1         48         264 ;D7 : 1 = white LCD panel /0 = balck LCD panel 
                                 +1         49         265 
                                 +1         50         266 ;D5Å`D0 : 2D circuit version
                                 +1         51         267 
                                 +1         52         268 
                                 +1         53         269 
                                 +1         54         270 
                                 +1         55         271 
                                 +1         56         272 ;=======================================================
                                 +1         57         273 
                                 +1         58         274 ;		CHARACTER EQU
                                 +1         59         275 
                                 +1         60         276 ;=======================================================
                                 +1         61         277 
  0000A000                       +1         62         278 CHR_VRAM		EQU	0x0A000			;character data RAM address
                                 +1         63         279 
                                 +1         64         280 
                                 +1         65         281 
                                 +1         66         282 
                                 +1         67         283 
                                 +1         68         284 ;=======================================================
                                 +1         69         285 
                                 +1         70         286 ;		SCROLL EQU
                                 +1         71         287 
                                 +1         72         288 ;=======================================================
                                 +1         73         289 
  00009000                       +1         74         290 SCRL1_VRAM		EQU	0x09000
                                 +1         75         291 
  00009800                       +1         76         292 SCRL2_VRAM		EQU	0x09800
                                 +1         77         293 
                                 +1         78         294 
                                 +1         79         295 
  00008030                       +1         80         296 SCRL_PRIO_ADR		EQU	0X08030			;scroll priority level invert register 
                                 +1         81         297 
  00008032                       +1         82         298 SCRL_X1_ADR		EQU	0x08032			;scroll 1 offset H register
                                 +1         83         299 
  00008033                       +1         84         300 SCRL_Y1_ADR		EQU	0x08033			;scroll 1 offset V register
                                 +1         85         301 
  00008034                       +1         86         302 SCRL_X2_ADR		EQU	0x08034			;scroll 2 offset H register
                                 +1         87         303 
  00008035                       +1         88         304 SCRL_Y2_ADR		EQU	0x08035			;scroll 2 offset V register
                                 +1         89         305 
                                 +1         90         306 
                                 +1         91         307 
                                 +1         92         308 ;=======================================================
                                 +1         93         309 
                                 +1         94         310 ;		SPRITE EQU
                                 +1         95         311 
                                 +1         96         312 ;=======================================================
                                 +1         97         313 
  00008800                       +1         98         314 SPR_VRAM		EQU	0x08800
                                 +1         99         315 
  00008020                       +1        100         316 SPR_OFFSET_X_ADR	EQU	0x08020			;sprite offset H
                                 +1        101         317 
  00008021                       +1        102         318 SPR_OFFSET_Y_ADR	EQU	0x08021			;sprite offset V
                                 +1        103         319 
  00008C00                       +1        104         320 SPR_PALCODE EQU 0x8C00 ;what palette # to use for each sprite 
                                 +1        105         321 
                                 +1        106         322 
                                 +1        107         323 
                                 +1        108         324 
                                 +1        109         325 ;=======================================================
                                 +1        110         326 
                                 +1        111         327 ;		WINDOW SYSTEM EQU
                                 +1        112         328 
                                 +1        113         329 ;=======================================================
                                 +1        114         330 
  00008002                       +1        115         331 WIN_WBAX_ADR		EQU	0x08002			;window origin H
                                 +1        116         332 
  00008003                       +1        117         333 WIN_WBAY_ADR		EQU	0x08003			;window origin V
                                 +1        118         334 
  00008004                       +1        119         335 WIN_WSIX_ADR		EQU	0x08004			;window size H
                                 +1        120         336 
  00008005                       +1        121         337 WIN_WSIY_ADR		EQU	0x08005			;window size V
                                 +1        122         338 
                                 +1        123         339 
                                 +1        124         340 
  00008008                       +1        125         341 WD_LCDST_HPOS		EQU	0x08008			;raster H position register (READ)
                                 +1        126         342 
  00008009                       +1        127         343 WD_LCDST_VPOS		EQU	0x08009			;raster V position register (READ)
                                 +1        128         344 
                                 +1        129         345 
                                 +1        130         346 
                                 +1        131         347 ;=======================================================
                                 +1        132         348 
                                 +1        133         349 ;		PALETTE EQU
                                 +1        134         350 
                                 +1        135         351 ;=======================================================
                                 +1        136         352 
                                 +1        137         353 ;sprite palette 0
                                 +1        138         354 
  00008101                       +1        139         355 PL_SPR_00		EQU	0x08101	
                                 +1        140         356 
  00008102                       +1        141         357 PL_SPR_01		EQU	0x08102
                                 +1        142         358 
  00008103                       +1        143         359 PL_SPR_02		EQU	0x08103
                                 +1        144         360 
                                 +1        145         361 ;sprite palette 1
                                 +1        146         362 
  00008105                       +1        147         363 PL_SPR_10		EQU	0x08105
                                 +1        148         364 
  00008106                       +1        149         365 PL_SPR_11		EQU	0x08106
                                 +1        150         366 
  00008107                       +1        151         367 PL_SPR_12		EQU	0x08107
                                 +1        152         368 
                                 +1        153         369 
                                 +1        154         370 
                                 +1        155         371 ;scroll 0 palette 0
                                 +1        156         372 
  00008109                       +1        157         373 PL_SCR0_00		EQU	0x08109
                                 +1        158         374 
  0000810A                       +1        159         375 PL_SCR0_01		EQU	0x0810A
                                 +1        160         376 
  0000810B                       +1        161         377 PL_SCR0_02		EQU	0x0810B
                                 +1        162         378 
                                 +1        163         379 ;scroll 0 palette 1
                                 +1        164         380 
  0000810D                       +1        165         381 PL_SCR0_10		EQU	0x0810D
                                 +1        166         382 
  0000810E                       +1        167         383 PL_SCR0_11		EQU	0x0810E
                                 +1        168         384 
  0000810F                       +1        169         385 PL_SCR0_12		EQU	0x0810F
                                 +1        170         386 
                                 +1        171         387 ;scroll 1 palette 0
                                 +1        172         388 
  00008111                       +1        173         389 PAL_SCR1_00		EQU	0x08111
                                 +1        174         390 
  00008112                       +1        175         391 PAL_SCR1_01		EQU	0x08112
                                 +1        176         392 
  00008113                       +1        177         393 PAL_SCR1_02		EQU	0x08113
                                 +1        178         394 
                                 +1        179         395 ;scroll 1 palette 1
                                 +1        180         396 
  00008115                       +1        181         397 PAL_SCR1_10		EQU	0x08115
                                 +1        182         398 
  00008116                       +1        183         399 PAL_SCR1_11		EQU	0x08116
                                 +1        184         400 
  00008117                       +1        185         401 PAL_SCR1_12		EQU	0x08117
                                 +1        186         402 
                                 +1        187         403 
                                 +1        188         404 ;=======================================================
                                 +1        189         405 
                                 +1        190         406 ;		COLOR PALETTE RAM EQU
                                 +1        191         407 
                                 +1        192         408 ;=======================================================
                                 +1        193         409 
  00008200                       +1        194         410 SPRITE_CRAM		EQU 0x08200
                                 +1        195         411 
  00008280                       +1        196         412 SCROLL1_CRAM	EQU 0x08280
                                 +1        197         413 
  00008300                       +1        198         414 SCROLL2_CRAM	EQU 0x08300
                                 +1        199         415 
  000083E0                       +1        200         416 BGCOL_CRAM		EQU 0x083E0 ;for the background color
                                 +1        201         417 
  000083F0                       +1        202         418 WINDOW_CRAM		EQU 0x083F0
                                 +1        203         419 
                                 +1        204         420 
                                 +1        205         421 ;=======================================================
                                 +1        206         422 
                                 +1        207         423 ;		TIMER EQU
                                 +1        208         424 
                                 +1        209         425 ;=======================================================
                                 +1        210         426 
  00000020                       +1        211         427 T8RUN	EQU 0x0020 ;bitmask controlling 8 bit timers
                                 +1        212         428 
                                 +1        213         429 
                                 +1        214         430 
                                 +1        215         431 ;=======================================================
                                 +0         25         432 	$include "tlcs900.inc"
                                 +1          1         433 ;=======================================================
                                 +1          2         434 
                                 +1          3         435 ;		TLCS-900 CPU Equates
                                 +1          4         436 
                                 +1          5         437 ;=======================================================
                                 +1          6         438 
  00000020                       +1          7         439 TRUN            equ     0x0020   ; Timer Operation Control
  00000022                       +1          8         440 TREG0           equ     0x0022   ; Timer Register 0
  00000023                       +1          9         441 TREG1           equ     0x0023   ; Timer Register 1
  00000024                       +1         10         442 TMOD            equ     0x0024   ; Timer Mode Control
  00000025                       +1         11         443 TFFCF           equ     0x0025   ; Timer Flip-Flop Control
  00000026                       +1         12         444 TREG2           equ     0x0026   ; Timer Register 2
  00000027                       +1         13         445 TREG3           equ     0x0027   ; Timer Register 3
  00000028                       +1         14         446 P0MOD           equ     0x0028   ; 8-Bit PWM 0 Mode Control
  00000029                       +1         15         447 P1MOD           equ     0x0029   ; 8-Bit PWM 1 Mode Control
  0000002A                       +1         16         448 PFFCR           equ     0x002A   ; 8-Bit PWM Flip-Flop Control
                                 +1         17         449 
  00000030                       +1         18         450 TREG4L          equ     0x0030   ; Timer 4 Low Byte
  00000031                       +1         19         451 TREG4H          equ     0x0031   ; Timer 4 High Byte
  00000032                       +1         20         452 TREG5L          equ     0x0032   ; Timer 5 Low Byte
  00000033                       +1         21         453 TREG5H          equ     0x0033   ; Timer 5 High Byte
  00000034                       +1         22         454 CAP1L           equ     0x0034   ; Capture 1 Low Byte
  00000035                       +1         23         455 CAP1H           equ     0x0035   ; Capture 1 High Byte
  00000036                       +1         24         456 CAP2L           equ     0x0036   ; Capture 2 Low Byte
  00000037                       +1         25         457 CAP2H           equ     0x0037   ; Capture 2 High Byte
  00000038                       +1         26         458 T4MOD           equ     0x0038   ; 16-Bit Timer 4 Mode Control
  00000039                       +1         27         459 T4FFCR          equ     0x0039   ; 16-Bit Timer 4 Flip-Flop Control
  0000003A                       +1         28         460 T45CR           equ     0x003A   ; 16-Bit Timer 4/5 Control
                                 +1         29         461 
  00000040                       +1         30         462 TREG6L          equ     0x0040   ; Timer 6 Low Byte
  00000041                       +1         31         463 TREG6H          equ     0x0041   ; Timer 6 High Byte
  00000042                       +1         32         464 TREG7L          equ     0x0042   ; Timer 7 Low Byte
  00000043                       +1         33         465 TREG7H          equ     0x0043   ; Timer 7 High Byte
  00000044                       +1         34         466 CAP3L           equ     0x0044   ; Capture 3 Low Byte
  00000045                       +1         35         467 CAP3H           equ     0x0045   ; Capture 3 High Byte
  00000046                       +1         36         468 CAP4L           equ     0x0046   ; Capture 4 Low Byte
  00000047                       +1         37         469 CAP4H           equ     0x0047   ; Capture 4 High Byte
  00000048                       +1         38         470 T5MOD           equ     0x0048   ; 16-Bit Timer 4 Mode Control
  00000049                       +1         39         471 T5FFCR          equ     0x0049   ; 16-Bit Timer 4 Flip-Flop Control
                                 +1         40         472 
  0000004C                       +1         41         473 PG0REG          equ     0x004C   ; Pattern Generator 0
  0000004D                       +1         42         474 PG1REG          equ     0x004D   ; Pattern Generator 1
  0000004E                       +1         43         475 PG01CR          equ     0x004E   ; Pattern Generator 0/1 Control
                                 +1         44         476 
  00000050                       +1         45         477 SC0BUF          equ     0x0050   ; Serial Channel 0 Buffer Data
  00000051                       +1         46         478 SC0CR           equ     0x0051   ; Serial Channel 0 Control
  00000052                       +1         47         479 SC0MOD          equ     0x0052   ; Serial Channel 0 Mode Control
  00000053                       +1         48         480 BR0CR           equ     0x0053   ; Bit Rate Ser. Channel 0 Control
  00000054                       +1         49         481 SC1BUF          equ     0x0054   ; Serial Channel 1 Buffer Data
  00000055                       +1         50         482 SC1CR           equ     0x0055   ; Serial Channel 1 Control
  00000056                       +1         51         483 SC1MOD          equ     0x0056   ; Serial Channel 1 Mode Control
  00000057                       +1         52         484 BR1CR           equ     0x0057   ; Bit Rate Ser. Channel 1 Control
                                 +1         53         485 
  0000005E                       +1         54         486 ADMOD           equ     0x005E   ; A/D Control
  00000060                       +1         55         487 ADREG0L         equ     0x0060   ; A/D Result Channel 0 Bit 7..6 = AD1..0
  00000061                       +1         56         488 ADREG0H         equ     0x0061   ; A/D Result Channel 0 Bit 7..0 = AD9..2
  00000062                       +1         57         489 ADREG1L         equ     0x0062   ; A/D Result Channel 1 Bit 7..6 = AD1..0
  00000063                       +1         58         490 ADREG1H         equ     0x0063   ; A/D Result Channel 1 Bit 7..0 = AD9..2
  00000064                       +1         59         491 ADREG2L         equ     0x0064   ; A/D Result Channel 2 Bit 7..6 = AD1..0
  00000065                       +1         60         492 ADREG2H         equ     0x0065   ; A/D Result Channel 2 Bit 7..0 = AD9..2
  00000066                       +1         61         493 ADREG3L         equ     0x0066   ; A/D Result Channel 3 Bit 7..6 = AD1..0
  00000067                       +1         62         494 ADREG3H         equ     0x0067   ; A/D Result Channel 3 Bit 7..0 = AD9..2
                                 +1         63         495 
  00000068                       +1         64         496 B0CS            equ     0x0068   ; Block 0 CS/WAIT Control
  00000069                       +1         65         497 B1CS            equ     0x0069   ; Block 1 CS/WAIT Control
  0000006A                       +1         66         498 B2CS            equ     0x006A   ; Block 2 CS/WAIT Control
                                 +1         67         499 
  00000070                       +1         68         500 INTE0AD         equ     0x0070   ; Interrupt Enable/Level AD/Timer 0
  00000071                       +1         69         501 INTE45          equ     0x0071   ; Interrupt Enable/Level IRQ 5/4
  00000072                       +1         70         502 INTE67          equ     0x0072   ; Interrupt Enable/Level IRQ 7/6
  00000073                       +1         71         503 INTET10         equ     0x0073   ; Interrupt Enable/Level Timer 1/0
  00000074                       +1         72         504 INTEPW10        equ     0x0074   ; Interrupt Enable/Level Timer 3/2 (PWM 1/0)
  00000075                       +1         73         505 INTET54         equ     0x0075   ; Interrupt Enable/Level TREG 5/4
  00000076                       +1         74         506 INTET76         equ     0x0076   ; Interrupt Enable/Level TREG 7/6
  00000077                       +1         75         507 INTES0          equ     0x0077   ; Interrupt Enable/Level Serial Channel 0
  00000078                       +1         76         508 INTES1          equ     0x0078   ; Interrupt Enable/Level Serial Channel 1
  0000007B                       +1         77         509 IIMC            equ     0x007B   ; Interrupt Input Mode Control
                                 +1         78         510 
  0000007C                       +1         79         511 DMA0V           equ     0x007C   ; fDMA 0 Start Vector
  0000007D                       +1         80         512 DMA1V           equ     0x007D   ; fDMA 1 Start Vector
  0000007E                       +1         81         513 DMA2V           equ     0x007E   ; fDMA 2 Start Vector
  0000007F                       +1         82         514 DMA3V           equ     0x007F   ; fDMA 3 Start Vector
                                 +0         26         515 	$include "glbwork.inc"
                                 +1          1         516 ;================================================================
                                 +1          2         517 ; global vars
                                 +1          3         518 ;================================================================
                                 +1          4         519 
                                 +1          5         520 	extern medium start_work
                                 +1          6         521 	extern medium stopper ; keeps main loop spinning until vblank (byte)
                                 +1          7         522 	extern medium joypad ;joypad bitmask (byte)
                                 +1          8         523 	extern medium joylast ;last frame's joypad bitmask (byte)
                                 +1          9         524 	extern medium joyedge ;what buttons were pressed this frame (byte)
                                 +1         10         525 	extern medium hint_cnt ;how many times horizontal interrupt has fired (byte)
                                 +1         11         526 	extern medium frame_cnt ; counts number of frames (word)
                                 +1         12         527 	extern medium sprite_mirror ;mirror of sprite memory (256 bytes)
                                 +1         13         528 	
                                 +1         14         529 	extern medium scroll_x ;scroll x pos (word)
                                 +1         15         530 	extern medium scroll_y ;scroll y pos (word)
                                 +1         16         531 	
                                 +1         17         532 	extern medium player_x ;player x pos (long)
                                 +1         18         533 	extern medium player_y ;player y pos (long)
                                 +1         19         534 	extern medium player_dx ;long
                                 +1         20         535 	extern medium player_dy ;long
                                 +1         21         536 ;================================================================
                                 +1         22         537 
                                 +0         27         538 	$include "game.inc"
                                 +1          1         539 ;================================================================
                                 +1          2         540 ; GAME EQU
                                 +1          3         541 ;================================================================
                                 +1          4         542 
  000000A0                       +1          5         543 disp_size_x		EQU	160		; X screen size
                                 +1          6         544 
  00000098                       +1          7         545 disp_size_y		EQU	152		; Y screen size
                                 +1          8         546 
  00000040                       +1          9         547 obj_max		EQU	64		; number of maximum sprites
                                 +1         10         548 
                                 +1         11         549 ;================================================================
                                 +1         12         550 
                                 +0         28         551 	$include "print.inc"
                                 +1          1         552 ;*****************************************
                                 +1          2         553 ;	Print functions 
                                 +1          3         554 ;*****************************************
                                 +1          4         555 
                                 +1          5         556 ;-------------------------------------------------------
                                 +1          6         557 ; print_init: loads system font into first half of vram
                                 +1          7         558 ;-------------------------------------------------------
                                 +1          8         559 	extern print_init
                                 +1          9         560 
                                 +1         10         561 ;-------------------------------------------------------
                                 +1         11         562 ; print_string
                                 +1         12         563 ;-------------------------------------------------------
                                 +1         13         564 ; xix: pointer to null terminated text
                                 +1         14         565 ; wa: x pos
                                 +1         15         566 ; bc: y pos
                                 +1         16         567 ;-------------------------------------------------------
                                 +1         17         568 	extern print_string
                                 +1         18         569 	
                                 +1         19         570 ;-------------------------------------------------------
                                 +1         20         571 ; print_byte
                                 +1         21         572 ;-------------------------------------------------------
                                 +1         22         573 ; xix: pointer to byte to print
                                 +1         23         574 ; wa: x pos
                                 +1         24         575 ; bc: y pos
                                 +1         25         576 ;-------------------------------------------------------
                                 +1         26         577 	extern print_byte
                                 +1         27         578 	
                                 +1         28         579 ;-------------------------------------------------------
                                 +1         29         580 ; print_word	
                                 +1         30         581 ;-------------------------------------------------------
                                 +1         31         582 ; xix: pointer to word to print
                                 +1         32         583 ; wa: x pos
                                 +1         33         584 ; bc: y pos
                                 +1         34         585 ;-------------------------------------------------------
                                 +1         35         586 	extern print_word
                                 +0         29         587 	$include "graphics.inc"
                                 +1          1         588 ;*****************************************
                                 +1          2         589 ;	Graphics data 
                                 +1          3         590 ;*****************************************
                                 +1          4         591 
                                 +1          5         592 	extern palette
                                 +1          6         593 	extern palette_end
                                 +1          7         594 	extern tiles
                                 +1          8         595 	extern tiles_end
                                 +1          9         596 	extern map
                                 +1         10         597 	extern map_end
                                 +1         11         598 	extern hills
                                 +1         12         599 	extern hills_end
                                 +1         13         600 	extern hills_map
                                 +1         14         601 	extern hills_map_end
                                 +1         15         602 	extern hills_pal
                                 +1         16         603 	extern hills_pal_end
                                 +1         17         604 	extern guy
                                 +1         18         605 	extern guy_end
                                 +1         19         606 	extern guy_pal
                                 +1         20         607 	extern guy_pal_end
                                 +0         30         608 	$include "scroll.inc"
                                 +1          1         609 ;-------------------------------------------------------
                                 +1          2         610 ; scroll_set: set scroll to specified coords
                                 +1          3         611 ;-------------------------------------------------------
                                 +1          4         612 ; wa: x pos
                                 +1          5         613 ; bc: y pos
                                 +1          6         614 ;-------------------------------------------------------
                                 +1          7         615 extern scroll_set
                                 +1          8         616 
                                 +1          9         617 ;-------------------------------------------------------
                                 +1         10         618 ; scroll_get_tile: returns tile # at given coordinates in wa
                                 +1         11         619 ;-------------------------------------------------------
                                 +1         12         620 ; wa: x pos
                                 +1         13         621 ; bc: y pos
                                 +1         14         622 ;-------------------------------------------------------
                                 +1         15         623 extern scroll_get_tile
                                 +1         16         624 
                                 +1         17         625 ;-------------------------------------------------------
                                 +1         18         626 ; scroll_copy: carry out scroll changes made in scroll_set (run during vblank)
                                 +1         19         627 ;-------------------------------------------------------
                                 +1         20         628 extern scroll_copy
                                 +0         31         629 	$include "player.inc"
                                 +1          1         630 extern medium player_frame ;byte, what frame the player's displaying
                                 +1          2         631 
                                 +1          3         632 ;-------------------------------------------------------
                                 +1          4         633 ; player_init: initialize player sprite
                                 +1          5         634 ;-------------------------------------------------------	
                                 +1          6         635 extern player_init
                                 +1          7         636 ;-------------------------------------------------------
                                 +1          8         637 ; player_move: handle player movement
                                 +1          9         638 ;-------------------------------------------------------
                                 +1         10         639 extern player_move
                                 +0         32         640 
                                 +0         33         641 
                                 +0         34         642 ;-------------------------------------------------------
                                 +0         35         643 PROG section code large
                                 +0         36         644 ;-------------------------------------------------------
                                 +0         37         645 
                                 +0         38         646 		public	__STARTUP
  00FF1800                       +0         39         647 __STARTUP	equ	0xff1800
                                 +0         40         648 ;-------------------------------------------------------
                                 +0         41         649 ; entry point			
                                 +0         42         650 ;-------------------------------------------------------
00000000                         +0         43         651 reset:
00000000  1D000000             R +0         44         652 	cal	SYS_PATCH ;called during init to assist with power functionality
                                 +0         45         653 ;------------------- INITIALIZATION --------------------
00000004  1D000000             R +0         46         654 	cal init_setting ;VRAM, work initialization
                                 +0         47         655 	; cal print_init ;load system font
00000008  0600                   +0         48         656 	ei 0 ;allow interrupts with a priority >= 0
                                 +0         49         657 
                                 +0         50         658 	;---copy palette---
0000000A  F200000035           R +0         51         659 	lda xiy,palette
0000000F  F1808234               +0         52         660 	lda xix,SCROLL1_CRAM
00000013  4100000000           R +0         53         661 	ldl xbc,palette_end-palette ;should be a ldw but needs to be an ldl
00000018                         +0         54         662 palette_copy:                   ;to appease the assembler
00000018  D5F520                 +0         55         663 	ldw wa,(xiy+)
0000001B  F5F150                 +0         56         664 	ldw (xix+),wa
0000001E  D91CF7                 +0         57         665 	djnz bc,palette_copy	
                                 +0         58         666 	;---copy hill palette to bg 2---
00000021  F200000035           R +0         59         667 	lda xiy,hills_pal
00000026  F1008334               +0         60         668 	lda xix,SCROLL2_CRAM
0000002A  4100000000           R +0         61         669 	ldl xbc,hills_pal_end-hills_pal
0000002F                         +0         62         670 palette_copy2:
0000002F  D5F520                 +0         63         671 	ldw wa,(xiy+)
00000032  F5F150                 +0         64         672 	ldw (xix+),wa
00000035  D91CF7                 +0         65         673 	djnz bc,palette_copy2
                                 +0         66         674 
                                 +0         67         675 	; ;---set bg color---	
00000038  30850F                 +0         68         676 	ldw wa,0xf85
0000003B  F1E08350               +0         69         677 	ldw (0x83e0),wa
0000003F  2180                   +0         70         678 	ldb a,0x80 ;bg color on, first color in cram
00000041  F1188141               +0         71         679 	ldb (0x8118),a	
                                 +0         72         680 	
                                 +0         73         681 	;---copy tiles---
                                 +0         74         682 	
00000045  F200000035           R +0         75         683 	lda xiy,tiles
0000004A  F100A034               +0         76         684 	lda xix,CHR_VRAM
0000004E  4100000000           R +0         77         685 	ldl xbc,tiles_end-tiles
00000053  8511                   +0         78         686 	ldir (xix+),(xiy+)
                                 +0         79         687 	
00000055  F200000035           R +0         80         688 	lda xiy,hills
0000005A  F100AA34               +0         81         689 	lda xix,CHR_VRAM+0xA00
0000005E  4100000000           R +0         82         690 	ldl xbc,hills_end-hills
00000063  8511                   +0         83         691 	ldir (xix+),(xiy+)
                                 +0         84         692 	
                                 +0         85         693 	
                                 +0         86         694 	;---copy map---
                                 +0         87         695 	
00000065  F1009034               +0         88         696 	lda xix,SCRL1_VRAM
00000069  F200000035           R +0         89         697 	lda xiy,map
0000006E  2413                   +0         90         698 	ldb d,19 ;19 rows
00000070                         +0         91         699 map_copy:	
00000070  312800                 +0         92         700 	ldw bc,40 ;40 bytes per row (20 columns * 2 bytes per tile)
00000073                         +0         93         701 copy_row:
00000073  8511                   +0         94         702 	ldir (xix+),(xiy+)
00000075  DCC81800               +0         95         703 	addw ix,64-40
00000079  DDC85800               +0         96         704 	addw iy,128-40
0000007D  CC1CF0                 +0         97         705 	djnz d,map_copy	
                                 +0         98         706 	
00000080  F200000035           R +0         99         707 	lda xiy,hills_map
00000085  F1009834               +0        100         708 	lda xix,SCRL2_VRAM
00000089  4100040000             +0        101         709 	ldl xbc,32*32
0000008E                         +0        102         710 map2_loop: ;have to add 160 to each tile because 160 tiles in the foreground
0000008E  D5F520                 +0        103         711 	ldw wa,(xiy+)
00000091  D8C8A000               +0        104         712 	addw wa,160
00000095  F5F150                 +0        105         713 	ldw (xix+),wa
00000098  D91CF3                 +0        106         714 	djnz bc,map2_loop
0000009B  1D000000             R +0        107         715 	cal player_init
                                 +0        108         716 	
                                 +0        109         717 ;-------------------------------------------------------
                                 +0        110         718 ; main loop
                                 +0        111         719 ;-------------------------------------------------------
0000009F                         +0        112         720 main:
0000009F  C100003F00           R +0        113         721 	cpb (stopper),0 ;spin until vblank resets var
000000A4  66F9                   +0        114         722 	j z,main
                                 +0        115         723 
000000A6  C1856F3F00             +0        116         724 	cpb (User_Shutdown),0 ;turn off the system if we get a shutdown req
000000AB  6607                   +0        117         725 	j eq,main_100
                                 +0        118         726 
000000AD  C731A8                 +0        119         727 	ldb rw3,VECT_SHUTDOWN
000000B0  1D000000             R +0        120         728 	cal SYSTEM_CALL
                                 +0        121         729 
000000B4                         +0        122         730 main_100:
000000B4  D1000061             R +0        123         731 	incw 1,(frame_cnt)
000000B8  F100000000           R +0        124         732 	ldb (hint_cnt),0 ;reset number of times horizontal interrupt was called
000000BD  1D000000             R +0        125         733 	cal player_move
                                 +0        126         734 	
000000C1  F100000000           R +0        127         735 	ldb (stopper),0
000000C6  68D7                   +0        128         736 	j main
                                 +0        129         737 	
000000C8                         +0        130         738 String:
000000C8  68656C6C6F20776F726C   +0        131         739 	db "hello world",0
          6400                                             
000000D4                         +0        132         740 	align 2
000000D4                         +0        133         741 JoyStr:
000000D4  6A6F797061643A207878   +0        134         742 	db "joypad: xx",0
          00                                               
000000DF                         +0        135         743 	align 2
000000E0                         +0        136         744 FrameStr:
000000E0  6672616D653A20787878   +0        137         745 	db "frame: xxxx",0
          7800                                             
000000EC                         +0        138         746 	align 2
                                 +0        139         747 	
                                 +0        140         748 ;-------------------------------------------------------
                                 +0        141         749 ; v-blank interrupt
                                 +0        142         750 ;-------------------------------------------------------
000000EC                         +0        143         751 v_int:
000000EC  3C                     +0        144         752 	pushl xix
000000ED  3D                     +0        145         753 	pushl xiy
000000EE  3E                     +0        146         754 	pushl xiz
000000EF  38                     +0        147         755 	pushl xwa
000000F0  39                     +0        148         756 	pushl xbc
000000F1  3A                     +0        149         757 	pushl xde
000000F2  3B                     +0        150         758 	pushl xhl
000000F3  02                     +0        151         759 	pushw sr
                                 +0        152         760 ;	--------------------------------
000000F4  086F4E                 +0        153         761 	ldb	(WDCR),WD_CLR ;watch dog clear
000000F7  F1000000FF           R +0        154         762 	ldb	(stopper),0xff
000000FC  1D000000             R +0        155         763 	cal scroll_copy ;copy scroll tiles to vram
                                 +0        156         764 	
                                 +0        157         765 	;copy sprite mirror to sprite memory
00000100  F1000035             R +0        158         766 	lda xiy,sprite_mirror
00000104  F1008834               +0        159         767 	lda xix,SPR_VRAM
00000108  310001                 +0        160         768 	ldw bc,256
0000010B  8511                   +0        161         769 	ldir (xix+),(xiy+)
                                 +0        162         770 	
                                 +0        163         771 	;copy current player frame to vram
0000010D  F200000035           R +0        164         772 	lda xiy,guy
00000112  E8A8                   +0        165         773 	ldl xwa,0
00000114  C1000021             R +0        166         774 	ldb a,(player_frame)
00000118  E8EC06                 +0        167         775 	slal 6,xwa ;multiply by 64 since each frame is 64 bytes
0000011B  E885                   +0        168         776 	addl xiy,xwa
0000011D  4400000000           R +0        169         777 	ldl xix,CHR_VRAM+tiles_end-tiles+hills_end-hills
00000122  314000                 +0        170         778 	ldw bc,64
00000125  8511                   +0        171         779 	ldir (xix+),(xiy+)
                                 +0        172         780 	
                                 +0        173         781 	;set up joypad variables
00000127  C1000021             R +0        174         782 	ldb a,(joypad)
0000012B  F1000041             R +0        175         783 	ldb (joylast),a
0000012F  C1826F20               +0        176         784 	ldb w,(Sys_lever)
00000133  F1000040             R +0        177         785 	ldb (joypad),w
00000137  C9CDFF                 +0        178         786 	xorb a,0xff ;flip the bits
0000013A  C8C1                   +0        179         787 	andb a,w ;check if there's any overlap between what was pressed this frame
0000013C  F1000041             R +0        180         788 	ldb (joyedge),a ;and what wasn't pressed last frame
                                 +0        181         789 	
                                 +0        182         790 	;keep scroll 2 from scrolling off screen
00000140  D1000020             R +0        183         791 	ldw wa,(scroll_y)
00000144  D8EF01                 +0        184         792 	srlw 1,wa
00000147  C9CF66                 +0        185         793 	cpb a,102
0000014A  6702                   +0        186         794 	j c,normal_scroll
0000014C  2166                   +0        187         795 	ldb a,102
0000014E                         +0        188         796 normal_scroll:	
0000014E  F1358041               +0        189         797 	ldb (SCRL_Y2_ADR),a
                                 +0        190         798 	
                                 +0        191         799 	;set up bank 2 registers for horizontal interrupt
00000152  D1000021             R +0        192         800 	ldw bc,(scroll_x)
00000156  CB8C                   +0        193         801 	ldb d,c
00000158  D9EF01                 +0        194         802 	srlw 1,bc
0000015B  C7249B                 +0        195         803 	ldb rc2,c ;x / 2
0000015E  D9EF01                 +0        196         804 	srlw 1,bc
00000161  C7259B                 +0        197         805 	ldb rb2,c ;x / 4
00000164  D9EF01                 +0        198         806 	srlw 1,bc
00000167  C7209B                 +0        199         807 	ldb ra2,c ;x / 8
0000016A  CB8D                   +0        200         808 	ldb e,c
                                 +0        201         809 	; the 3 "split points" are at 88, 128, and 168.
0000016C  2000                   +0        202         810 	ldb w,0
                                 +0        203         811 	
0000016E  335800                 +0        204         812 	ldw hl,88
00000171  D8A3                   +0        205         813 	subw hl,wa
00000173  DBDD                   +0        206         814 	cpw hl,5
00000175  6502                   +0        207         815 	j mi,low_vals
00000177  6811                   +0        208         816 	j normal_vals
00000179                         +0        209         817 low_vals:
00000179  2780                   +0        210         818 	ldb l,128
0000017B  C9A7                   +0        211         819 	subb l,a
0000017D  F1348045               +0        212         820 	ldb (SCRL_X2_ADR),e
00000181  C721A9                 +0        213         821 	ldb rw2,1
00000184  C7280328               +0        214         822 	ldb re2,40
00000188  6813                   +0        215         823 	j done_vals
0000018A                         +0        216         824 normal_vals:
0000018A  C1000021             R +0        217         825 	ldb a,(frame_cnt)
0000018E  F1348041               +0        218         826 	ldb (SCRL_X2_ADR),a
00000192  C721A8                 +0        219         827 	ldb rw2,0
00000195  C7290328               +0        220         828 	ldb rd2,40
00000199  C7280328               +0        221         829 	ldb re2,40
0000019D                         +0        222         830 done_vals:
                                 +0        223         831 	
                                 +0        224         832 	;enable horizontal interrupt
0000019D                         +0        225         833 set_int:
0000019D  0607                   +0        226         834 	di
0000019F  C0203CFE               +0        227         835 	andb (TRUN),0xfe ;disable timer 0
000001A3  C0243CFC               +0        228         836 	andb (TMOD),0xfc ;timer 0: external clock (hblank)
000001A7  F02247                 +0        229         837 	ldb (TREG0),l ;what line to trigger interrupt on
000001AA  C731AC                 +0        230         838 	ldb rw3,VECT_INTLVSET ;enable interrupt through bios call
000001AD  C735AB                 +0        231         839 	ldb rb3,3
000001B0  C734AA                 +0        232         840 	ldb rc3,2
000001B3  F9                     +0        233         841 	swi 1 ;go to bios call
000001B4  C0203E01               +0        234         842 	orb (TRUN),0x1 ;enable timer 0
000001B8  0600                   +0        235         843 	ei 0
000001BA  6808                   +0        236         844 	j done_int
000001BC                         +0        237         845 no_int:
000001BC  0607                   +0        238         846 	di
000001BE  C0203CFE               +0        239         847 	andb (TRUN),0xfe ;disable timer 0
000001C2  0600                   +0        240         848 	ei 0
                                 +0        241         849 	
000001C4                         +0        242         850 done_int:	
                                 +0        243         851 	
                                 +0        244         852 ;	--------------------------------
000001C4  03                     +0        245         853     popw sr
000001C5  5B                     +0        246         854 	popl xhl
000001C6  5A                     +0        247         855 	popl xde
000001C7  59                     +0        248         856 	popl xbc
000001C8  58                     +0        249         857 	popl xwa
000001C9  5E                     +0        250         858 	popl xiz
000001CA  5D                     +0        251         859 	popl xiy
000001CB  5C                     +0        252         860 	popl xix
                                 +0        253         861 
000001CC  07                     +0        254         862 	reti
                                 +0        255         863 
                                 +0        256         864 ;-------------------------------------------------------
                                 +0        257         865 ; other interrupts
                                 +0        258         866 ;-------------------------------------------------------
                                 +0        259         867 ; horizontal interrupt happens so quickly that we don't want to bother
                                 +0        260         868 ; touching ram, so instead we use register bank 2
                                 +0        261         869 ;
                                 +0        262         870 ; seams for hill bg are at 88, 128, and 168
                                 +0        263         871 ;-------------------------------------------------------
                                 +0        264         872 ; register map:
                                 +0        265         873 ; w: counts how many times horizontal interrupt has been called
                                 +0        266         874 ; a: x position for first zone (furthest back hill)
                                 +0        267         875 ; b: x position for second zone (middle hill)
                                 +0        268         876 ; c: x position for third zone (closest hill)
                                 +0        269         877 ; d: y position for second split
                                 +0        270         878 ; e: y position for third split
                                 +0        271         879 ;-------------------------------------------------------
000001CD                         +0        272         880 h_int:
000001CD  1702                   +0        273         881 	ldf 2 ;load register bank 2
000001CF  C1088026               +0        274         882 	ldb h,(WD_LCDST_HPOS)
000001D3  CECF98                 +0        275         883 	cpb h,152 ;don't mess with scroll if in vblank
000001D6  6F42                   +0        276         884 	j nc,done_h_int
000001D8  C8D9                   +0        277         885 	cpb w,1
000001DA  6729                   +0        278         886 	j c,first
000001DC  660F                   +0        279         887 	j eq,second
000001DE                         +0        280         888 third:
000001DE  F1348043               +0        281         889 	ldb (SCRL_X2_ADR),c
000001E2  0607                   +0        282         890 	di
000001E4  C0203CFE               +0        283         891 	andb (TRUN),0xfe ;disable timer 0
000001E8  0600                   +0        284         892 	ei 0
000001EA  1700                   +0        285         893 	ldf 0
000001EC  07                     +0        286         894 	reti
000001ED                         +0        287         895 second:
000001ED  F1348042               +0        288         896 	ldb (SCRL_X2_ADR),b
000001F1  2002                   +0        289         897 	ldb w,2
000001F3  0607                   +0        290         898 	di
000001F5  C0203CFE               +0        291         899 	andb (TRUN),0xfe ;disable timer 0
000001F9  F02245                 +0        292         900 	ldb (TREG0),e ;scanline to fire next horizontal interrupt
000001FC  C0203E01               +0        293         901 	orb (TRUN),0x1 ;enable timer 0
00000200  0600                   +0        294         902 	ei 0
00000202  1700                   +0        295         903 	ldf 0
00000204  07                     +0        296         904 	reti
00000205                         +0        297         905 first:
00000205  F1348041               +0        298         906 	ldb (SCRL_X2_ADR),a
00000209  2001                   +0        299         907 	ldb w,1
0000020B  0607                   +0        300         908 	di
0000020D  C0203CFE               +0        301         909 	andb (TRUN),0xfe ;disable timer 0
00000211  F02244                 +0        302         910 	ldb (TREG0),d ;scanline to fire next horizontal interrupt
00000214  C0203E01               +0        303         911 	orb (TRUN),0x1 ;enable timer 0
00000218  0600                   +0        304         912 	ei 0
0000021A                         +0        305         913 done_h_int:	
0000021A  1700                   +0        306         914 	ldf 0
0000021C  07                     +0        307         915 	reti
                                 +0        308         916 	
                                 +0        309         917 
0000021D                         +0        310         918 timer1:
0000021D  07                     +0        311         919 	reti
                                 +0        312         920 
0000021E                         +0        313         921 timer2:
0000021E  07                     +0        314         922 	reti
                                 +0        315         923 
0000021F                         +0        316         924 alarm_int:
0000021F  07                     +0        317         925 	reti
                                 +0        318         926 
00000220                         +0        319         927 z80_int:
00000220  07                     +0        320         928 	reti
                                 +0        321         929 
00000221                         +0        322         930 sound_int:
00000221  07                     +0        323         931 	reti
                                 +0        324         932 
00000222                         +0        325         933 dummy:
00000222  07                     +0        326         934 	reti
                                 +0        327         935 
                                 +0        328         936 ;-------------------------------------------------------
                                 +0        329         937 	end
                                 +0        330         938 ;-------------------------------------------------------

Assembly complete, No error
TLCS-900 Relocatable Assembler (32) V2.2k  [Page     2]  main.lst

Symbol table listing
--------------------

Symbol           Category         Value     Attribute

ADMOD                    NUM      0000005E  A           
ADREG0H                  NUM      00000061  A           
ADREG0L                  NUM      00000060  A           
ADREG1H                  NUM      00000063  A           
ADREG1L                  NUM      00000062  A           
ADREG2H                  NUM      00000065  A           
ADREG2L                  NUM      00000064  A           
ADREG3H                  NUM      00000067  A           
ADREG3L                  NUM      00000066  A           
ALARM_BOOT_REQ           NUM      00000007  A           
B0CS                     NUM      00000068  A           
B1CS                     NUM      00000069  A           
B2CS                     NUM      0000006A  A           
BAT_SHUTDOWN_REQ
                         NUM      00000005  A           
BGCOL_CRAM               NUM      000083E0  A           
BG_COLOR                 NUM      00008118  A           
BIT_A                    NUM      00000004  A           
BIT_B                    NUM      00000005  A           
BIT_DOWN                 NUM      00000001  A           
BIT_LEFT                 NUM      00000002  A           
BIT_OPTION               NUM      00000006  A           
BIT_RIGHT                NUM      00000003  A           
BIT_UP                   NUM      00000000  A           
BR0CR                    NUM      00000053  A           
BR1CR                    NUM      00000057  A           
Battery_Voltage          NUM      00006F80  A           
CAP1H                    NUM      00000035  A           
CAP1L                    NUM      00000034  A           
CAP2H                    NUM      00000037  A           
CAP2L                    NUM      00000036  A           
CAP3H                    NUM      00000045  A           
CAP3L                    NUM      00000044  A           
CAP4H                    NUM      00000047  A           
CAP4L                    NUM      00000046  A           
CHR_VRAM                 NUM      0000A000  A           
DISP_CTL0                NUM      00008000  A           
DMA0V                    NUM      0000007C  A           
DMA1V                    NUM      0000007D  A           
DMA2V                    NUM      0000007E  A           
DMA3V                    NUM      0000007F  A           
FrameStr         C L     LAB      000000E0  R           PROG
IIMC                     NUM      0000007B  A           
INTE0AD                  NUM      00000070  A           
INTE45                   NUM      00000071  A           
INTE67                   NUM      00000072  A           
INTEPW10                 NUM      00000074  A           
INTES0                   NUM      00000077  A           
INTES1                   NUM      00000078  A           
INTET10                  NUM      00000073  A           
INTET54                  NUM      00000075  A           
INTET76                  NUM      00000076  A           
INT_CLR_BIT              NUM      00000007  A           
JOY_A                    NUM      00000010  A           
JOY_B                    NUM      00000020  A           
JOY_DOWN                 NUM      00000002  A           
JOY_LEFT                 NUM      00000004  A           
JOY_OPTION               NUM      00000040  A           
JOY_RIGHT                NUM      00000008  A           
JOY_UP                   NUM      00000001  A           
JoyStr           C L     LAB      000000D4  R           PROG
LCD_CTR_ADD              NUM      00008012  A           
Language                 NUM      00006F87  A           
MP_SHUTDOWN_REQ          NUM      00000007  A           
OS_Version               NUM      00006F91  A           
P0MOD                    NUM      00000028  A           
P1MOD                    NUM      00000029  A           
PAL_SCR1_00              NUM      00008111  A           
PAL_SCR1_01              NUM      00008112  A           
PAL_SCR1_02              NUM      00008113  A           
PAL_SCR1_10              NUM      00008115  A           
PAL_SCR1_11              NUM      00008116  A           
PAL_SCR1_12              NUM      00008117  A           
PFFCR                    NUM      0000002A  A           
PG01CR                   NUM      0000004E  A           
PG0REG                   NUM      0000004C  A           
PG1REG                   NUM      0000004D  A           
PL_SCR0_00               NUM      00008109  A           
PL_SCR0_01               NUM      0000810A  A           
PL_SCR0_02               NUM      0000810B  A           
PL_SCR0_10               NUM      0000810D  A           
PL_SCR0_11               NUM      0000810E  A           
PL_SCR0_12               NUM      0000810F  A           
PL_SPR_00                NUM      00008101  A           
PL_SPR_01                NUM      00008102  A           
PL_SPR_02                NUM      00008103  A           
PL_SPR_10                NUM      00008105  A           
PL_SPR_11                NUM      00008106  A           
PL_SPR_12                NUM      00008107  A           
POWER_BOOT_REQ           NUM      00000006  A           
PROG             C L     SEC      00000000  R 223       
RESET_ADD                NUM      000087E0  A           
RESUME_ANS               NUM      00000007  A           
RESUME_BOOT_REQ          NUM      00000005  A           
SC0BUF                   NUM      00000050  A           
SC0CR                    NUM      00000051  A           
SC0MOD                   NUM      00000052  A           
SC1BUF                   NUM      00000054  A           
SC1CR                    NUM      00000055  A           
SC1MOD                   NUM      00000056  A           
SCRL1_VRAM               NUM      00009000  A           
SCRL2_VRAM               NUM      00009800  A           
SCRL_PRIO_ADR            NUM      00008030  A           
SCRL_X1_ADR              NUM      00008032  A           
SCRL_X2_ADR              NUM      00008034  A           
SCRL_Y1_ADR              NUM      00008033  A           
SCRL_Y2_ADR              NUM      00008035  A           
SCROLL1_CRAM             NUM      00008280  A           
SCROLL2_CRAM             NUM      00008300  A           
SPRITE_CRAM              NUM      00008200  A           
SPR_OFFSET_X_ADR
                         NUM      00008020  A           
SPR_OFFSET_Y_ADR
                         NUM      00008021  A           
SPR_PALCODE              NUM      00008C00  A           
SPR_VRAM                 NUM      00008800  A           
STS_RG_ADD               NUM      00008010  A           
SYSTEM_CALL                       00000000  R EXT       
SYS_FAILURE              NUM      000000FF  A           
SYS_PATCH                         00000000  R EXT       
SYS_SUCCESS              NUM      00000000  A           
String           C L     LAB      000000C8  R           PROG
Sys_lever                NUM      00006F82  A           
T45CR                    NUM      0000003A  A           
T4FFCR                   NUM      00000039  A           
T4MOD                    NUM      00000038  A           
T5FFCR                   NUM      00000049  A           
T5MOD                    NUM      00000048  A           
T8RUN                    NUM      00000020  A           
TFFCF                    NUM      00000025  A           
TIMER_SHUTDOWN_ANS
                         NUM      00000006  A           
TIME_SHUTDOWN_REQ
                         NUM      00000006  A           
TMOD                     NUM      00000024  A           
TREG0                    NUM      00000022  A           
TREG1                    NUM      00000023  A           
TREG2                    NUM      00000026  A           
TREG3                    NUM      00000027  A           
TREG4H                   NUM      00000031  A           
TREG4L                   NUM      00000030  A           
TREG5H                   NUM      00000033  A           
TREG5L                   NUM      00000032  A           
TREG6H                   NUM      00000041  A           
TREG6L                   NUM      00000040  A           
TREG7H                   NUM      00000043  A           
TREG7L                   NUM      00000042  A           
TRUN                     NUM      00000020  A           
User_Answer              NUM      00006F86  A           
User_Boot                NUM      00006F84  A           
User_Shutdown            NUM      00006F85  A           
VECT_ALARMDOWNSET
                         NUM      0000000B  A           
VECT_ALARMSET            NUM      00000009  A           
VECT_CLOCKGEARSET
                         NUM      00000001  A           
VECT_FLASHALLERS
                         NUM      00000007  A           
VECT_FLASHERS            NUM      00000008  A           
VECT_FLASHPROTECT
                         NUM      0000000D  A           
VECT_FLASHWRITE          NUM      00000006  A           
VECT_GEMODESET           NUM      0000000E  A           
VECT_INTLVSET            NUM      00000004  A           
VECT_RTCGET              NUM      00000002  A           
VECT_SHUTDOWN            NUM      00000000  A           
VECT_SYSFONTSET          NUM      00000005  A           
VERSION_ADD              NUM      000087FE  A           
WDCR                     NUM      0000006F  A           
WD_CLR                   NUM      0000004E  A           
WD_LCDST_HPOS            NUM      00008008  A           
WD_LCDST_VPOS            NUM      00008009  A           
WINDOW_CRAM              NUM      000083F0  A           
WIN_WBAX_ADR             NUM      00008002  A           
WIN_WBAY_ADR             NUM      00008003  A           
WIN_WSIX_ADR             NUM      00008004  A           
WIN_WSIY_ADR             NUM      00008005  A           
_ALARM_BOOT_REQ          NUM      00000080  A           
_BAT_SHUTDOWN_REQ
                         NUM      00000020  A           
_INT_CLR_BIT             NUM      00000080  A           
_MP_SHUTDOWN_REQ
                         NUM      00000080  A           
_POWER_BOOT_REQ          NUM      00000040  A           
_RESUME_ANS              NUM      00000080  A           
_RESUME_BOOT_REQ
                         NUM      00000020  A           
_TIMER_SHUTDOWN_ANS
                         NUM      00000040  A           
_TIME_SHUTDOWN_REQ
                         NUM      00000040  A           
__STARTUP                NUM      00FF1800  A PUB       
alarm_int        C L     LAB      0000021F  R PUB       PROG
copy_row         C L     LAB      00000073  R           PROG
disp_size_x              NUM      000000A0  A           
disp_size_y              NUM      00000098  A           
done_h_int       C L     LAB      0000021A  R           PROG
done_int         C L     LAB      000001C4  R           PROG
done_vals        C L     LAB      0000019D  R           PROG
dummy            C L     LAB      00000222  R PUB       PROG
first            C L     LAB      00000205  R           PROG
frame_cnt                         00000000  R EXT       
game_main                MOD
guy                               00000000  R EXT       
h_int            C L     LAB      000001CD  R PUB       PROG
hills                             00000000  R EXT       
hills_end                         00000000  R EXT       
hills_map                         00000000  R EXT       
hills_pal                         00000000  R EXT       
hills_pal_end                     00000000  R EXT       
hint_cnt                          00000000  R EXT       
init_setting                      00000000  R EXT       
joyedge                           00000000  R EXT       
joylast                           00000000  R EXT       
joypad                            00000000  R EXT       
low_vals         C L     LAB      00000179  R           PROG
main             C L     LAB      0000009F  R           PROG
main_100         C L     LAB      000000B4  R           PROG
map                               00000000  R EXT       
map2_loop        C L     LAB      0000008E  R           PROG
map_copy         C L     LAB      00000070  R           PROG
no_int           C L     LAB      000001BC  R           PROG
normal_scroll    C L     LAB      0000014E  R           PROG
normal_vals      C L     LAB      0000018A  R           PROG
obj_max                  NUM      00000040  A           
palette                           00000000  R EXT       
palette_copy     C L     LAB      00000018  R           PROG
palette_copy2    C L     LAB      0000002F  R           PROG
palette_end                       00000000  R EXT       
player_frame                      00000000  R EXT       
player_init                       00000000  R EXT       
player_move                       00000000  R EXT       
reset            C L     LAB      00000000  R PUB       PROG
scroll_copy                       00000000  R EXT       
scroll_x                          00000000  R EXT       
scroll_y                          00000000  R EXT       
second           C L     LAB      000001ED  R           PROG
set_int          C L     LAB      0000019D  R           PROG
sound_int        C L     LAB      00000221  R PUB       PROG
sprite_mirror                     00000000  R EXT       
stopper                           00000000  R EXT       
third            C L     LAB      000001DE  R           PROG
tiles                             00000000  R EXT       
tiles_end                         00000000  R EXT       
timer1           C L     LAB      0000021D  R PUB       PROG
timer2           C L     LAB      0000021E  R PUB       PROG
v_int            C L     LAB      000000EC  R PUB       PROG
z80_int          C L     LAB      00000220  R PUB       PROG


TOTAL
  234 user defined symbol(s)
   16 unreferenced external symbol(s)
