(C)Copyright TOSHIBA CORPORATION 1993-2009  All rights reserved
Sun May 17 19:17:36 2020
TLCS-900 Relocatable Assembler (32) V2.2k  [Page     1]  main.lst
Runtime option : c:\Program Files (x86)\TOSHIBA\T900\bin\asm900.exe -Nb2 -O1 -g -l main.asm

Location  Object                           Ins        Line Source Statement

                                 +0          1           1 ;*****************************************
                                 +0          2           2 ;	Main Program 
                                 +0          3           3 ;*****************************************
                                 +0          4           4 	$MAXIMUM
                                 +0          5           5 	module game_main
                                 +0          6           6 
                                 +0          7           7 ;  ---------------------------------
                                 +0          8           8 ;	EXTERNAL LOOK UP
                                 +0          9           9 ;  ---------------------------------
                                 +0         10          10 	extern SYS_PATCH
                                 +0         11          11 	extern SYSTEM_CALL
                                 +0         12          12 	extern init_setting
                                 +0         13          13 
                                 +0         14          14 ;  ---------------------------------
                                 +0         15          15 ;   EXTERNAL DEFINITION
                                 +0         16          16 ;  ---------------------------------
                                 +0         17          17 	public reset,v_int,h_int,dummy,timer1,timer2
                                 +0         18          18 	public alarm_int,z80_int,sound_int
                                 +0         19          19 
                                 +0         20          20 ;  ---------------------------------
                                 +0         21          21 ;	INCLUDE
                                 +0         22          22 ;  ---------------------------------
                                 +0         23          23 	$include "system.inc"
                                 +1          1          24 ;-----------------------------------------------------------------
                                 +1          2          25 
                                 +1          3          26 ;	SYSTEM CALL
                                 +1          4          27 
                                 +1          5          28 ;-----------------------------------------------------------------
                                 +1          6          29 
  00000000                       +1          7          30 SYS_SUCCESS		equ	0x00			;run success
                                 +1          8          31 
  000000FF                       +1          9          32 SYS_FAILURE		equ	0xff			;run failure
                                 +1         10          33 
                                 +1         11          34 ;-----------------------------------------------------------------
                                 +1         12          35 
  00000000                       +1         13          36 VECT_SHUTDOWN		equ	0x00			;shutdown (power OFF)
                                 +1         14          37 
  00000001                       +1         15          38 VECT_CLOCKGEARSET	equ	0x01			;clock gear change
                                 +1         16          39 
  00000002                       +1         17          40 VECT_RTCGET		equ	0x02			;obtain time
                                 +1         18          41 
  00000004                       +1         19          42 VECT_INTLVSET		equ	0x04			;set interrupt level
                                 +1         20          43 
  00000005                       +1         21          44 VECT_SYSFONTSET	equ	0x05			;set system font
                                 +1         22          45 
  00000006                       +1         23          46 VECT_FLASHWRITE	equ	0x06			;flash memory data write
                                 +1         24          47 
  00000007                       +1         25          48 VECT_FLASHALLERS	equ	0x07			;flash memory erase all blocks
                                 +1         26          49 
  00000008                       +1         27          50 VECT_FLASHERS		equ	0x08			;flash memory erase specified blocks
                                 +1         28          51 
  00000009                       +1         29          52 VECT_ALARMSET		equ	0x09			;game alarm setting
                                 +1         30          53 
  0000000B                       +1         31          54 VECT_ALARMDOWNSET	equ	0x0b			;alarm setting during shutdown
                                 +1         32          55 
  0000000D                       +1         33          56 VECT_FLASHPROTECT	equ	0x0d			;protect using tool
                                 +1         34          57 
  0000000E                       +1         35          58 VECT_GEMODESET	equ	0x0e			;switching GE mode
                                 +1         36          59 
                                 +1         37          60 ;-----------------------------------------------------------------
                                 +1         38          61 
                                 +1         39          62 ;	SYSTEM BIT EQU
                                 +1         40          63 
                                 +1         41          64 ;-----------------------------------------------------------------
                                 +1         42          65 
  00000007                       +1         43          66 INT_CLR_BIT		equ	0x07			;interrupt request clear bit
                                 +1         44          67 
  00000080                       +1         45          68 _INT_CLR_BIT		equ	0y10000000		;
                                 +1         46          69 
                                 +1         47          70 ;-----------------------------------------------------------------
                                 +1         48          71 
                                 +1         49          72 ;	SYSTEM WORK
                                 +1         50          73 
                                 +1         51          74 ;-----------------------------------------------------------------
                                 +1         52          75 
  00006F80                       +1         53          76 Battery_Voltage	equ	0x6f80			;estimated voltage
                                 +1         54          77 
  00006F82                       +1         55          78 Sys_lever		equ	0x6f82			;lever value
                                 +1         56          79 
  00006F87                       +1         57          80 Language		equ	0x6f87			;language chosen
                                 +1         58          81 
  00006F85                       +1         59          82 User_Shutdown		equ	0x6f85			;shutdown re1uest bit
                                 +1         60          83 
  00006F84                       +1         61          84 User_Boot		equ	0x6f84			;startup bit flag
                                 +1         62          85 
  00006F86                       +1         63          86 User_Answer		equ	0x6f86			;user request bit
                                 +1         64          87 
  00006F91                       +1         65          88 OS_Version		equ	0x6f91			;system version reserve work
                                 +1         66          89 
                                 +1         67          90 ;-----------------------------------------------------------------
                                 +1         68          91 
                                 +1         69          92 ;	WATCH DOG
                                 +1         70          93 
                                 +1         71          94 ;-----------------------------------------------------------------
                                 +1         72          95 
  0000006F                       +1         73          96 WDCR			equ	0x06F		;watch dog control address
                                 +1         74          97 
  0000004E                       +1         75          98 WD_CLR			equ	0x04e		;watch dog clear code
                                 +1         76          99 
                                 +1         77         100 ;-----------------------------------------------------------------
                                 +1         78         101 
                                 +1         79         102 ;	SYSTEM WORK BIT
                                 +1         80         103 
                                 +1         81         104 ;-----------------------------------------------------------------
                                 +1         82         105 
  00000001                       +1         83         106 JOY_UP 		equ 0x1
  00000002                       +1         84         107 JOY_DOWN 	equ 0x2
  00000004                       +1         85         108 JOY_LEFT 	equ 0x4
  00000008                       +1         86         109 JOY_RIGHT 	equ 0x8
  00000010                       +1         87         110 JOY_A		equ 0x10
  00000020                       +1         88         111 JOY_B		equ 0x20
  00000040                       +1         89         112 JOY_OPTION	equ 0x40
                                 +1         90         113 
  00000000                       +1         91         114 BIT_UP		equ 0
  00000001                       +1         92         115 BIT_DOWN	equ 1
  00000002                       +1         93         116 BIT_LEFT	equ 2
  00000003                       +1         94         117 BIT_RIGHT	equ 3
  00000004                       +1         95         118 BIT_A		equ 4
  00000005                       +1         96         119 BIT_B		equ 5
  00000006                       +1         97         120 BIT_OPTION	equ 6
                                 +1         98         121 
                                 +1         99         122 ;======================================================= 
                                 +1        100         123 
                                 +1        101         124 ;	USER START UP BIT
                                 +1        102         125 
                                 +1        103         126 ;======================================================= 
                                 +1        104         127 
                                 +1        105         128 ;User_Boot
                                 +1        106         129 
                                 +1        107         130 ;	00000000
                                 +1        108         131 
                                 +1        109         132 ;	||+------ resume startup			0:not resume startup		1:resume startup
                                 +1        110         133 
                                 +1        111         134 ;	|+------- POWER startup			0:not POWER startup		1:POWER startup
                                 +1        112         135 
                                 +1        113         136 ;	+-------- alarm startup			0:not alarm statup		1:alarm statup
                                 +1        114         137 
                                 +1        115         138 ;	=================================================
                                 +1        116         139 
                                 +1        117         140 
                                 +1        118         141 
  00000007                       +1        119         142 ALARM_BOOT_REQ		equ	0x07
                                 +1        120         143 
  00000006                       +1        121         144 POWER_BOOT_REQ		equ	0x06
                                 +1        122         145 
  00000005                       +1        123         146 RESUME_BOOT_REQ		equ	0x05
                                 +1        124         147 
  00000080                       +1        125         148 _ALARM_BOOT_REQ		equ	0y10000000
                                 +1        126         149 
  00000040                       +1        127         150 _POWER_BOOT_REQ		equ	0y01000000
                                 +1        128         151 
  00000020                       +1        129         152 _RESUME_BOOT_REQ	equ	0y00100000
                                 +1        130         153 
                                 +1        131         154 
                                 +1        132         155 
                                 +1        133         156 ;======================================================= 
                                 +1        134         157 
                                 +1        135         158 ;	USER SHUTDOWN BIT
                                 +1        136         159 
                                 +1        137         160 ;======================================================= 
                                 +1        138         161 
                                 +1        139         162 ;User_Shutdown
                                 +1        140         163 
                                 +1        141         164 ;	00000000
                                 +1        142         165 
                                 +1        143         166 ;	||+--------- main power use shutdown request	0:no request	1:request
                                 +1        144         167 
                                 +1        145         168 ;	|+---------- no use shutdown request		0:no request	1:request
                                 +1        146         169 
                                 +1        147         170 ;	+----------- power off shutdown request		0:no request	1:request
                                 +1        148         171 
                                 +1        149         172 ;	=================================================
                                 +1        150         173 
                                 +1        151         174 
                                 +1        152         175 
  00000007                       +1        153         176 MP_SHUTDOWN_REQ	equ	0x07
                                 +1        154         177 
  00000006                       +1        155         178 TIME_SHUTDOWN_REQ	equ	0x06
                                 +1        156         179 
  00000005                       +1        157         180 BAT_SHUTDOWN_REQ	equ	0x05
                                 +1        158         181 
  00000080                       +1        159         182 _MP_SHUTDOWN_REQ	equ	0y10000000
                                 +1        160         183 
  00000040                       +1        161         184 _TIME_SHUTDOWN_REQ	equ	0y01000000
                                 +1        162         185 
  00000020                       +1        163         186 _BAT_SHUTDOWN_REQ	equ	0y00100000
                                 +1        164         187 
                                 +1        165         188 
                                 +1        166         189 
                                 +1        167         190 ;======================================================= 
                                 +1        168         191 
                                 +1        169         192 ;	USER ANSWER BIT
                                 +1        170         193 
                                 +1        171         194 ;======================================================= 
                                 +1        172         195 
                                 +1        173         196 ;User_Answer
                                 +1        174         197 
                                 +1        175         198 ;	00000000
                                 +1        176         199 
                                 +1        177         200 ;	|+----------- no use shutdown operation	0:non-existent	1:exists
                                 +1        178         201 
                                 +1        179         202 ;	+------------ resume operation		0:non-existent	1:exists
                                 +1        180         203 
                                 +1        181         204 ;	=================================================
                                 +1        182         205 
                                 +1        183         206 
                                 +1        184         207 
  00000007                       +1        185         208 RESUME_ANS		equ	0x07
                                 +1        186         209 
  00000006                       +1        187         210 TIMER_SHUTDOWN_ANS	equ	0x06
                                 +1        188         211 
  00000080                       +1        189         212 _RESUME_ANS		equ	0y10000000
                                 +1        190         213 
  00000040                       +1        191         214 _TIMER_SHUTDOWN_ANS	equ	0y01000000
                                 +1        192         215 
                                 +0         24         216 	$include "k1head.inc"
                                 +1          1         217 ;=======================================================
                                 +1          2         218 
                                 +1          3         219 ;		SYSTEM RELATED EQU
                                 +1          4         220 
                                 +1          5         221 ;=======================================================
                                 +1          6         222 
  00008000                       +1          7         223 DISP_CTL0		EQU	0x08000			;interrupt control register
                                 +1          8         224 
                                 +1          9         225 ;D7 : 1 = Vint allowed / 0 = not allowed
                                 +1         10         226 
                                 +1         11         227 ;D6 : 1 = Hint allowed / 0 = not allowed
                                 +1         12         228 
                                 +1         13         229 
                                 +1         14         230 
  00008010                       +1         15         231 STS_RG_ADD		EQU	0x08010			;2D status register (READ)
                                 +1         16         232 
                                 +1         17         233 ;D7 : 1 = character over / 0 = no character over
                                 +1         18         234 
                                 +1         19         235 ;D6 : 1 = while V blanking / 0 = while in display mode
                                 +1         20         236 
                                 +1         21         237 
                                 +1         22         238 
  00008012                       +1         23         239 LCD_CTR_ADD		EQU	0x08012			;2D control register
                                 +1         24         240 
                                 +1         25         241 ;D7 : 1 = screen color inverse display / 0 = normal display
                                 +1         26         242 
                                 +1         27         243 ;D2`D0 : outside window frame color CODE
                                 +1         28         244 
                                 +1         29         245 
                                 +1         30         246 
  00008118                       +1         31         247 BG_COLOR		EQU 0x08118			;Background color register
                                 +1         32         248 
                                 +1         33         249 ;D7`D6: BGON. D7 = 1, D6 = 0: Use specified BG color. Defaults to D7/D6 both 0
                                 +1         34         250 
                                 +1         35         251 ;D2`D0: BG color code
                                 +1         36         252 
                                 +1         37         253 
                                 +1         38         254 
                                 +1         39         255 
  000087E0                       +1         40         256 RESET_ADD		EQU	0X087E0			;2D software reset (WRITE)
                                 +1         41         257 
                                 +1         42         258 ;2D cicuit initialization with "52" write
                                 +1         43         259 
                                 +1         44         260 
                                 +1         45         261 
  000087FE                       +1         46         262 VERSION_ADD		EQU	0x087FE			;2D cicuit version (READ)
                                 +1         47         263 
                                 +1         48         264 ;D7 : 1 = white LCD panel /0 = balck LCD panel 
                                 +1         49         265 
                                 +1         50         266 ;D5`D0 : 2D circuit version
                                 +1         51         267 
                                 +1         52         268 
                                 +1         53         269 
                                 +1         54         270 
                                 +1         55         271 
                                 +1         56         272 ;=======================================================
                                 +1         57         273 
                                 +1         58         274 ;		CHARACTER EQU
                                 +1         59         275 
                                 +1         60         276 ;=======================================================
                                 +1         61         277 
  0000A000                       +1         62         278 CHR_VRAM		EQU	0x0A000			;character data RAM address
                                 +1         63         279 
                                 +1         64         280 
                                 +1         65         281 
                                 +1         66         282 
                                 +1         67         283 
                                 +1         68         284 ;=======================================================
                                 +1         69         285 
                                 +1         70         286 ;		SCROLL EQU
                                 +1         71         287 
                                 +1         72         288 ;=======================================================
                                 +1         73         289 
  00009000                       +1         74         290 SCRL1_VRAM		EQU	0x09000
                                 +1         75         291 
  00009800                       +1         76         292 SCRL2_VRAM		EQU	0x09800
                                 +1         77         293 
                                 +1         78         294 
                                 +1         79         295 
  00008030                       +1         80         296 SCRL_PRIO_ADR		EQU	0X08030			;scroll priority level invert register 
                                 +1         81         297 
  00008032                       +1         82         298 SCRL_X1_ADR		EQU	0x08032			;scroll 1 offset H register
                                 +1         83         299 
  00008033                       +1         84         300 SCRL_Y1_ADR		EQU	0x08033			;scroll 1 offset V register
                                 +1         85         301 
  00008034                       +1         86         302 SCRL_X2_ADR		EQU	0x08034			;scroll 2 offset H register
                                 +1         87         303 
  00008035                       +1         88         304 SCRL_Y2_ADR		EQU	0x08035			;scroll 2 offset V register
                                 +1         89         305 
                                 +1         90         306 
                                 +1         91         307 
                                 +1         92         308 ;=======================================================
                                 +1         93         309 
                                 +1         94         310 ;		SPRITE EQU
                                 +1         95         311 
                                 +1         96         312 ;=======================================================
                                 +1         97         313 
  00008800                       +1         98         314 SPR_VRAM		EQU	0x08800
                                 +1         99         315 
  00008020                       +1        100         316 SPR_OFFSET_X_ADR	EQU	0x08020			;sprite offset H
                                 +1        101         317 
  00008021                       +1        102         318 SPR_OFFSET_Y_ADR	EQU	0x08021			;sprite offset V
                                 +1        103         319 
                                 +1        104         320 
                                 +1        105         321 
                                 +1        106         322 
                                 +1        107         323 
                                 +1        108         324 ;=======================================================
                                 +1        109         325 
                                 +1        110         326 ;		WINDOW SYSTEM EQU
                                 +1        111         327 
                                 +1        112         328 ;=======================================================
                                 +1        113         329 
  00008002                       +1        114         330 WIN_WBAX_ADR		EQU	0x08002			;window origin H
                                 +1        115         331 
  00008003                       +1        116         332 WIN_WBAY_ADR		EQU	0x08003			;window origin V
                                 +1        117         333 
  00008004                       +1        118         334 WIN_WSIX_ADR		EQU	0x08004			;window size H
                                 +1        119         335 
  00008005                       +1        120         336 WIN_WSIY_ADR		EQU	0x08005			;window size V
                                 +1        121         337 
                                 +1        122         338 
                                 +1        123         339 
  00008008                       +1        124         340 WD_LCDST_HPOS		EQU	0x08008			;raster H position register (READ)
                                 +1        125         341 
  00008009                       +1        126         342 WD_LCDST_VPOS		EQU	0x08009			;raster V position register (READ)
                                 +1        127         343 
                                 +1        128         344 
                                 +1        129         345 
                                 +1        130         346 ;=======================================================
                                 +1        131         347 
                                 +1        132         348 ;		PALETTE EQU
                                 +1        133         349 
                                 +1        134         350 ;=======================================================
                                 +1        135         351 
                                 +1        136         352 ;sprite palette 0
                                 +1        137         353 
  00008101                       +1        138         354 PL_SPR_00		EQU	0x08101	
                                 +1        139         355 
  00008102                       +1        140         356 PL_SPR_01		EQU	0x08102
                                 +1        141         357 
  00008103                       +1        142         358 PL_SPR_02		EQU	0x08103
                                 +1        143         359 
                                 +1        144         360 ;sprite palette 1
                                 +1        145         361 
  00008105                       +1        146         362 PL_SPR_10		EQU	0x08105
                                 +1        147         363 
  00008106                       +1        148         364 PL_SPR_11		EQU	0x08106
                                 +1        149         365 
  00008107                       +1        150         366 PL_SPR_12		EQU	0x08107
                                 +1        151         367 
                                 +1        152         368 
                                 +1        153         369 
                                 +1        154         370 ;scroll 0 palette 0
                                 +1        155         371 
  00008109                       +1        156         372 PL_SCR0_00		EQU	0x08109
                                 +1        157         373 
  0000810A                       +1        158         374 PL_SCR0_01		EQU	0x0810A
                                 +1        159         375 
  0000810B                       +1        160         376 PL_SCR0_02		EQU	0x0810B
                                 +1        161         377 
                                 +1        162         378 ;scroll 0 palette 1
                                 +1        163         379 
  0000810D                       +1        164         380 PL_SCR0_10		EQU	0x0810D
                                 +1        165         381 
  0000810E                       +1        166         382 PL_SCR0_11		EQU	0x0810E
                                 +1        167         383 
  0000810F                       +1        168         384 PL_SCR0_12		EQU	0x0810F
                                 +1        169         385 
                                 +1        170         386 ;scroll 1 palette 0
                                 +1        171         387 
  00008111                       +1        172         388 PAL_SCR1_00		EQU	0x08111
                                 +1        173         389 
  00008112                       +1        174         390 PAL_SCR1_01		EQU	0x08112
                                 +1        175         391 
  00008113                       +1        176         392 PAL_SCR1_02		EQU	0x08113
                                 +1        177         393 
                                 +1        178         394 ;scroll 1 palette 1
                                 +1        179         395 
  00008115                       +1        180         396 PAL_SCR1_10		EQU	0x08115
                                 +1        181         397 
  00008116                       +1        182         398 PAL_SCR1_11		EQU	0x08116
                                 +1        183         399 
  00008117                       +1        184         400 PAL_SCR1_12		EQU	0x08117
                                 +1        185         401 
                                 +1        186         402 
                                 +1        187         403 ;=======================================================
                                 +1        188         404 
                                 +1        189         405 ;		COLOR PALETTE RAM EQU
                                 +1        190         406 
                                 +1        191         407 ;=======================================================
                                 +1        192         408 
  00008200                       +1        193         409 SPRITE_CRAM		EQU 0x08200
                                 +1        194         410 
  00008280                       +1        195         411 SCROLL1_CRAM	EQU 0x08280
                                 +1        196         412 
  00008300                       +1        197         413 SCROLL2_CRAM	EQU 0x08300
                                 +1        198         414 
  000083E0                       +1        199         415 BGCOL_CRAM		EQU 0x083E0 ;for the background color
                                 +1        200         416 
  000083F0                       +1        201         417 WINDOW_CRAM		EQU 0x083F0
                                 +1        202         418 
                                 +1        203         419 
                                 +1        204         420 ;=======================================================
                                 +1        205         421 
                                 +1        206         422 
                                 +1        207         423 
                                 +0         25         424 	$include "glbwork.inc"
                                 +1          1         425 ;================================================================
                                 +1          2         426 ; global vars
                                 +1          3         427 ;================================================================
                                 +1          4         428 
                                 +1          5         429 	extern medium start_work
                                 +1          6         430 	extern medium stopper
                                 +1          7         431 	extern medium frame_cnt
                                 +1          8         432 	extern medium screen_x
                                 +1          9         433 	extern medium screen_y
                                 +1         10         434 
                                 +1         11         435 ;================================================================
                                 +1         12         436 
                                 +0         26         437 	$include "game.inc"
                                 +1          1         438 ;================================================================
                                 +1          2         439 ; GAME EQU
                                 +1          3         440 ;================================================================
                                 +1          4         441 
  000000A0                       +1          5         442 disp_size_x		EQU	160		; X screen size
                                 +1          6         443 
  00000098                       +1          7         444 disp_size_y		EQU	152		; Y screen size
                                 +1          8         445 
  00000040                       +1          9         446 obj_max		EQU	64		; number of maximum sprites
                                 +1         10         447 
                                 +1         11         448 ;================================================================
                                 +1         12         449 
                                 +0         27         450 	$include "print.inc"
                                 +1          1         451 ;*****************************************
                                 +1          2         452 ;	Print functions 
                                 +1          3         453 ;*****************************************
                                 +1          4         454 
                                 +1          5         455 ;-------------------------------------------------------
                                 +1          6         456 ; print_init: loads system font into first half of vram
                                 +1          7         457 ;-------------------------------------------------------
                                 +1          8         458 	extern print_init
                                 +1          9         459 
                                 +1         10         460 ;-------------------------------------------------------
                                 +1         11         461 ; print_string
                                 +1         12         462 ;-------------------------------------------------------
                                 +1         13         463 ; xix: pointer to null terminated text
                                 +1         14         464 ; wa: x pos
                                 +1         15         465 ; bc: y pos
                                 +1         16         466 ;-------------------------------------------------------
                                 +1         17         467 	extern print_string
                                 +1         18         468 	
                                 +1         19         469 ;-------------------------------------------------------
                                 +1         20         470 ; print_byte
                                 +1         21         471 ;-------------------------------------------------------
                                 +1         22         472 ; xix: pointer to byte to print
                                 +1         23         473 ; wa: x pos
                                 +1         24         474 ; bc: y pos
                                 +1         25         475 ;-------------------------------------------------------
                                 +1         26         476 	extern print_byte
                                 +1         27         477 	
                                 +1         28         478 ;-------------------------------------------------------
                                 +1         29         479 ; print_word	
                                 +1         30         480 ;-------------------------------------------------------
                                 +1         31         481 ; xix: pointer to word to print
                                 +1         32         482 ; wa: x pos
                                 +1         33         483 ; bc: y pos
                                 +1         34         484 ;-------------------------------------------------------
                                 +1         35         485 	extern print_word
                                 +0         28         486 	$include "graphics.inc"
                                 +1          1         487 ;*****************************************
                                 +1          2         488 ;	Graphics data 
                                 +1          3         489 ;*****************************************
                                 +1          4         490 
                                 +1          5         491 	extern palette
                                 +1          6         492 	extern palette_end
                                 +1          7         493 	extern tiles
                                 +1          8         494 	extern tiles_end
                                 +1          9         495 	extern map
                                 +1         10         496 	extern map_end
                                 +0         29         497 	$include "scroll.inc"
                                 +1          1         498 ;-------------------------------------------------------
                                 +1          2         499 ; scroll_set: set scroll to specified coords
                                 +1          3         500 ;-------------------------------------------------------
                                 +1          4         501 ; wa: x pos
                                 +1          5         502 ; bc: y pos
                                 +1          6         503 ;-------------------------------------------------------
                                 +1          7         504 extern scroll_set
                                 +1          8         505 
                                 +1          9         506 ;-------------------------------------------------------
                                 +1         10         507 ; scroll_copy: carry out scroll changes made in scroll_set (run during vblank)
                                 +1         11         508 ;-------------------------------------------------------
                                 +1         12         509 extern scroll_copy
                                 +0         30         510 
                                 +0         31         511 
                                 +0         32         512 ;-------------------------------------------------------
                                 +0         33         513 PROG section code large
                                 +0         34         514 ;-------------------------------------------------------
                                 +0         35         515 
                                 +0         36         516 		public	__STARTUP
  00FF1800                       +0         37         517 __STARTUP	equ	0xff1800
                                 +0         38         518 ;-------------------------------------------------------
                                 +0         39         519 ; entry point			
                                 +0         40         520 ;-------------------------------------------------------
00000000                         +0         41         521 reset:
00000000  1D000000             R +0         42         522 	cal	SYS_PATCH ;called during init to assist with power functionality
                                 +0         43         523 
                                 +0         44         524 ;------------------- INITIALIZATION --------------------
00000004  1D000000             R +0         45         525 	cal init_setting ;VRAM, work initialization
                                 +0         46         526 	; cal print_init ;load system font
00000008  0600                   +0         47         527 	ei 0 ;allow interrupts with a priority >= 0
                                 +0         48         528 
                                 +0         49         529 	;---copy palette---
0000000A  F200000035           R +0         50         530 	lda xiy,palette
0000000F  F1808234               +0         51         531 	lda xix,SCROLL1_CRAM
00000013  313400                 +0         52         532 	ldw bc,4*13
00000016                         +0         53         533 palette_copy:
00000016  D5F520                 +0         54         534 	ldw wa,(xiy+)
00000019  F5F150                 +0         55         535 	ldw (xix+),wa
0000001C  D91CF7                 +0         56         536 	djnz bc,palette_copy	
                                 +0         57         537 	;---clear scroll plane 2 palette---
0000001F  D8A8                   +0         58         538 	ldw wa,0
00000021  F1008334               +0         59         539 	lda xix,SCROLL2_CRAM
00000025  314000                 +0         60         540 	ldw bc,4*16
00000028                         +0         61         541 palette2_copy:
00000028  F5F150                 +0         62         542 	ldw (xix+),wa
0000002B  D91CFA                 +0         63         543 	djnz bc,palette2_copy
                                 +0         64         544 
                                 +0         65         545 	; ;---set bg color---	
0000002E  30850F                 +0         66         546 	ldw wa,0xf85
00000031  F1E08350               +0         67         547 	ldw (0x83e0),wa
00000035  2180                   +0         68         548 	ldb a,0x80 ;bg color on, first color in cram
00000037  F1188141               +0         69         549 	ldb (0x8118),a	
                                 +0         70         550 	
                                 +0         71         551 	;---copy tiles---
                                 +0         72         552 	
0000003B  F200000035           R +0         73         553 	lda xiy,tiles
00000040  F100A034               +0         74         554 	lda xix,CHR_VRAM
00000044  310020                 +0         75         555 	ldw bc,0x2000
00000047  8511                   +0         76         556 	ldir (xix+),(xiy+)
                                 +0         77         557 	
                                 +0         78         558 	; ;---copy map---
                                 +0         79         559 	
00000049  F1009034               +0         80         560 	lda xix,SCRL1_VRAM
0000004D  F200000035           R +0         81         561 	lda xiy,map
00000052  2413                   +0         82         562 	ldb d,19 ;19 rows
00000054                         +0         83         563 map_copy:	
00000054  312800                 +0         84         564 	ldw bc,40 ;40 bytes per row (20 columns * 2 bytes per tile)
00000057                         +0         85         565 copy_row:
00000057  8511                   +0         86         566 	ldir (xix+),(xiy+)
00000059  DCC81800               +0         87         567 	addw ix,64-40
0000005D  DDC85800               +0         88         568 	addw iy,128-40
00000061  CC1CF0                 +0         89         569 	djnz d,map_copy
                                 +0         90         570 	
                                 +0         91         571 	
                                 +0         92         572 	
                                 +0         93         573 ;-------------------------------------------------------
                                 +0         94         574 ; main loop
                                 +0         95         575 ;-------------------------------------------------------
00000064                         +0         96         576 main:
00000064  C100003F00           R +0         97         577 	cpb (stopper),0 ;spin until vblank resets var
00000069  66F9                   +0         98         578 	j z,main
                                 +0         99         579 
0000006B  C1856F3F00             +0        100         580 	cpb (User_Shutdown),0 ;turn off the system if we get a shutdown req
00000070  6607                   +0        101         581 	j eq,main_100
                                 +0        102         582 
00000072  C731A8                 +0        103         583 	ldb rw3,VECT_SHUTDOWN
00000075  1D000000             R +0        104         584 	cal SYSTEM_CALL
                                 +0        105         585 
00000079                         +0        106         586 main_100:
                                 +0        107         587 	
00000079  F1826FC8               +0        108         588 	bit BIT_UP,(Sys_lever)
0000007D  6606                   +0        109         589 	j z,not_up
0000007F  D100003A0100         R +0        110         590 	subw (screen_y),1
00000085                         +0        111         591 not_up:
00000085  F1826FC9               +0        112         592 	bit BIT_DOWN,(Sys_lever)
00000089  6606                   +0        113         593 	j z,not_down
0000008B  D10000380100         R +0        114         594 	addw (screen_y),1
00000091                         +0        115         595 not_down:
00000091  F1826FCA               +0        116         596 	bit BIT_LEFT,(Sys_lever)
00000095  6606                   +0        117         597 	j z,not_left
00000097  D100003A0100         R +0        118         598 	subw (screen_x),1
0000009D                         +0        119         599 not_left:
0000009D  F1826FCB               +0        120         600 	bit BIT_RIGHT,(Sys_lever)
000000A1  6606                   +0        121         601 	j z,not_right
000000A3  D10000380100         R +0        122         602 	addw (screen_x),1
000000A9                         +0        123         603 not_right:
                                 +0        124         604 
000000A9  D1000020             R +0        125         605 	ldw wa,(screen_x)
000000AD  D1000021             R +0        126         606 	ldw bc,(screen_y)
000000B1  1D000000             R +0        127         607 	cal scroll_set
                                 +0        128         608 	
                                 +0        129         609 	
000000B5  F100000000           R +0        130         610 	ldb (stopper),0
000000BA  68A8                   +0        131         611 	j main
                                 +0        132         612 	
000000BC                         +0        133         613 String:
000000BC  68656C6C6F20776F726C   +0        134         614 	db "hello world",0
          6400                                             
000000C8                         +0        135         615 	align 2
000000C8                         +0        136         616 JoyStr:
000000C8  6A6F797061643A207878   +0        137         617 	db "joypad: xx",0
          00                                               
000000D3                         +0        138         618 	align 2
000000D4                         +0        139         619 FrameStr:
000000D4  6672616D653A20787878   +0        140         620 	db "frame: xxxx",0
          7800                                             
000000E0                         +0        141         621 	align 2
                                 +0        142         622 	
                                 +0        143         623 ;-------------------------------------------------------
                                 +0        144         624 ; v-blank interrupt
                                 +0        145         625 ;-------------------------------------------------------
000000E0                         +0        146         626 v_int:
000000E0  3C                     +0        147         627 	pushl xix
000000E1  3D                     +0        148         628 	pushl xiy
000000E2  3E                     +0        149         629 	pushl xiz
000000E3  38                     +0        150         630 	pushl xwa
000000E4  39                     +0        151         631 	pushl xbc
000000E5  3A                     +0        152         632 	pushl xde
000000E6  3B                     +0        153         633 	pushl xhl
000000E7  02                     +0        154         634 	pushw sr
                                 +0        155         635 ;	--------------------------------
000000E8  086F4E                 +0        156         636 	ldb	(WDCR),WD_CLR ;watch dog clear
000000EB  F1000000FF           R +0        157         637 	ldb	(stopper),0xff
000000F0  1D000000             R +0        158         638 	cal scroll_copy
                                 +0        159         639 ;	--------------------------------
000000F4  03                     +0        160         640     popw sr
000000F5  5B                     +0        161         641 	popl xhl
000000F6  5A                     +0        162         642 	popl xde
000000F7  59                     +0        163         643 	popl xbc
000000F8  58                     +0        164         644 	popl xwa
000000F9  5E                     +0        165         645 	popl xiz
000000FA  5D                     +0        166         646 	popl xiy
000000FB  5C                     +0        167         647 	popl xix
                                 +0        168         648 
000000FC  07                     +0        169         649 	reti
                                 +0        170         650 
                                 +0        171         651 ;-------------------------------------------------------
                                 +0        172         652 ; other interrupts
                                 +0        173         653 ;-------------------------------------------------------
000000FD                         +0        174         654 h_int:
000000FD  07                     +0        175         655 	reti
                                 +0        176         656 
000000FE                         +0        177         657 timer1:
000000FE  07                     +0        178         658 	reti
                                 +0        179         659 
000000FF                         +0        180         660 timer2:
000000FF  07                     +0        181         661 	reti
                                 +0        182         662 
00000100                         +0        183         663 alarm_int:
00000100  07                     +0        184         664 	reti
                                 +0        185         665 
00000101                         +0        186         666 z80_int:
00000101  07                     +0        187         667 	reti
                                 +0        188         668 
00000102                         +0        189         669 sound_int:
00000102  07                     +0        190         670 	reti
                                 +0        191         671 
00000103                         +0        192         672 dummy:
00000103  07                     +0        193         673 	reti
                                 +0        194         674 
                                 +0        195         675 ;-------------------------------------------------------
                                 +0        196         676 	end
                                 +0        197         677 ;-------------------------------------------------------

Assembly complete, No error
TLCS-900 Relocatable Assembler (32) V2.2k  [Page     2]  main.lst

Symbol table listing
--------------------

Symbol           Category         Value     Attribute

ALARM_BOOT_REQ           NUM      00000007  A           
BAT_SHUTDOWN_REQ
                         NUM      00000005  A           
BGCOL_CRAM               NUM      000083E0  A           
BG_COLOR                 NUM      00008118  A           
BIT_A                    NUM      00000004  A           
BIT_B                    NUM      00000005  A           
BIT_DOWN                 NUM      00000001  A           
BIT_LEFT                 NUM      00000002  A           
BIT_OPTION               NUM      00000006  A           
BIT_RIGHT                NUM      00000003  A           
BIT_UP                   NUM      00000000  A           
Battery_Voltage          NUM      00006F80  A           
CHR_VRAM                 NUM      0000A000  A           
DISP_CTL0                NUM      00008000  A           
FrameStr         C L     LAB      000000D4  R           PROG
INT_CLR_BIT              NUM      00000007  A           
JOY_A                    NUM      00000010  A           
JOY_B                    NUM      00000020  A           
JOY_DOWN                 NUM      00000002  A           
JOY_LEFT                 NUM      00000004  A           
JOY_OPTION               NUM      00000040  A           
JOY_RIGHT                NUM      00000008  A           
JOY_UP                   NUM      00000001  A           
JoyStr           C L     LAB      000000C8  R           PROG
LCD_CTR_ADD              NUM      00008012  A           
Language                 NUM      00006F87  A           
MP_SHUTDOWN_REQ          NUM      00000007  A           
OS_Version               NUM      00006F91  A           
PAL_SCR1_00              NUM      00008111  A           
PAL_SCR1_01              NUM      00008112  A           
PAL_SCR1_02              NUM      00008113  A           
PAL_SCR1_10              NUM      00008115  A           
PAL_SCR1_11              NUM      00008116  A           
PAL_SCR1_12              NUM      00008117  A           
PL_SCR0_00               NUM      00008109  A           
PL_SCR0_01               NUM      0000810A  A           
PL_SCR0_02               NUM      0000810B  A           
PL_SCR0_10               NUM      0000810D  A           
PL_SCR0_11               NUM      0000810E  A           
PL_SCR0_12               NUM      0000810F  A           
PL_SPR_00                NUM      00008101  A           
PL_SPR_01                NUM      00008102  A           
PL_SPR_02                NUM      00008103  A           
PL_SPR_10                NUM      00008105  A           
PL_SPR_11                NUM      00008106  A           
PL_SPR_12                NUM      00008107  A           
POWER_BOOT_REQ           NUM      00000006  A           
PROG             C L     SEC      00000000  R 104       
RESET_ADD                NUM      000087E0  A           
RESUME_ANS               NUM      00000007  A           
RESUME_BOOT_REQ          NUM      00000005  A           
SCRL1_VRAM               NUM      00009000  A           
SCRL2_VRAM               NUM      00009800  A           
SCRL_PRIO_ADR            NUM      00008030  A           
SCRL_X1_ADR              NUM      00008032  A           
SCRL_X2_ADR              NUM      00008034  A           
SCRL_Y1_ADR              NUM      00008033  A           
SCRL_Y2_ADR              NUM      00008035  A           
SCROLL1_CRAM             NUM      00008280  A           
SCROLL2_CRAM             NUM      00008300  A           
SPRITE_CRAM              NUM      00008200  A           
SPR_OFFSET_X_ADR
                         NUM      00008020  A           
SPR_OFFSET_Y_ADR
                         NUM      00008021  A           
SPR_VRAM                 NUM      00008800  A           
STS_RG_ADD               NUM      00008010  A           
SYSTEM_CALL                       00000000  R EXT       
SYS_FAILURE              NUM      000000FF  A           
SYS_PATCH                         00000000  R EXT       
SYS_SUCCESS              NUM      00000000  A           
String           C L     LAB      000000BC  R           PROG
Sys_lever                NUM      00006F82  A           
TIMER_SHUTDOWN_ANS
                         NUM      00000006  A           
TIME_SHUTDOWN_REQ
                         NUM      00000006  A           
User_Answer              NUM      00006F86  A           
User_Boot                NUM      00006F84  A           
User_Shutdown            NUM      00006F85  A           
VECT_ALARMDOWNSET
                         NUM      0000000B  A           
VECT_ALARMSET            NUM      00000009  A           
VECT_CLOCKGEARSET
                         NUM      00000001  A           
VECT_FLASHALLERS
                         NUM      00000007  A           
VECT_FLASHERS            NUM      00000008  A           
VECT_FLASHPROTECT
                         NUM      0000000D  A           
VECT_FLASHWRITE          NUM      00000006  A           
VECT_GEMODESET           NUM      0000000E  A           
VECT_INTLVSET            NUM      00000004  A           
VECT_RTCGET              NUM      00000002  A           
VECT_SHUTDOWN            NUM      00000000  A           
VECT_SYSFONTSET          NUM      00000005  A           
VERSION_ADD              NUM      000087FE  A           
WDCR                     NUM      0000006F  A           
WD_CLR                   NUM      0000004E  A           
WD_LCDST_HPOS            NUM      00008008  A           
WD_LCDST_VPOS            NUM      00008009  A           
WINDOW_CRAM              NUM      000083F0  A           
WIN_WBAX_ADR             NUM      00008002  A           
WIN_WBAY_ADR             NUM      00008003  A           
WIN_WSIX_ADR             NUM      00008004  A           
WIN_WSIY_ADR             NUM      00008005  A           
_ALARM_BOOT_REQ          NUM      00000080  A           
_BAT_SHUTDOWN_REQ
                         NUM      00000020  A           
_INT_CLR_BIT             NUM      00000080  A           
_MP_SHUTDOWN_REQ
                         NUM      00000080  A           
_POWER_BOOT_REQ          NUM      00000040  A           
_RESUME_ANS              NUM      00000080  A           
_RESUME_BOOT_REQ
                         NUM      00000020  A           
_TIMER_SHUTDOWN_ANS
                         NUM      00000040  A           
_TIME_SHUTDOWN_REQ
                         NUM      00000040  A           
__STARTUP                NUM      00FF1800  A PUB       
alarm_int        C L     LAB      00000100  R PUB       PROG
copy_row         C L     LAB      00000057  R           PROG
disp_size_x              NUM      000000A0  A           
disp_size_y              NUM      00000098  A           
dummy            C L     LAB      00000103  R PUB       PROG
game_main                MOD
h_int            C L     LAB      000000FD  R PUB       PROG
init_setting                      00000000  R EXT       
main             C L     LAB      00000064  R           PROG
main_100         C L     LAB      00000079  R           PROG
map                               00000000  R EXT       
map_copy         C L     LAB      00000054  R           PROG
not_down         C L     LAB      00000091  R           PROG
not_left         C L     LAB      0000009D  R           PROG
not_right        C L     LAB      000000A9  R           PROG
not_up           C L     LAB      00000085  R           PROG
obj_max                  NUM      00000040  A           
palette                           00000000  R EXT       
palette2_copy    C L     LAB      00000028  R           PROG
palette_copy     C L     LAB      00000016  R           PROG
reset            C L     LAB      00000000  R PUB       PROG
screen_x                          00000000  R EXT       
screen_y                          00000000  R EXT       
scroll_copy                       00000000  R EXT       
scroll_set                        00000000  R EXT       
sound_int        C L     LAB      00000102  R PUB       PROG
stopper                           00000000  R EXT       
tiles                             00000000  R EXT       
timer1           C L     LAB      000000FE  R PUB       PROG
timer2           C L     LAB      000000FF  R PUB       PROG
v_int            C L     LAB      000000E0  R PUB       PROG
z80_int          C L     LAB      00000101  R PUB       PROG


TOTAL
  140 user defined symbol(s)
    9 unreferenced external symbol(s)
